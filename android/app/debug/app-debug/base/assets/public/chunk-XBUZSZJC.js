import{b as y}from"./chunk-VT372YOS.js";import"./chunk-AV73RGVI.js";import{f as b}from"./chunk-N4CCYIXR.js";import"./chunk-UAEYNMJW.js";import"./chunk-YPFPCNBD.js";import{Ca as d,Da as g,Ea as m,H as o,Lb as v,Xa as p,_b as f,bc as S,ia as h}from"./chunk-U6U25BWF.js";import"./chunk-B3LSNZRN.js";import"./chunk-WUBXWBRT.js";import"./chunk-B52GHH4C.js";import"./chunk-KZ3CI6ZI.js";import"./chunk-HC6MZPB3.js";import"./chunk-SV2ZKNWA.js";import"./chunk-IA5KSSRM.js";import"./chunk-RS5W3JWO.js";import"./chunk-XENCGOZ2.js";import"./chunk-XZRAAXKF.js";import"./chunk-7D6K5XYM.js";import"./chunk-OBXDPQ3V.js";import"./chunk-QY5CJPR3.js";import"./chunk-MCRJI3T3.js";import"./chunk-ZD4SBDZ6.js";import"./chunk-NCLOD2DI.js";import"./chunk-UYQ7EZNZ.js";import"./chunk-BAKMWPBW.js";import"./chunk-AESNPOCP.js";import"./chunk-H3ZVKW6B.js";import"./chunk-HMK4XMX7.js";import"./chunk-E7UUDSES.js";import"./chunk-JQ3FRJ6A.js";import"./chunk-3IVKBF6N.js";import"./chunk-NMYJD6OP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-SV7S5NYR.js";import{j as u}from"./chunk-LVXXLD6S.js";var _=(()=>{let t=class t{constructor(){this.route=o(f),this.router=o(S),this.authService=o(b),this.navigationService=o(y)}ngOnInit(){return u(this,null,function*(){let r=this.route.snapshot.queryParamMap,e=r.get("code")??"",i=r.get("returnUrl")??"",c=r.get("error"),l=r.get("error_description");try{if(c)return console.error("OAuth error:",c,l),this.handleOAuthError(c,l||"Error en autenticaci\xF3n SSO");if(!e||e.trim()==="")return console.error("No authorization code received"),this.handleOAuthError("no_code","No se recibi\xF3 c\xF3digo de autorizaci\xF3n");if(!(yield this.authService.intercambiarToken(e)))return console.error("Token exchange failed"),this.handleOAuthError("token_exchange_failed","Error al intercambiar tokens");console.debug("Token intercambiado correctamente, redirigiendo...");let n=yield this.authService.validarTerminosYPerfil();return n&&n!=="/"?(console.debug("Redirecting to post-login destination:",n),this.router.navigate([n])):i&&i!=="/"?(console.debug("Redirecting to return URL:",i),this.router.navigate([i],{replaceUrl:!0})):(console.debug("Redirecting to first available page"),this.navigationService.navegarAPrimeraPaginaDisponible())}catch(s){return console.error("Error en callback OAuth:",s),this.handleOAuthError("unexpected_error",s.message||"Error inesperado en autenticaci\xF3n SSO")}})}handleOAuthError(r,e){return u(this,null,function*(){return this.authService.clearSession(),this.authService.setLoading(!1),this.router.navigate(["/auth/login"],{queryParams:{sso_error:r,sso_error_description:e}})})}};t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=h({type:t,selectors:[["app-auth-callback-movil"]],decls:5,vars:0,consts:[[1,"flex","items-center","justify-center","min-h-screen"],[1,"text-center"],[1,"loading","loading-spinner","loading-lg"],[1,"mt-4","text-gray-600"]],template:function(e,i){e&1&&(d(0,"div",0)(1,"div",1),m(2,"div",2),d(3,"p",3),p(4,"Procesando autenticaci\xF3n..."),g()()())},dependencies:[v],encapsulation:2,changeDetection:0});let a=t;return a})();export{_ as AuthCallbackMovilPage};
