import{a as W}from"./chunk-I7IWUYYH.js";import{a as he,b as Ce,c as ve,d as xe,f as B,g as Ee,h as Se,i as be,j as ye,k as we}from"./chunk-KWYFY7T2.js";import{a as fe}from"./chunk-ZU7Q4APP.js";import{b as Z}from"./chunk-KTGXZBKE.js";import"./chunk-LKADUWP6.js";import"./chunk-6CQPCFUJ.js";import"./chunk-AI3LD7IZ.js";import{a as K}from"./chunk-ODBDBKE7.js";import"./chunk-XPPSGRKL.js";import{g as _e,h as Oe}from"./chunk-4HN4PAFJ.js";import{i as ne}from"./chunk-AV73RGVI.js";import{f as ie}from"./chunk-N4CCYIXR.js";import"./chunk-UAEYNMJW.js";import{A as Be,C as $e,G as w,c as de,e as I,g as pe,j as k,l as Fe,m as me,q as Ge,r as Pe,s as Ae,u as Re,w as ue,z as ge}from"./chunk-YPFPCNBD.js";import{Aa as A,Ba as d,Ca as c,D as He,Da as s,Db as ee,Ea as v,Fa as H,Ga as L,H as C,Ia as U,Ja as Q,Ka as r,Kb as Le,Lb as te,N as V,O as M,R as ae,Ra as R,Rb as Ue,Sa as Y,Ta as z,U as E,Xa as p,Ya as O,Za as y,aa as q,da as l,gb as re,ha as ze,hb as j,ia as J,ib as le,k as b,kb as Te,lb as F,na as G,pb as h,qb as se,ta as N,tb as $,va as u,wa as g,wb as ce,xa as X,za as P}from"./chunk-U6U25BWF.js";import"./chunk-B3LSNZRN.js";import"./chunk-WUBXWBRT.js";import"./chunk-B52GHH4C.js";import"./chunk-KZ3CI6ZI.js";import"./chunk-HC6MZPB3.js";import"./chunk-SV2ZKNWA.js";import"./chunk-IA5KSSRM.js";import"./chunk-RS5W3JWO.js";import"./chunk-XENCGOZ2.js";import"./chunk-XZRAAXKF.js";import"./chunk-7D6K5XYM.js";import"./chunk-OBXDPQ3V.js";import"./chunk-QY5CJPR3.js";import"./chunk-MCRJI3T3.js";import"./chunk-ZD4SBDZ6.js";import"./chunk-NCLOD2DI.js";import"./chunk-UYQ7EZNZ.js";import"./chunk-BAKMWPBW.js";import"./chunk-AESNPOCP.js";import"./chunk-H3ZVKW6B.js";import"./chunk-HMK4XMX7.js";import"./chunk-E7UUDSES.js";import"./chunk-JQ3FRJ6A.js";import"./chunk-3IVKBF6N.js";import"./chunk-NMYJD6OP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-SV7S5NYR.js";import{a as x,b as S,j as _}from"./chunk-LVXXLD6S.js";var rt=w.apiUrl,je=(e,n)=>_(null,null,function*(){let i=`${rt}/categorias`;return b(e.post(i,n))});var lt=w.apiUrl,Ke=(e,n)=>_(null,null,function*(){let i=`${lt}/elementos`;return b(e.post(i,n))});var st=w.apiUrl,Ze=(e,n)=>_(null,null,function*(){let i=`${st}/grupos`;return b(e.post(i,n))});var ct=w.apiUrl,De=(e,n)=>_(null,null,function*(){let i=new URLSearchParams({page:(n.pageIndex+1).toString(),per_page:n.pageSize.toString(),search:n.search?.trim()||""}),t=`${ct}/categorias?${i.toString()}`;return b(e.get(t))});var dt=w.apiUrl,Qe=(e,n)=>_(null,null,function*(){let i=new URLSearchParams({page:(n.pageIndex+1).toString(),per_page:n.pageSize.toString(),search:n.search?.trim()||"",from_crud:n.fromCrud?"true":"false"}),t=`${dt}/elementos?${i.toString()}`;return b(e.get(t))});var pt=w.apiUrl,qe=(e,n)=>_(null,null,function*(){let i=new URLSearchParams({page:(n.pageIndex+1).toString(),per_page:n.pageSize.toString(),search:n.search?.trim()||""}),t=`${pt}/grupos?${i.toString()}`;return b(e.get(t))});var mt=w.apiUrl,We=(e,n,i)=>_(null,null,function*(){let t=`${mt}/categorias/${i}`;return b(e.patch(t,n))});var ut=w.apiUrl,Je=(e,n,i)=>_(null,null,function*(){let t=`${ut}/elementos/${i}`;return b(e.patch(t,n))});var gt=w.apiUrl,Xe=(e,n,i)=>_(null,null,function*(){if(!["activo","inactivo"].includes(i))throw new Error('El estado debe ser "activo" o "inactivo".');let t=`${gt}/categorias/`;t+=i==="activo"?`${n}/restaurar`:`${n}`;let o=i==="activo"?"PATCH":"DELETE",a={estado:i};return(yield b(o==="PATCH"?e.patch(t,a):e.delete(t,{body:a}))).data});var _t=w.apiUrl,Ye=(e,n,i)=>_(null,null,function*(){if(!["activo","inactivo"].includes(i))throw new Error('El estado debe ser "activo" o "inactivo".');let t=`${_t}/grupos/`;t+=i==="activo"?`${n}/restaurar`:`${n}`;let o=i==="activo"?"PATCH":"DELETE",a={estado:i};return(yield b(o==="PATCH"?e.patch(t,a):e.delete(t,{body:a}))).data});var ft=w.apiUrl,et=(e,n,i)=>_(null,null,function*(){if(!["activo","inactivo"].includes(i))throw new Error('El estado debe ser "activo" o "inactivo".');let t=`${ft}/elementos/`;t+=i==="activo"?`${n}/restaurar`:`${n}`;let o=i==="activo"?"PATCH":"DELETE",a={estado:i};return(yield b(o==="PATCH"?e.patch(t,a):e.delete(t,{body:a}))).data});var ht=w.apiUrl,tt=(e,n,i)=>_(null,null,function*(){let t=`${ht}/grupos/${i}`;return b(e.patch(t,n))});var oe=(()=>{let n=class n{constructor(){this.http=C(Ue),this.queryClient=C(Be),this._pestana=E("categorias"),this._alertaConfig=E(null),this._categoriaSeleccionada=E(null),this._modoCreacionCategoria=E(!1),this._filaCategoriaEditando=E({}),this._paginacionCategorias=E({pageIndex:0,pageSize:10}),this._datosPaginadorCategorias=E(null),this._modoCreacionGrupo=E(!1),this._filaGrupoEditando=E({}),this._paginacionGrupos=E({pageIndex:0,pageSize:10}),this._datosPaginadorGrupos=E(null),this._modoCreacionElemento=E(!1),this._filaElementoEditando=E({}),this._paginacionElementos=E({pageIndex:0,pageSize:10}),this._datosPaginadorElementos=E(null),this._elementoSeleccionado=E(null),this.pestana=h(()=>this._pestana()),this.alertaConfig=h(()=>this._alertaConfig()),this.modoCreacionCategoria=h(()=>this._modoCreacionCategoria()),this.filaCategoriaEditando=h(()=>this._filaCategoriaEditando()),this.paginacionCategorias=h(()=>this._paginacionCategorias()),this.datosPaginadorCategorias=h(()=>this._datosPaginadorCategorias()),this.categoriaSeleccionada=h(()=>this._categoriaSeleccionada()),this.modoCreacionGrupo=h(()=>this._modoCreacionGrupo()),this.filaGrupoEditando=h(()=>this._filaGrupoEditando()),this.paginacionGrupos=h(()=>this._paginacionGrupos()),this.datosPaginadorGrupos=h(()=>this._datosPaginadorGrupos()),this.modoCreacionElemento=h(()=>this._modoCreacionElemento()),this.filaElementoEditando=h(()=>this._filaElementoEditando()),this.paginacionElementos=h(()=>this._paginacionElementos()),this.datosPaginadorElementos=h(()=>this._datosPaginadorElementos()),this.elementoSeleccionado=h(()=>this._elementoSeleccionado()),this.categoriasQuery=$e(()=>({queryKey:["categorias",this.paginacionCategorias()],queryFn:()=>De(this.http,x({},this.paginacionCategorias())),select:t=>(this._datosPaginadorCategorias.set(t.meta),t.data)})),this.gruposQuery=$e(()=>({queryKey:["grupos",this.paginacionGrupos()],queryFn:()=>qe(this.http,x({},this.paginacionGrupos())),select:t=>t.data})),this.elementosQuery=$e(()=>({queryKey:["elementos",this.paginacionElementos()],queryFn:()=>Qe(this.http,S(x({},this.paginacionElementos()),{fromCrud:!0})),select:t=>t.data}))}setPaginacionCategorias(t){this._paginacionCategorias.set(t)}cambiarEstadoCategoria(t,o){return Xe(this.http,t,o)}setModoCreacionCategoria(t){this._modoCreacionCategoria.set(t)}setEditandoFilaCategoria(t,o){this._filaCategoriaEditando.set(S(x({},this._filaCategoriaEditando()),{[t]:o}))}crearCategoria(t){return _(this,null,function*(){return je(this.http,t)})}actualizarCategoria(t,o){return _(this,null,function*(){return We(this.http,o,t)})}inciarCrearCategoria(){this.setModoCreacionCategoria(!0),this.setEditandoFilaCategoria(0,!0),this.setPestana("categorias")}prefetchCategorias(t){this.queryClient.prefetchQuery({queryKey:["categorias",t],queryFn:()=>De(this.http,x({},t)),staleTime:1e3*60*5})}setPaginacionElementos(t){this._paginacionElementos.set(t)}cambiarEstadoElemento(t,o){return et(this.http,t,o)}setModoCreacionElemento(t){this._modoCreacionElemento.set(t)}setEditandoFilaElemento(t,o){this._filaElementoEditando.set(S(x({},this._filaElementoEditando()),{[t]:o}))}crearElemento(t){return _(this,null,function*(){return Ke(this.http,t)})}actualizarElemento(t,o){return _(this,null,function*(){return Je(this.http,o,t)})}inciarCrearElemento(){this.setModoCreacionElemento(!0),this.setEditandoFilaElemento(0,!0),this.setPestana("elementos")}prefetchElementos(t){this.queryClient.prefetchQuery({queryKey:["elementos",t],queryFn:()=>Qe(this.http,x({},t)),staleTime:1e3*60*5})}setPaginacionGrupos(t){this._paginacionGrupos.set(t)}cambiarEstadoGrupo(t,o){return Ye(this.http,t,o)}setModoCreacionGrupo(t){this._modoCreacionGrupo.set(t)}setEditandoFilaGrupo(t,o){this._filaGrupoEditando.set(S(x({},this._filaGrupoEditando()),{[t]:o}))}crearGrupo(t){return _(this,null,function*(){return Ze(this.http,t)})}actualizarGrupo(t,o){return _(this,null,function*(){return tt(this.http,o,t)})}inciarCrearGrupo(){this.setModoCreacionGrupo(!0),this.setEditandoFilaGrupo(0,!0),this.setPestana("grupos")}prefetchGrupos(t){this.queryClient.prefetchQuery({queryKey:["grupos",t],queryFn:()=>qe(this.http,x({},t)),staleTime:1e3*60*5})}setPestana(t){this._pestana.set(t)}setAlertaConfig(t){this._alertaConfig.set(t)}setCategoriaeleccionada(t){this._categoriaSeleccionada.set(t)}setElementoSeleccionado(t){this._elementoSeleccionado.set(t)}resetAll(){this._modoCreacionCategoria.set(!1),this._filaCategoriaEditando.set({}),this._categoriaSeleccionada.set(null),this._paginacionCategorias.set({pageIndex:0,pageSize:10}),this._datosPaginadorCategorias.set(null),this._modoCreacionGrupo.set(!1),this._filaGrupoEditando.set({}),this._paginacionGrupos.set({pageIndex:0,pageSize:10}),this._datosPaginadorGrupos.set(null),this._modoCreacionElemento.set(!1),this._filaElementoEditando.set({}),this._paginacionElementos.set({pageIndex:0,pageSize:10}),this._datosPaginadorElementos.set(null)}};n.\u0275fac=function(o){return new(o||n)},n.\u0275prov=He({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();var Ct=["estadoCell"],vt=["nombreCell"],xt=["grupoCell"],Et=["fechaCell"],St=(e,n,i,t,o)=>({"badge font-semibold min-w-20 hover:cursor-pointer hover:scale-105 transition-all tooltip align-middle":!0,"tooltip-right":e,"tooltip-left":n,"badge-success":i,"badge-error":t,"opacity-50 pointer-events-none badge-ghost":o}),Ve=(e,n)=>n.id;function bt(e,n){e&1&&(c(0,"span",9),p(1,"Nuevo"),s())}function yt(e,n){if(e&1){let i=U();c(0,"div",11),Q("click",function(){V(i);let o=r().$implicit,a=r();return M(a.authService.tienePermisos("ESP000012")?a.appService.editando()?null:a.cambiarEstadoConfig(o.row.original):null)}),p(1),j(2,"upperFirst"),s()}if(e&2){let i=r().$implicit,t=r();d("ngClass",re(6,St,!i.column.getIsVisible(),i.column.getIsVisible(),i.getValue()===null,i.getValue()!==null,t.appService.editando())),N("data-tip",i.getValue()===null?"Desactivar":"Activar")("disabled",t.appService.guardando()),l(),y(" ",le(2,4,i.getValue()===null?"activo":"inactivo")," ")}}function wt(e,n){if(e&1&&u(0,bt,2,0,"span",9)(1,yt,3,12,"div",10),e&2){let i=n.$implicit;g(i.row.original.id===-1?0:1)}}function Tt(e,n){if(e&1&&v(0,"input",12),e&2){let i=r(2);d("formControl",i.nombre)}}function Ft(e,n){if(e&1&&(c(0,"span",13),p(1),s()),e&2){let i=r().$implicit;l(),O(i.getValue())}}function Gt(e,n){if(e&1&&u(0,Tt,1,1,"input",12)(1,Ft,2,1,"span",13),e&2){let i=n.$implicit,t=r();g(i.row.original.id===-1||t.configService.filaCategoriaEditando()[i.row.original.id]?0:1)}}function Pt(e,n){if(e&1&&(c(0,"option",17),p(1),s()),e&2){let i=n.$implicit;d("value",i.id),l(),y(" ",i.nombre," ")}}function At(e,n){if(e&1&&(c(0,"select",14)(1,"option",16),p(2,"Seleccione"),s(),P(3,Pt,2,2,"option",17,X),s()),e&2){let i=r(2);d("formControl",i.grupo),l(3),A(i.appService.gruposQuery.data())}}function Rt(e,n){if(e&1&&(c(0,"span",15),p(1),s()),e&2){let i=r().$implicit;l(),O(i.getValue())}}function $t(e,n){if(e&1&&u(0,At,5,1,"select",14)(1,Rt,2,1,"span",15),e&2){let i=n.$implicit,t=r();g(i.row.original.id===-1||t.configService.filaCategoriaEditando()[i.row.original.id]?0:1)}}function It(e,n){if(e&1&&(c(0,"span"),p(1),s()),e&2){let i=r(2);l(),O(i.fechaActual())}}function Vt(e,n){if(e&1&&(c(0,"span"),p(1),s()),e&2){let i=r().$implicit;l(),y(" ",i.getValue()," ")}}function Mt(e,n){if(e&1&&u(0,It,2,1,"span")(1,Vt,2,1,"span"),e&2){let i=n.$implicit,t=r();g(i.row.original.id===-1||t.configService.filaCategoriaEditando()[i.row.original.id]?0:1)}}function kt(e,n){if(e&1&&(H(0),v(1,"span",20),L()),e&2){let i=n.$implicit;l(),d("innerHTML",i,q)}}function zt(e,n){if(e&1&&G(0,kt,2,1,"ng-container",19),e&2){let i=r().$implicit;d("flexRender",i.column.columnDef.header)("flexRenderProps",i.getContext())}}function Dt(e,n){if(e&1&&(c(0,"th",18),u(1,zt,1,2,"ng-container"),s()),e&2){let i=n.$implicit;d("colSpan",i.colSpan),l(),g(i.isPlaceholder?-1:1)}}function Qt(e,n){if(e&1&&(c(0,"tr"),P(1,Dt,2,2,"th",18,Ve),s()),e&2){let i=n.$implicit;l(),A(i.headers)}}function qt(e,n){if(e&1&&(c(0,"tr")(1,"td",21)(2,"span"),p(3,"No hay configuraciones a\xFAn..."),s()()()),e&2){let i=r(),t=z(9);l(),N("colspan",i.tablaCategorias().getAllColumns().length+(t.hiddenColumnIds().size>0?1:0))}}function Nt(e,n){if(e&1&&(H(0),v(1,"div",25),L()),e&2){let i=n.$implicit;l(),d("innerHTML",i,q)}}function Ht(e,n){if(e&1&&(c(0,"td",23),G(1,Nt,2,1,"ng-container",19),s()),e&2){let i=n.$implicit;l(),d("flexRender",i.column.columnDef.cell)("flexRenderProps",i.getContext())}}function Lt(e,n){if(e&1&&v(0,"input",31),e&2){let i=r(4);d("formControl",i.reservasEstudiante)}}function Ut(e,n){if(e&1&&(c(0,"span",32),p(1),s()),e&2){let i=r(2).$implicit;l(),y(" ",i.original.reservas_estudiante||"No definido"," ")}}function Bt(e,n){if(e&1&&v(0,"input",31),e&2){let i=r(4);d("formControl",i.reservasAdministrativo)}}function Ot(e,n){if(e&1&&(c(0,"span",32),p(1),s()),e&2){let i=r(2).$implicit;l(),y(" ",i.original.reservas_administrativo||"No definido"," ")}}function jt(e,n){if(e&1&&v(0,"input",31),e&2){let i=r(4);d("formControl",i.reservasExterno)}}function Kt(e,n){if(e&1&&(c(0,"span",32),p(1),s()),e&2){let i=r(2).$implicit;l(),y(" ",i.original.reservas_externo||"No definido"," ")}}function Zt(e,n){if(e&1&&v(0,"input",31),e&2){let i=r(4);d("formControl",i.reservasEgresado)}}function Wt(e,n){if(e&1&&(c(0,"span",32),p(1),s()),e&2){let i=r(2).$implicit;l(),y(" ",i.original.reservas_egresado||"No definido"," ")}}function Jt(e,n){if(e&1&&(H(0),v(1,"div",25),L()),e&2){let i=n.$implicit;l(),d("innerHTML",i,q)}}function Xt(e,n){if(e&1&&(c(0,"li",35)(1,"span",36),p(2),s(),c(3,"span"),G(4,Jt,2,1,"ng-container",19),s()()),e&2){let i=r().$implicit,t=r(3).$implicit;r(2);let o=z(9);l(2),y(" ",i.columnDef.header,": "),l(2),d("flexRender",o.getCell(i,t).column.columnDef.cell)("flexRenderProps",o.getCell(i,t).getContext())}}function Yt(e,n){if(e&1&&u(0,Xt,5,3,"li",35),e&2){let i=n.$implicit;r(5);let t=z(9);g(t.hiddenColumnIds().has(i.id)?0:-1)}}function ei(e,n){if(e&1&&(v(0,"div",33),c(1,"div",34)(2,"ul"),P(3,Yt,1,1,null,null,X),s()()),e&2){let i=r(4);l(3),A(i.tablaCategorias.getAllLeafColumns())}}function ti(e,n){if(e&1&&(c(0,"tr",24)(1,"td")(2,"div",26)(3,"h4",27),p(4," Configuraci\xF3n diaria de reservas por tipo de usuario "),s(),c(5,"div",28)(6,"div",29)(7,"label",30),p(8," Estudiante: "),s(),u(9,Lt,1,1,"input",31)(10,Ut,2,1,"span",32),s(),c(11,"div",29)(12,"label",30),p(13," Administrativo: "),s(),u(14,Bt,1,1,"input",31)(15,Ot,2,1,"span",32),s(),c(16,"div",29)(17,"label",30),p(18," Externo: "),s(),u(19,jt,1,1,"input",31)(20,Kt,2,1,"span",32),s(),c(21,"div",29)(22,"label",30),p(23," Egresado: "),s(),u(24,Zt,1,1,"input",31)(25,Wt,2,1,"span",32),s()(),u(26,ei,5,0),s()()()),e&2){let i=r().$implicit,t=r(2),o=z(9);l(),N("colspan",i.getVisibleCells().length+1),l(8),g(i.original.id===-1||t.configService.filaCategoriaEditando()[i.original.id]?9:10),l(5),g(i.original.id===-1||t.configService.filaCategoriaEditando()[i.original.id]?14:15),l(5),g(i.original.id===-1||t.configService.filaCategoriaEditando()[i.original.id]?19:20),l(5),g(i.original.id===-1||t.configService.filaCategoriaEditando()[i.original.id]?24:25),l(2),g(o.hiddenColumnIds().size!==0?26:-1)}}function ii(e,n){if(e&1&&(c(0,"tr",22),P(1,Ht,2,2,"td",23,Ve),s(),u(3,ti,27,6,"tr",24)),e&2){let i=n.$implicit;l(),A(i.getVisibleCells()),l(2),g(i.getIsExpanded()?3:-1)}}function ni(e,n){if(e&1&&P(0,ii,4,1,null,null,Ve),e&2){let i=r();A(i.tablaCategorias().getRowModel().rows)}}function oi(e,n){}var nt=(()=>{let n=class n{constructor(){this.injector=C(ae),this.upperFirstPipe=C(K),this.alertaService=C(fe),this.cdr=C(ce),this.categoriaEnEdicion=E(null),this.configService=C(oe),this.appService=C(ne),this.authService=C(ie),this.permisos=_e,this.fechaActual=h(()=>Z(new Date,"dd/MM/yyyy HH:mm a")),this.nombre=new k(null,[I.required,I.minLength(3)]),this.grupo=new k(null,[I.required]),this.reservasEstudiante=new k(null,[I.min(0)]),this.reservasAdministrativo=new k(null,[I.min(0)]),this.reservasExterno=new k(null,[I.min(0)]),this.reservasEgresado=new k(null,[I.min(0)]),this.modoCreacion=h(()=>this.configService.modoCreacionCategoria()),this.estadoCell=$.required("estadoCell"),this.nombreCell=$.required("nombreCell"),this.grupoCell=$.required("grupoCell"),this.fechaCell=$.required("fechaCell"),this.accionesNuevo=h(()=>[{icono:"remove-circle-outline",color:"error",tooltip:"Cancelar",disabled:this.appService.guardando(),eventoClick:t=>this.cancelarCreacion()},{icono:"save-outline",color:"success",tooltip:"Guardar",disabled:this.appService.guardando(),eventoClick:t=>this.onGuardarNuevo()}]),this.columnasPorDefecto=E([{id:"expansor",header:"",size:40,cell:t=>B(be,{inputs:{isExpanded:t.row.getIsExpanded(),disabled:this.appService.editando()},outputs:{toggleExpand:()=>this.onToggleRow(t.row)}})},{id:"nombre",accessorKey:"nombre",header:"Nombre",size:150,cell:this.nombreCell},{id:"grupo",accessorKey:"grupo.nombre",size:150,header:"Grupo",cell:this.grupoCell},{accessorKey:"creado_en",header:"Creado en",size:150,accessorFn:t=>{let o=new Date(t.creado_en);return isNaN(o.getTime())?"Fecha inv\xE1lida":Z(o,"dd/MM/yyyy hh:mm a")},cell:this.fechaCell},{id:"estado",accessorKey:"eliminado_en",header:"Estado",size:400,cell:this.estadoCell},{id:"acciones",header:"Acciones",cell:t=>{let a=t.row.original.id;if(a===-1)return B(W,{inputs:{visibles:t.column.getIsVisible(),acciones:[{tooltip:"Cancelar",icono:"remove-circle-outline",color:"error",disabled:this.appService.guardando(),eventoClick:D=>this.cancelarCreacion()},{tooltip:"Guardar",icono:"save-outline",color:"success",disabled:this.appService.guardando(),eventoClick:D=>this.onGuardarNuevo()}]}});let m=this.configService.filaCategoriaEditando()[a],f=[];this.authService.tienePermisos(this.permisos.EDITAR_CATEGORIAS)&&f.push({tooltip:"Editar",icono:"pencil-outline",color:"accent",disabled:this.appService.editando()||this.appService.guardando(),eventoClick:D=>this.iniciarEdicion(t.row)});let T=m?[{tooltip:"Cancelar",icono:"remove-circle-outline",color:"error",disabled:this.appService.guardando(),eventoClick:D=>this.onCancelarEdicion(t.row)},{tooltip:"Guardar",icono:"save-outline",color:"success",disabled:this.appService.guardando(),eventoClick:D=>this.onGuardarEdicion(t.row)}]:f;return B(W,{inputs:{visibles:t.column.getIsVisible(),acciones:T}})}}]),this.tableState=E({expanded:{}}),this.tablaCategorias=Se(()=>({data:this.categoriasQuery??[],columns:this.columnasPorDefecto(),getCoreRowModel:he(),getPaginationRowModel:xe(),getRowCanExpand:()=>!0,autoResetExpanded:!1,getFilteredRowModel:ve(),getExpandedRowModel:Ce(),manualPagination:!0,autoResetPageIndex:!1,state:{expanded:this.tableState().expanded,pagination:this.configService.paginacionCategorias()},onExpandedChange:t=>{let o=typeof t=="function"?t(this.tableState().expanded):t;this.tableState.update(a=>S(x({},a),{expanded:o}))},onPaginationChange:t=>{let o=typeof t=="function"?t(this.configService.paginacionCategorias()):t;this.configService.setPaginacionCategorias({pageIndex:o.pageIndex,pageSize:o.pageSize})}}))}ngOnInit(){se(()=>{this.configService.pestana(),this.configService.pestana()!=="categorias"&&(this.nombre.reset(null),this.grupo.reset(null),this.reservasEstudiante.reset(null),this.reservasAdministrativo.reset(null),this.reservasExterno.reset(null),this.reservasEgresado.reset(null),this.categoriaEnEdicion.set(null),this.configService.resetAll())},{injector:this.injector})}get categoriasQuery(){let t=this.configService.categoriasQuery.data()||[];return this.modoCreacion()?[{id:-1,nombre:"",id_grupo:void 0,reservas_estudiante:void 0,reservas_administrativo:void 0,reservas_externo:void 0,reservas_egresado:void 0,creado_en:this.fechaActual(),eliminado_en:null,creado_por:this.authService.usuario().id,actualizado_en:"",actualizado_por:null,eliminado_por:null,grupo:void 0},...t]:t}onPageChange(t){this.configService.setPaginacionCategorias(t)}cambiarEstadoConfig(t){let o=t.eliminado_en===null?"inactivo":"activo",a=o==="activo"?"activar":"desactivar";this.appService.setGuardando(!0),this.cdr.detectChanges(),this.alertaService.confirmarAccion(`\xBFEst\xE1s seguro de que quieres ${a} a la categor\xEDa para <strong>${t.nombre}</strong>?`,this.configService.alertaConfig(),`${a.charAt(0).toUpperCase()+a.slice(1)} categoria`,o==="activo"?"success":"warning").then(m=>{m?this.configService.cambiarEstadoCategoria(t.id,o).then(()=>{this.alertaService.success(`Categor\xEDa ${a==="activar"?"activada":"desactivada"} exitosamente.`,5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.configService.categoriasQuery.refetch(),this.appService.categoriasQuery.refetch()}).catch(f=>{console.error(`Error al ${a} el categor\xEDa:`,f),this.alertaService.error(`Error al ${a} el categor\xEDa. Por favor, int\xE9ntalo de nuevo.`,5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}).finally(()=>{this.appService.setGuardando(!1),this.cdr.detectChanges()}):(this.appService.setGuardando(!1),this.cdr.detectChanges())})}crearCategoria(){this.configService.setModoCreacionCategoria(!0),this.appService.setEditando(!0),this.categoriaEnEdicion.set(null),this.nombre.reset(""),this.grupo.reset(null),this.reservasEstudiante.reset(null),this.reservasAdministrativo.reset(null),this.reservasExterno.reset(null),this.reservasEgresado.reset(null),this.cdr.detectChanges()}iniciarEdicion(t){let o=t.original,a=o.id;this.configService.setEditandoFilaCategoria(a,!0),this.categoriaEnEdicion.set(o),this.appService.setEditando(!0),setTimeout(()=>{this.nombre.setValue(o.nombre),this.grupo.setValue(o.id_grupo??null),this.reservasEstudiante.setValue(o.reservas_estudiante??null),this.reservasAdministrativo.setValue(o.reservas_administrativo??null),this.reservasExterno.setValue(o.reservas_externo??null),this.reservasEgresado.setValue(o.reservas_egresado??null),this.nombre.markAsPristine(),this.grupo.markAsPristine(),this.reservasEstudiante.markAsPristine(),this.reservasAdministrativo.markAsPristine(),this.reservasExterno.markAsPristine(),this.reservasEgresado.markAsPristine(),this.onToggleRow(t,!0),this.cdr.detectChanges()},0)}onCancelarEdicion(t){let o=t.original.id;this.configService.setEditandoFilaCategoria(o,!1),this.appService.setEditando(!1),this.categoriaEnEdicion.set(null),this.tableState.update(a=>S(x({},a),{expanded:{}})),this.nombre.reset(null),this.grupo.reset(null),this.reservasEstudiante.reset(null),this.reservasAdministrativo.reset(null),this.reservasExterno.reset(null),this.reservasEgresado.reset(null),this.cdr.detectChanges()}cancelarCreacion(){this.configService.setModoCreacionCategoria(!1),this.appService.setEditando(!1),this.tableState.update(t=>S(x({},t),{expanded:{}})),this.nombre.reset(null),this.grupo.reset(null),this.reservasEstudiante.reset(null),this.reservasAdministrativo.reset(null),this.reservasExterno.reset(null),this.reservasEgresado.reset(null),this.cdr.detectChanges()}onGuardarNuevo(){return _(this,null,function*(){if(this.nombre.markAsTouched(),this.grupo.markAsTouched(),this.nombre.invalid||this.grupo.invalid){this.alertaService.error("Todos los campos son requeridos.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4");return}this.appService.setGuardando(!0);let t={nombre:this.nombre.value?.trim(),id_grupo:this.grupo.value??0,reservas_estudiante:this.reservasEstudiante.value??void 0,reservas_administrativo:this.reservasAdministrativo.value??void 0,reservas_externo:this.reservasExterno.value??void 0,reservas_egresado:this.reservasEgresado.value??void 0};try{yield this.configService.crearCategoria(t),this.alertaService.success("Categoria creada exitosamente.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.tableState.update(o=>S(x({},o),{expanded:{}})),this.cancelarCreacion(),this.configService.categoriasQuery.refetch(),this.appService.categoriasQuery.refetch()}catch(o){console.error("Error al crear categor\xEDa:",o),this.alertaService.error("Error al crear el categor\xEDa. Por favor, int\xE9ntalo de nuevo.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}finally{this.appService.setGuardando(!1)}})}onGuardarEdicion(t){return _(this,null,function*(){if(this.nombre.markAsTouched(),this.grupo.markAsTouched(),this.nombre.invalid||this.grupo.invalid){this.alertaService.error("Por favor, complete todos los campos requeridos.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4");return}this.appService.setGuardando(!0);let o=t.original,a=S(x({},o),{nombre:this.nombre.value,id_grupo:this.grupo.value,reservas_estudiante:this.reservasEstudiante.value??void 0,reservas_administrativo:this.reservasAdministrativo.value??void 0,reservas_externo:this.reservasExterno.value??void 0,reservas_egresado:this.reservasEgresado.value??void 0});try{yield this.configService.actualizarCategoria(o.id,a),this.alertaService.success("Categor\xEDa actualizada exitosamente.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.tableState.update(m=>S(x({},m),{expanded:{}})),this.configService.setEditandoFilaCategoria(o.id,!1),this.appService.setEditando(!1),this.categoriaEnEdicion.set(null),this.nombre.reset(null),this.grupo.reset(null),this.reservasEstudiante.reset(null),this.reservasAdministrativo.reset(null),this.reservasExterno.reset(null),this.reservasEgresado.reset(null),this.configService.categoriasQuery.refetch(),this.appService.categoriasQuery.refetch(),this.cdr.detectChanges()}catch(m){console.error("Error al actualizar la categor\xEDa:",m),this.alertaService.error("Error al actualizar la categor\xEDa. Por favor, int\xE9ntalo de nuevo.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}finally{this.appService.setGuardando(!1)}})}onToggleRow(t,o=!1){let a=t.id,m=this.tableState().expanded,f;o?f={[a]:!0}:(f=m[a]?{}:{[a]:!0},m[a]&&this.configService.setCategoriaeleccionada(null)),this.tableState.update(T=>S(x({},T),{expanded:f}))}ngOnDestroy(){this.configService.setModoCreacionCategoria(!1),this.appService.setEditando(!1),this.configService.setEditandoFilaCategoria(0,!1),this.categoriaEnEdicion.set(null),this.appService.setGuardando(!1),this.nombre.reset(null),this.grupo.reset(null),this.reservasEstudiante.reset(null),this.reservasAdministrativo.reset(null),this.reservasExterno.reset(null),this.reservasEgresado.reset(null),this.cdr.detectChanges()}};n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=J({type:n,selectors:[["config-categorias"]],viewQuery:function(o,a){o&1&&(R(a.estadoCell,Ct,5),R(a.nombreCell,vt,5),R(a.grupoCell,xt,5),R(a.fechaCell,Et,5)),o&2&&Y(4)},decls:19,vars:9,consts:[["estadoCell",""],["nombreCell",""],["grupoCell",""],["fechaCell",""],["tablaCategoria","responsiveTable"],["alertaRoles",""],["responsiveTable","",1,"table","w-full","rounded-box","table-sm","sm:table-md",3,"table"],[1,"sticky","top-0","z-20","bg-base-100"],[3,"cambioPaginacion","prefetchFunction","ngClass","estado","paginacion","mostrarInfo","mostrarSelectorTamano","mostrarExtremos","deshabilitado"],[1,"badge","font-semibold","badge-info"],[3,"ngClass"],[3,"click","ngClass"],["placeholder","Inserte nombre","pattern","[a-zA-Z0-9\xE1\xE9\xED\xF3\xFA ]*","type","text",1,"input","input-sm","h-9","placeholder:text-gray-400",3,"formControl"],[1,"font-semibold","text-sm","md:text-base"],[1,"select","input-sm","h-9","placeholder:text-gray-400",3,"formControl"],[1,"text-sm","md:text-base"],["value","","disabled","","selected",""],[3,"value"],[1,"p-2","text-left","first:rounded-tl-md","last:rounded-tr-md","bg-base-100","z-20",3,"colSpan"],[4,"flexRender","flexRenderProps"],[1,"text-left",3,"innerHTML"],[1,"text-center","text-gray-500"],[1,"bg-base-100"],[1,"py-1"],[1,"bg-base-300","border-none"],[3,"innerHTML"],[1,"bg-base-100","rounded-md","p-2","md:p-4","shadow-md","w-full"],[1,"text-lg","font-semibold","mb-1","md:mb-4","text-center"],[1,"grid","w-full","grid-cols-[repeat(auto-fit,minmax(11rem,1fr))]","gap-2","md:gap-4"],[1,"flex","flex-col"],[1,"font-bold","text-base-content","max-sm:text-xs","text-sm","mb-2"],["type","number","min","0","placeholder","N\xFAmero de reservas",1,"input","input-sm","h-9","w-full",3,"formControl"],[1,"p-2","bg-base-200","rounded"],[1,"divider","max-md:my-1","my-4"],[1,"space-y-2"],[1,"flex","my-2","flex-row","gap-2","items-center"],[1,"font-bold","text-base-content"]],template:function(o,a){if(o&1){let m=U();G(0,wt,2,1,"ng-template",null,0,F)(2,Gt,2,1,"ng-template",null,1,F)(4,$t,2,1,"ng-template",null,2,F)(6,Mt,2,1,"ng-template",null,3,F),c(8,"table",6,4)(10,"thead",7),P(11,Qt,3,0,"tr",null,Ve),s(),c(13,"tbody"),u(14,qt,4,1,"tr")(15,ni,2,0),s()(),c(16,"app-paginador",8),Q("cambioPaginacion",function(T){return V(m),M(a.onPageChange(T))})("prefetchFunction",function(T){return V(m),M(a.configService.prefetchCategorias(T))}),s(),G(17,oi,0,0,"ng-template",null,5,F)}o&2&&(l(8),d("table",a.tablaCategorias()),l(3),A(a.tablaCategorias().getHeaderGroups()),l(3),g(!a.categoriasQuery.length&&!a.modoCreacion()?14:15),l(2),d("ngClass","flex flex-col sm:flex-row items-center justify-between gap-4 p-4 bg-base-100 sticky bottom-0 z-10 rounded-b-box")("estado",a.configService.paginacionCategorias())("paginacion",a.configService.datosPaginadorCategorias()??null)("mostrarInfo",!0)("mostrarSelectorTamano",!0)("mostrarExtremos",!0)("deshabilitado",a.configService.categoriasQuery.isFetching()))},dependencies:[te,ee,ye,Ee,ge,Pe,Ae,de,Fe,Ge,pe,ue,Re,me,K,we],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});let e=n;return e})();var ai=["estadoCell"],ri=["nombreCell"],li=["fechaCell"],si=(e,n,i,t,o)=>({"badge font-semibold min-w-20 hover:cursor-pointer hover:scale-105 transition-all tooltip align-middle":!0,"tooltip-right":e,"tooltip-left":n,"badge-success":i,"badge-error":t,"opacity-50 pointer-events-none badge-ghost":o}),Me=(e,n)=>n.id;function ci(e,n){e&1&&(c(0,"span",8),p(1,"Nuevo"),s())}function di(e,n){if(e&1){let i=U();c(0,"div",10),Q("click",function(){V(i);let o=r().$implicit,a=r();return M(a.authService.tienePermisos("ESP000012")?a.appService.editando()?null:a.cambiarEstadoConfig(o.row.original):null)}),p(1),j(2,"upperFirst"),s()}if(e&2){let i=r().$implicit,t=r();d("ngClass",re(6,si,!i.column.getIsVisible(),i.column.getIsVisible(),i.getValue()===null,i.getValue()!==null,t.appService.editando())),N("data-tip",i.getValue()===null?"Desactivar":"Activar")("disabled",t.appService.guardando()),l(),y(" ",le(2,4,i.getValue()===null?"activo":"inactivo")," ")}}function pi(e,n){if(e&1&&u(0,ci,2,0,"span",8)(1,di,3,12,"div",9),e&2){let i=n.$implicit;g(i.row.original.id===-1?0:1)}}function mi(e,n){if(e&1&&v(0,"input",11),e&2){let i=r(2);d("formControl",i.nombre)}}function ui(e,n){if(e&1&&(c(0,"span",12),p(1),s()),e&2){let i=r().$implicit;l(),O(i.getValue())}}function gi(e,n){if(e&1&&u(0,mi,1,1,"input",11)(1,ui,2,1,"span",12),e&2){let i=n.$implicit,t=r();g(i.row.original.id===-1||t.configService.filaGrupoEditando()[i.row.original.id]?0:1)}}function _i(e,n){if(e&1&&(c(0,"span"),p(1),s()),e&2){let i=r(2);l(),O(i.fechaActual())}}function fi(e,n){if(e&1&&(c(0,"span"),p(1),s()),e&2){let i=r().$implicit;l(),y(" ",i.getValue()," ")}}function hi(e,n){if(e&1&&u(0,_i,2,1,"span")(1,fi,2,1,"span"),e&2){let i=n.$implicit,t=r();g(i.row.original.id===-1||t.configService.filaGrupoEditando()[i.row.original.id]?0:1)}}function Ci(e,n){if(e&1&&(H(0),v(1,"span",15),L()),e&2){let i=n.$implicit;l(),d("innerHTML",i,q)}}function vi(e,n){if(e&1&&G(0,Ci,2,1,"ng-container",14),e&2){let i=r().$implicit;d("flexRender",i.column.columnDef.header)("flexRenderProps",i.getContext())}}function xi(e,n){if(e&1&&(c(0,"th",13),u(1,vi,1,2,"ng-container"),s()),e&2){let i=n.$implicit;d("colSpan",i.colSpan),l(),g(i.isPlaceholder?-1:1)}}function Ei(e,n){if(e&1&&(c(0,"tr"),P(1,xi,2,2,"th",13,Me),s()),e&2){let i=n.$implicit;l(),A(i.headers)}}function Si(e,n){if(e&1&&(c(0,"tr")(1,"td",16)(2,"span"),p(3,"No hay grupos a\xFAn..."),s()()()),e&2){let i=r(),t=z(7);l(),N("colspan",i.tablaGrupos().getAllColumns().length+(t.hiddenColumnIds().size>0?1:0))}}function bi(e,n){if(e&1&&v(0,"input",20),e&2){let i=r(5);d("formControl",i.nombre)}}function yi(e,n){if(e&1&&u(0,bi,1,1,"input",20),e&2){let i,t=r().$implicit;g((i=t.column.id)==="nombre"?0:-1)}}function wi(e,n){if(e&1&&(H(0),v(1,"div",21),L()),e&2){let i=n.$implicit;l(),d("innerHTML",i,q)}}function Ti(e,n){if(e&1&&G(0,wi,2,1,"ng-container",14),e&2){let i=r().$implicit;d("flexRender",i.column.columnDef.cell)("flexRenderProps",i.getContext())}}function Fi(e,n){if(e&1&&(c(0,"td",18),u(1,yi,1,1)(2,Ti,1,2,"ng-container"),s()),e&2){let i=n.$implicit,t=r().$implicit,o=r(2);l(),g(o.esColumnaEditable(i.column.id)&&o.configService.filaGrupoEditando()[t.original.id]?1:2)}}function Gi(e,n){if(e&1&&(H(0),v(1,"div",21),L()),e&2){let i=n.$implicit;l(),d("innerHTML",i,q)}}function Pi(e,n){if(e&1&&(c(0,"li",24)(1,"span",25),p(2),s(),c(3,"span"),G(4,Gi,2,1,"ng-container",14),s()()),e&2){let i=r().$implicit,t=r(3).$implicit;r(2);let o=z(7);l(2),y(" ",i.columnDef.header,": "),l(2),d("flexRender",o.getCell(i,t).column.columnDef.cell)("flexRenderProps",o.getCell(i,t).getContext())}}function Ai(e,n){if(e&1&&u(0,Pi,5,3,"li",24),e&2){let i=n.$implicit;r(5);let t=z(7);g(t.hiddenColumnIds().has(i.id)?0:-1)}}function Ri(e,n){if(e&1&&(c(0,"ul"),P(1,Ai,1,1,null,null,X),s(),v(3,"div",23)),e&2){let i=r(4);l(),A(i.tablaGrupos().getAllLeafColumns())}}function $i(e,n){if(e&1&&(c(0,"tr",19)(1,"td")(2,"div",22),u(3,Ri,4,0),s()()()),e&2){let i=r().$implicit;r(2);let t=z(7);l(),N("colspan",i.getVisibleCells().length+(t.hiddenColumnIds().size>0?1:0)),l(2),g(t.hiddenColumnIds().size!==0?3:-1)}}function Ii(e,n){if(e&1&&(c(0,"tr",17),P(1,Fi,3,1,"td",18,Me),s(),u(3,$i,4,2,"tr",19)),e&2){let i=n.$implicit;r(2);let t=z(7);l(),A(i.getVisibleCells()),l(2),g(i.getIsExpanded()&&t.hiddenColumnIds().size!==0?3:-1)}}function Vi(e,n){if(e&1&&P(0,Ii,4,1,null,null,Me),e&2){let i=r();A(i.tablaGrupos().getRowModel().rows)}}function Mi(e,n){}var ot=(()=>{let n=class n{constructor(){this.injector=C(ae),this.upperFirstPipe=C(K),this.alertaService=C(fe),this.cdr=C(ce),this.grupoEnEdicion=E(null),this.configService=C(oe),this.appService=C(ne),this.authService=C(ie),this.permisos=_e,this.fechaActual=h(()=>Z(new Date,"dd/MM/yyyy HH:mm a")),this.nombre=new k(null,[I.required,I.minLength(3)]),this.modoCreacion=h(()=>this.configService.modoCreacionGrupo()),this.estadoCell=$.required("estadoCell"),this.nombreCell=$.required("nombreCell"),this.fechaCell=$.required("fechaCell"),this.accionesNuevo=h(()=>[{icono:"remove-circle-outline",color:"error",tooltip:"Cancelar",disabled:this.appService.guardando(),eventoClick:t=>this.cancelarCreacion()},{icono:"save-outline",color:"success",tooltip:"Guardar",disabled:this.appService.guardando(),eventoClick:t=>this.onGuardarNuevo()}]),this.columnasPorDefecto=h(()=>[{id:"expansor",header:"",size:40,cell:t=>B(be,{inputs:{isExpanded:t.row.getIsExpanded(),disabled:this.appService.editando()},outputs:{toggleExpand:()=>this.onToggleRow(t.row)}})},{id:"nombre",accessorKey:"nombre",header:"Nombre",size:150,cell:this.nombreCell},{accessorKey:"creado_en",header:"Creado en",size:150,accessorFn:t=>{let o=new Date(t.creado_en);return isNaN(o.getTime())?"Fecha inv\xE1lida":Z(o,"dd/MM/yyyy hh:mm a")},cell:this.fechaCell},{id:"estado",accessorKey:"eliminado_en",header:"Estado",size:400,cell:this.estadoCell},{id:"acciones",header:"Acciones",cell:t=>{let a=t.row.original.id;if(a===-1)return B(W,{inputs:{visibles:t.column.getIsVisible(),acciones:[{tooltip:"Cancelar",icono:"remove-circle-outline",color:"error",disabled:this.appService.guardando(),eventoClick:D=>this.cancelarCreacion()},{tooltip:"Guardar",icono:"save-outline",color:"success",disabled:this.appService.guardando(),eventoClick:D=>this.onGuardarNuevo()}]}});let m=this.configService.filaGrupoEditando()[a],f=[];this.authService.tienePermisos(this.permisos.EDITAR_GRUPOS)&&f.push({tooltip:"Editar",icono:"pencil-outline",color:"accent",disabled:this.appService.editando()||this.appService.guardando(),eventoClick:D=>this.iniciarEdicion(t.row)});let T=m?[{tooltip:"Cancelar",icono:"remove-circle-outline",color:"error",disabled:this.appService.guardando(),eventoClick:D=>this.onCancelarEdicion(t.row)},{tooltip:"Guardar",icono:"save-outline",color:"success",disabled:this.appService.guardando(),eventoClick:D=>this.onGuardarEdicion(t.row)}]:f;return B(W,{inputs:{visibles:t.column.getIsVisible(),acciones:T}})}}]),this.tableState=E({expanded:{}}),this.tablaGrupos=Se(()=>({data:this.gruposQuery??[],columns:this.columnasPorDefecto(),getCoreRowModel:he(),getPaginationRowModel:xe(),getRowCanExpand:()=>!0,autoResetExpanded:!1,getFilteredRowModel:ve(),getExpandedRowModel:Ce(),manualPagination:!0,autoResetPageIndex:!1,state:{expanded:this.tableState().expanded,pagination:this.configService.paginacionGrupos()},onExpandedChange:t=>{let o=typeof t=="function"?t(this.tableState().expanded):t;this.tableState.update(a=>S(x({},a),{expanded:o}))},onPaginationChange:t=>{let o=typeof t=="function"?t(this.configService.paginacionGrupos()):t;this.configService.setPaginacionGrupos({pageIndex:o.pageIndex,pageSize:o.pageSize})}}))}ngOnInit(){se(()=>{this.configService.pestana(),this.configService.pestana()!=="grupos"&&(this.nombre.reset(),this.grupoEnEdicion.set(null),this.configService.resetAll())},{injector:this.injector})}get gruposQuery(){let t=this.configService.gruposQuery.data()||[];return this.modoCreacion()?[{id:-1,nombre:"",creado_en:new Date().toISOString(),actualizado_en:"",eliminado_en:null,creado_por:0,actualizado_por:null,eliminado_por:null},...t]:t}onToggleRow(t,o=!1){if(this.modoCreacion()&&t.original.id!==-1)return;let a=t.id,m=this.tableState().expanded,f;o?f={[a]:!0}:f=m[a]?{}:{[a]:!0},this.tableState.update(T=>S(x({},T),{expanded:f}))}onPageChange(t){this.configService.setPaginacionGrupos(t)}esColumnaEditable(t){return["nombre"].includes(t)}cambiarEstadoConfig(t){let o=t.eliminado_en===null?"inactivo":"activo",a=o==="activo"?"activar":"desactivar";this.appService.setGuardando(!0),this.cdr.detectChanges(),this.alertaService.confirmarAccion(`\xBFEst\xE1s seguro de que quieres ${a} el grupo <strong>${t.nombre}</strong>?`,this.configService.alertaConfig(),`${a.charAt(0).toUpperCase()+a.slice(1)} grupo`,o==="activo"?"success":"warning").then(m=>{m?this.configService.cambiarEstadoGrupo(t.id,o).then(()=>{this.alertaService.success(`Grupo ${a==="activar"?"activado":"desactivado"} exitosamente.`,5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.configService.gruposQuery.refetch(),this.appService.gruposQuery.refetch()}).catch(f=>{console.error(`Error al ${a} el grupo:`,f),this.alertaService.error(`Error al ${a} el grupo. Por favor, int\xE9ntalo de nuevo.`,5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}).finally(()=>{this.appService.setGuardando(!1),this.cdr.detectChanges()}):(this.appService.setGuardando(!1),this.cdr.detectChanges())})}crearGrupo(){this.configService.setModoCreacionGrupo(!0),this.grupoEnEdicion.set(null),this.nombre.reset(""),this.cdr.detectChanges()}iniciarEdicion(t){let o=t.original,a=o.id;this.configService.setEditandoFilaGrupo(a,!0),this.grupoEnEdicion.set(o),this.appService.setEditando(!0),this.onToggleRow(t,!0),setTimeout(()=>{this.nombre.setValue(o.nombre),this.nombre.markAsPristine(),this.cdr.detectChanges()},0)}onCancelarEdicion(t){let o=t.original.id;this.configService.setEditandoFilaGrupo(o,!1),this.configService.setModoCreacionGrupo(!1),this.appService.setEditando(!1),this.grupoEnEdicion.set(null),this.nombre.reset(""),this.cdr.detectChanges()}cancelarCreacion(){this.configService.setModoCreacionGrupo(!1),this.appService.setEditando(!1),this.nombre.reset(""),this.cdr.detectChanges()}onGuardarNuevo(){return _(this,null,function*(){if(this.nombre.markAsTouched(),this.nombre.invalid){this.alertaService.error("Todos los campos son requeridos.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4");return}this.appService.setGuardando(!0),this.cdr.detectChanges();let t={nombre:this.nombre.value?.trim()};try{yield this.configService.crearGrupo(t),this.alertaService.success("Grupo creado exitosamente.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.cancelarCreacion(),this.configService.gruposQuery.refetch(),this.appService.gruposQuery.refetch()}catch(o){console.error("Error al crear grupo:",o),this.alertaService.error("Error al crear el grupo. Por favor, int\xE9ntalo de nuevo.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}finally{this.appService.setGuardando(!1)}})}onGuardarEdicion(t){return _(this,null,function*(){if(this.nombre.markAsTouched(),this.nombre.invalid){this.alertaService.error("Por favor, complete todos los campos requeridos.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4");return}this.appService.setGuardando(!0),this.cdr.detectChanges();let o=t.original,a=S(x({},o),{nombre:this.nombre.value});try{yield this.configService.actualizarGrupo(o.id,a),this.alertaService.success("Grupo actualizado exitosamente.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.configService.setEditandoFilaGrupo(o.id,!1),this.appService.setEditando(!1),this.grupoEnEdicion.set(null),this.nombre.reset(""),this.configService.gruposQuery.refetch(),this.appService.gruposQuery.refetch(),this.cdr.detectChanges()}catch(m){console.error("Error al actualizar el grupo:",m),this.alertaService.error("Error al actualizar el grupo. Por favor, int\xE9ntalo de nuevo.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}finally{this.appService.setGuardando(!1),this.cdr.detectChanges()}})}ngOnDestroy(){this.configService.setModoCreacionGrupo(!1),this.appService.setEditando(!1),this.configService.setEditandoFilaGrupo(0,!1),this.grupoEnEdicion.set(null),this.appService.setGuardando(!1),this.nombre.reset()}};n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=J({type:n,selectors:[["config-grupos"]],viewQuery:function(o,a){o&1&&(R(a.estadoCell,ai,5),R(a.nombreCell,ri,5),R(a.fechaCell,li,5)),o&2&&Y(3)},decls:17,vars:9,consts:[["estadoCell",""],["nombreCell",""],["fechaCell",""],["tablaGrupo","responsiveTable"],["alertaGrupos",""],["responsiveTable","",1,"table","w-full","rounded-md","table-sm","sm:table-md",3,"table"],[1,"sticky","top-0","z-20","bg-base-100"],[3,"cambioPaginacion","prefetchFunction","ngClass","estado","paginacion","mostrarInfo","mostrarSelectorTamano","mostrarExtremos","deshabilitado"],[1,"badge","font-semibold","badge-info"],[3,"ngClass"],[3,"click","ngClass"],["placeholder","Inserte nombre del grupo","pattern","[a-zA-Z0-9\xE1\xE9\xED\xF3\xFA ]*","type","text",1,"input","input-sm","h-9","placeholder:text-gray-400",3,"formControl"],[1,"font-semibold","text-sm","md:text-base"],[1,"p-2","text-left","first:rounded-tl-md","last:rounded-tr-md","bg-base-100","z-20",3,"colSpan"],[4,"flexRender","flexRenderProps"],[1,"text-left",3,"innerHTML"],[1,"text-center","text-gray-500"],[1,"bg-base-100"],[1,"p-2"],[1,"bg-base-300","border-none"],["placeholder","Inserte nombre","pattern","[a-zA-Z0-9\xE1\xE9\xED\xF3\xFA ]*","type","text",1,"input","input-sm","h-9","placeholder:text-gray-400",3,"formControl"],[3,"innerHTML"],[1,"bg-base-100","rounded-md","p-1","px-3","shadow-md","w-full"],[1,"divider","my-1"],[1,"flex","my-2","flex-row","gap-2","items-center"],[1,"font-bold","text-base-content"]],template:function(o,a){if(o&1){let m=U();G(0,pi,2,1,"ng-template",null,0,F)(2,gi,2,1,"ng-template",null,1,F)(4,hi,2,1,"ng-template",null,2,F),c(6,"table",5,3)(8,"thead",6),P(9,Ei,3,0,"tr",null,Me),s(),c(11,"tbody"),u(12,Si,4,1,"tr")(13,Vi,2,0),s()(),c(14,"app-paginador",7),Q("cambioPaginacion",function(T){return V(m),M(a.onPageChange(T))})("prefetchFunction",function(T){return V(m),M(a.configService.prefetchGrupos(T))}),s(),G(15,Mi,0,0,"ng-template",null,4,F)}o&2&&(l(6),d("table",a.tablaGrupos()),l(3),A(a.tablaGrupos().getHeaderGroups()),l(3),g(!a.gruposQuery.length&&!a.modoCreacion()?12:13),l(2),d("ngClass","flex flex-col sm:flex-row items-center justify-between gap-4 p-4 bg-base-100 sticky bottom-0 z-10 rounded-b-box")("estado",a.configService.paginacionGrupos())("paginacion",a.configService.datosPaginadorGrupos()??null)("mostrarInfo",!0)("mostrarSelectorTamano",!0)("mostrarExtremos",!0)("deshabilitado",a.configService.gruposQuery.isFetching()))},dependencies:[te,ee,ye,Ee,ge,de,pe,ue,me,we,K],styles:["[_nghost-%COMP%]{display:block}"]});let e=n;return e})();var ki=["estadoCell"],zi=["nombreCell"],Di=["espacioCell"],Qi=["fechaCell"],qi=["cantidadCell"],Ni=["valorEstudianteCell"],Hi=["valorAdministrativoCell"],Li=["valorEgresadoCell"],Ui=(e,n,i,t,o)=>({"badge font-semibold min-w-20 hover:cursor-pointer hover:scale-105 transition-all tooltip align-middle":!0,"tooltip-right":e,"tooltip-left":n,"badge-success":i,"badge-error":t,"opacity-50 pointer-events-none badge-ghost":o}),ke=(e,n)=>n.id;function Bi(e,n){e&1&&(c(0,"span",13),p(1,"Nuevo"),s())}function Oi(e,n){if(e&1){let i=U();c(0,"div",15),Q("click",function(){V(i);let o=r().$implicit,a=r();return M(a.authService.tienePermisos("ESP000012")?a.appService.editando()?null:a.cambiarEstadoConfig(o.row.original):null)}),p(1),j(2,"upperFirst"),s()}if(e&2){let i=r().$implicit,t=r();d("ngClass",re(6,Ui,!i.column.getIsVisible(),i.column.getIsVisible(),i.getValue()===null,i.getValue()!==null,t.appService.editando())),N("data-tip",i.getValue()===null?"Desactivar":"Activar")("disabled",t.appService.guardando()),l(),y(" ",le(2,4,i.getValue()===null?"activo":"inactivo")," ")}}function ji(e,n){if(e&1&&u(0,Bi,2,0,"span",13)(1,Oi,3,12,"div",14),e&2){let i=n.$implicit;g(i.row.original.id===-1?0:1)}}function Ki(e,n){if(e&1&&v(0,"input",16),e&2){let i=r(2);d("formControl",i.nombre)}}function Zi(e,n){if(e&1&&(c(0,"span",17),p(1),s()),e&2){let i=r().$implicit;l(),O(i.getValue())}}function Wi(e,n){if(e&1&&u(0,Ki,1,1,"input",16)(1,Zi,2,1,"span",17),e&2){let i=n.$implicit,t=r();g(i.row.original.id===-1||t.configService.filaElementoEditando()[i.row.original.id]?0:1)}}function Ji(e,n){if(e&1&&v(0,"input",18),e&2){let i=r(2);d("formControl",i.cantidad)}}function Xi(e,n){if(e&1&&(c(0,"span",17),p(1),s()),e&2){let i=r().$implicit;l(),O(i.getValue())}}function Yi(e,n){if(e&1&&u(0,Ji,1,1,"input",18)(1,Xi,2,1,"span",17),e&2){let i=n.$implicit,t=r();g(i.row.original.id===-1||t.configService.filaElementoEditando()[i.row.original.id]?0:1)}}function en(e,n){if(e&1&&(c(0,"option",22),p(1),s()),e&2){let i=n.$implicit;d("value",i.id),l(),y(" ",i.nombre," ")}}function tn(e,n){if(e&1&&(c(0,"select",19)(1,"option",21),p(2,"Seleccione"),s(),P(3,en,2,2,"option",22,X),s()),e&2){let i=r(2);d("formControl",i.espacio),l(),d("value",0),l(2),A(i.appService.espaciosQuery.data())}}function nn(e,n){if(e&1&&(c(0,"span",20),p(1),s()),e&2){let i=r().$implicit,t=r();l(),y(" ",t.obtenerEspacioSelect(i.row.original.id_espacio)," ")}}function on(e,n){if(e&1&&u(0,tn,5,2,"select",19)(1,nn,2,1,"span",20),e&2){let i=n.$implicit,t=r();g(i.row.original.id===-1||t.configService.filaElementoEditando()[i.row.original.id]?0:1)}}function an(e,n){if(e&1&&(c(0,"span"),p(1),s()),e&2){let i=r(2);l(),O(i.fechaActual())}}function rn(e,n){if(e&1&&(c(0,"span"),p(1),s()),e&2){let i=r().$implicit;l(),y(" ",i.getValue()," ")}}function ln(e,n){if(e&1&&u(0,an,2,1,"span")(1,rn,2,1,"span"),e&2){let i=n.$implicit,t=r();g(i.row.original.id===-1||t.configService.filaElementoEditando()[i.row.original.id]?0:1)}}function sn(e,n){if(e&1&&v(0,"input",23),e&2){let i=r(2);d("formControl",i.valorEstudiante)}}function cn(e,n){if(e&1&&(c(0,"span"),p(1),j(2,"currency"),s()),e&2){let i=r().$implicit;l(),y(" ",Te(2,1,i.row.original.valor_estudiante??0,"$","symbol","1.0-0")," ")}}function dn(e,n){if(e&1&&u(0,sn,1,1,"input",23)(1,cn,3,6,"span"),e&2){let i=n.$implicit,t=r();g(i.row.original.id===-1||t.configService.filaElementoEditando()[i.row.original.id]?0:1)}}function pn(e,n){if(e&1&&v(0,"input",23),e&2){let i=r(2);d("formControl",i.valorAdministrativo)}}function mn(e,n){if(e&1&&(c(0,"span"),p(1),j(2,"currency"),s()),e&2){let i=r().$implicit;l(),y(" ",Te(2,1,i.row.original.valor_administrativo??0,"$","symbol","1.0-0")," ")}}function un(e,n){if(e&1&&u(0,pn,1,1,"input",23)(1,mn,3,6,"span"),e&2){let i=n.$implicit,t=r();g(i.row.original.id===-1||t.configService.filaElementoEditando()[i.row.original.id]?0:1)}}function gn(e,n){if(e&1&&v(0,"input",23),e&2){let i=r(2);d("formControl",i.valorEgresado)}}function _n(e,n){if(e&1&&(c(0,"span"),p(1),j(2,"currency"),s()),e&2){let i=r().$implicit;l(),y(" ",Te(2,1,i.row.original.valor_egresado??0,"$","symbol","1.0-0")," ")}}function fn(e,n){if(e&1&&u(0,gn,1,1,"input",23)(1,_n,3,6,"span"),e&2){let i=n.$implicit,t=r();g(i.row.original.id===-1||t.configService.filaElementoEditando()[i.row.original.id]?0:1)}}function hn(e,n){if(e&1&&(H(0),v(1,"span",26),L()),e&2){let i=n.$implicit;l(),d("innerHTML",i,q)}}function Cn(e,n){if(e&1&&G(0,hn,2,1,"ng-container",25),e&2){let i=r().$implicit;d("flexRender",i.column.columnDef.header)("flexRenderProps",i.getContext())}}function vn(e,n){if(e&1&&(c(0,"th",24),u(1,Cn,1,2,"ng-container"),s()),e&2){let i=n.$implicit;d("colSpan",i.colSpan),l(),g(i.isPlaceholder?-1:1)}}function xn(e,n){if(e&1&&(c(0,"tr"),P(1,vn,2,2,"th",24,ke),s()),e&2){let i=n.$implicit;l(),A(i.headers)}}function En(e,n){if(e&1&&(c(0,"tr")(1,"td",27)(2,"span"),p(3,"No hay elementos a\xFAn..."),s()()()),e&2){let i=r(),t=z(17);l(),N("colspan",i.tablaElementos().getAllColumns().length+(t.hiddenColumnIds().size>0?1:0))}}function Sn(e,n){if(e&1&&(H(0),v(1,"div",31),L()),e&2){let i=n.$implicit;l(),d("innerHTML",i,q)}}function bn(e,n){if(e&1&&(c(0,"td",29),G(1,Sn,2,1,"ng-container",25),s()),e&2){let i=n.$implicit;l(),d("flexRender",i.column.columnDef.cell)("flexRenderProps",i.getContext())}}function yn(e,n){if(e&1&&(H(0),v(1,"div",31),L()),e&2){let i=n.$implicit;l(),d("innerHTML",i,q)}}function wn(e,n){if(e&1&&(c(0,"li",35)(1,"span",36),p(2),s(),c(3,"span"),G(4,yn,2,1,"ng-container",25),s()()),e&2){let i=r().$implicit,t=r(3).$implicit;r(2);let o=z(17);l(2),y(" ",i.columnDef.header,": "),l(2),d("flexRender",o.getCell(i,t).column.columnDef.cell)("flexRenderProps",o.getCell(i,t).getContext())}}function Tn(e,n){if(e&1&&u(0,wn,5,3,"li",35),e&2){let i=n.$implicit;r(5);let t=z(17);g(t.hiddenColumnIds().has(i.id)?0:-1)}}function Fn(e,n){if(e&1&&(c(0,"div",33)(1,"ul"),P(2,Tn,1,1,null,null,X),s()()),e&2){let i=r(4);l(2),A(i.tablaElementos.getAllLeafColumns())}}function Gn(e,n){e&1&&(c(0,"span",34),p(1,"No hay detalles adicionales."),s())}function Pn(e,n){if(e&1&&(c(0,"tr",30)(1,"td")(2,"div",32),u(3,Fn,4,0,"div",33)(4,Gn,2,0,"span",34),s()()()),e&2){let i=r().$implicit;r(2);let t=z(17);l(),N("colspan",i.getVisibleCells().length+1),l(2),g(t.hiddenColumnIds().size!==0?3:4)}}function An(e,n){if(e&1&&(c(0,"tr",28),P(1,bn,2,2,"td",29,ke),s(),u(3,Pn,5,2,"tr",30)),e&2){let i=n.$implicit;l(),A(i.getVisibleCells()),l(2),g(i.getIsExpanded()?3:-1)}}function Rn(e,n){if(e&1&&P(0,An,4,1,null,null,ke),e&2){let i=r();A(i.tablaElementos().getRowModel().rows)}}function $n(e,n){}var at=(()=>{let n=class n{constructor(){this.injector=C(ae),this.upperFirstPipe=C(K),this.alertaService=C(fe),this.cdr=C(ce),this.elementoEnEdicion=E(null),this.configService=C(oe),this.appService=C(ne),this.authService=C(ie),this.permisos=_e,this.fechaActual=h(()=>Z(new Date,"dd/MM/yyyy HH:mm a")),this.nombre=new k(null,[I.required,I.minLength(3)]),this.cantidad=new k(null,[I.required]),this.espacio=new k(null,[I.required]),this.valorEstudiante=new k(null,[I.min(0)]),this.valorAdministrativo=new k(null,[I.min(0)]),this.valorExterno=new k(null,[I.min(0)]),this.valorEgresado=new k(null,[I.min(0)]),this.modoCreacion=h(()=>this.configService.modoCreacionElemento()),this.estadoCell=$.required("estadoCell"),this.nombreCell=$.required("nombreCell"),this.espacioCell=$.required("espacioCell"),this.fechaCell=$.required("fechaCell"),this.cantidadCell=$.required("cantidadCell"),this.valorEstudianteCell=$.required("valorEstudianteCell"),this.valorAdministrativoCell=$.required("valorAdministrativoCell"),this.valorEgresadoCell=$.required("valorEgresadoCell"),this.accionesNuevo=h(()=>[{icono:"remove-circle-outline",color:"error",tooltip:"Cancelar",disabled:this.appService.guardando(),eventoClick:t=>this.cancelarCreacion()},{icono:"save-outline",color:"success",tooltip:"Guardar",disabled:this.appService.guardando(),eventoClick:t=>this.onGuardarNuevo()}]),this.columnasPorDefecto=E([{id:"expansor",header:"",size:40,cell:t=>B(be,{inputs:{isExpanded:t.row.getIsExpanded(),disabled:this.appService.editando()},outputs:{toggleExpand:()=>this.onToggleRow(t.row)}})},{id:"nombre",accessorKey:"nombre",header:"Nombre",size:150,cell:this.nombreCell},{id:"valor_estudiante",header:"Estudiante",size:140,accessorKey:"valor_estudiante",cell:this.valorEstudianteCell},{id:"valor_administrativo",header:"Administrativo",size:160,accessorKey:"valor_administrativo",cell:this.valorAdministrativoCell},{id:"valor_egresado",header:"Egresado",size:140,accessorKey:"valor_egresado",cell:this.valorEgresadoCell},{accessorKey:"creado_en",header:"Creado en",size:150,accessorFn:t=>{let o=new Date(t.creado_en);return isNaN(o.getTime())?"Fecha inv\xE1lida":Z(o,"dd/MM/yyyy hh:mm a")},cell:this.fechaCell},{id:"estado",accessorKey:"eliminado_en",header:"Estado",size:400,cell:this.estadoCell},{id:"acciones",header:"Acciones",meta:{priority:1/0},cell:t=>{let a=t.row.original.id;if(a===-1)return B(W,{inputs:{visibles:t.column.getIsVisible(),acciones:[{tooltip:"Cancelar",icono:"remove-circle-outline",color:"error",disabled:this.appService.guardando(),eventoClick:D=>this.cancelarCreacion()},{tooltip:"Guardar",icono:"save-outline",color:"success",disabled:this.appService.guardando(),eventoClick:D=>this.onGuardarNuevo()}]}});let m=this.configService.filaElementoEditando()[a],f=[];this.authService.tienePermisos(this.permisos.EDITAR_ELEMENTOS)&&f.push({tooltip:"Editar",icono:"pencil-outline",color:"accent",disabled:this.appService.editando()||this.appService.guardando(),eventoClick:D=>this.iniciarEdicion(t.row)});let T=m?[{tooltip:"Cancelar",icono:"remove-circle-outline",color:"error",disabled:this.appService.guardando(),eventoClick:D=>this.onCancelarEdicion(t.row)},{tooltip:"Guardar",icono:"save-outline",color:"success",disabled:this.appService.guardando(),eventoClick:D=>this.onGuardarEdicion(t.row)}]:f;return B(W,{inputs:{visibles:t.column.getIsVisible(),acciones:T}})}}]),this.tableState=E({expanded:{}}),this.tablaElementos=Se(()=>({data:this.elementosQuery??[],columns:this.columnasPorDefecto(),getCoreRowModel:he(),getPaginationRowModel:xe(),getRowCanExpand:()=>!0,autoResetExpanded:!1,getFilteredRowModel:ve(),getExpandedRowModel:Ce(),manualPagination:!0,autoResetPageIndex:!1,state:{expanded:this.tableState().expanded,pagination:this.configService.paginacionElementos()},onExpandedChange:t=>{let o=typeof t=="function"?t(this.tableState().expanded):t;this.tableState.update(a=>S(x({},a),{expanded:o}))},onPaginationChange:t=>{let o=typeof t=="function"?t(this.configService.paginacionElementos()):t;this.configService.setPaginacionElementos({pageIndex:o.pageIndex,pageSize:o.pageSize})}}))}obtenerEspacioSelect(t){let o=this.appService.espaciosQuery.data()?.find(a=>a.id===t);return o?o.nombre:"Desconocido"}ngOnInit(){se(()=>{this.configService.pestana(),this.configService.pestana()!=="elementos"&&(this.nombre.reset(null),this.espacio.reset(null),this.cantidad.reset(null),this.valorEstudiante.reset(null),this.valorAdministrativo.reset(null),this.valorExterno.reset(null),this.valorEgresado.reset(null),this.elementoEnEdicion.set(null),this.configService.resetAll())},{injector:this.injector})}get elementosQuery(){let t=this.configService.elementosQuery.data()||[];return this.modoCreacion()?[{id:-1,nombre:"",cantidad:0,id_espacio:-1,valor_estudiante:0,valor_administrativo:0,valor_externo:0,valor_egresado:0,creado_en:this.fechaActual(),eliminado_en:null,actualizado_en:null,cantidad_seleccionada:0},...t]:t}onPageChange(t){this.configService.setPaginacionElementos(t)}cambiarEstadoConfig(t){let o=t.eliminado_en===null?"inactivo":"activo",a=o==="activo"?"activar":"desactivar";this.appService.setGuardando(!0),this.cdr.detectChanges(),this.alertaService.confirmarAccion(`\xBFEst\xE1s seguro de que quieres ${a} el elemento <strong>${t.nombre}</strong>?`,this.configService.alertaConfig(),`${a.charAt(0).toUpperCase()+a.slice(1)} elemento`,o==="activo"?"success":"warning").then(m=>{m?this.configService.cambiarEstadoElemento(t.id,o).then(()=>{this.alertaService.success(`Elemento ${a==="activar"?"activado":"desactivado"} exitosamente.`,5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.configService.elementosQuery.refetch()}).catch(f=>{console.error(`Error al ${a} el elemento:`,f),this.alertaService.error(`Error al ${a} el elemento. Por favor, int\xE9ntalo de nuevo.`,5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}).finally(()=>{this.appService.setGuardando(!1),this.cdr.detectChanges()}):(this.appService.setGuardando(!1),this.cdr.detectChanges())})}crearElemento(){this.configService.setModoCreacionElemento(!0),this.appService.setEditando(!0),this.elementoEnEdicion.set(null),this.nombre.reset(""),this.espacio.reset(null),this.cantidad.reset(null),this.valorEstudiante.reset(null),this.valorAdministrativo.reset(null),this.valorExterno.reset(null),this.valorEgresado.reset(null),this.cdr.detectChanges()}iniciarEdicion(t){let o=t.original,a=o.id;this.configService.setEditandoFilaElemento(a,!0),this.elementoEnEdicion.set(o),this.appService.setEditando(!0),setTimeout(()=>{this.nombre.setValue(o.nombre),this.espacio.setValue(o.id_espacio??null),this.cantidad.setValue(o.cantidad??0),this.valorEstudiante.setValue(o.valor_estudiante??null),this.valorAdministrativo.setValue(o.valor_administrativo??null),this.valorExterno.setValue(o.valor_externo??null),this.valorEgresado.setValue(o.valor_egresado??null),this.nombre.markAsPristine(),this.espacio.markAsPristine(),this.cantidad.markAsPristine(),this.valorEstudiante.markAsPristine(),this.valorAdministrativo.markAsPristine(),this.valorExterno.markAsPristine(),this.valorEgresado.markAsPristine(),this.onToggleRow(t,!0),this.cdr.detectChanges()},0)}onCancelarEdicion(t){let o=t.original.id;this.configService.setEditandoFilaElemento(o,!1),this.appService.setEditando(!1),this.elementoEnEdicion.set(null),this.tableState.update(a=>S(x({},a),{expanded:{}})),this.nombre.reset(null),this.espacio.reset(null),this.cantidad.reset(null),this.valorEstudiante.reset(null),this.valorAdministrativo.reset(null),this.valorExterno.reset(null),this.valorEgresado.reset(null),this.cdr.detectChanges()}cancelarCreacion(){this.configService.setModoCreacionElemento(!1),this.appService.setEditando(!1),this.tableState.update(t=>S(x({},t),{expanded:{}})),this.nombre.reset(null),this.espacio.reset(null),this.cantidad.reset(null),this.valorEstudiante.reset(null),this.valorAdministrativo.reset(null),this.valorExterno.reset(null),this.valorEgresado.reset(null),this.cdr.detectChanges()}onGuardarNuevo(){return _(this,null,function*(){if(this.nombre.markAsTouched(),this.nombre.invalid){this.alertaService.error("Todos los campos son requeridos.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4");return}this.appService.setGuardando(!0);let t={nombre:this.nombre.value?.trim(),valor_estudiante:this.valorEstudiante.value??void 0,valor_administrativo:this.valorAdministrativo.value??void 0,valor_externo:this.valorExterno.value??void 0,valor_egresado:this.valorEgresado.value??void 0};try{yield this.configService.crearElemento(t),this.alertaService.success("Elemento creada exitosamente.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.tableState.update(o=>S(x({},o),{expanded:{}})),this.cancelarCreacion(),this.configService.elementosQuery.refetch()}catch(o){console.error("Error al crear elemento:",o),this.alertaService.error("Error al crear el elemento. Por favor, int\xE9ntalo de nuevo.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}finally{this.appService.setGuardando(!1)}})}onGuardarEdicion(t){return _(this,null,function*(){if(this.nombre.markAsTouched(),this.nombre.invalid){this.alertaService.error("Por favor, complete todos los campos requeridos.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4");return}this.appService.setGuardando(!0);let o=t.original,a=S(x({},o),{nombre:this.nombre.value,cantidad:o.cantidad,id_espacio:o.id_espacio,valor_estudiante:this.valorEstudiante.value??0,valor_administrativo:this.valorAdministrativo.value??0,valor_externo:this.valorExterno.value??0,valor_egresado:this.valorEgresado.value??0});try{yield this.configService.actualizarElemento(o.id,a),this.alertaService.success("Elemento actualizado exitosamente.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.tableState.update(m=>S(x({},m),{expanded:{}})),this.configService.setEditandoFilaElemento(o.id,!1),this.appService.setEditando(!1),this.elementoEnEdicion.set(null),this.nombre.reset(null),this.espacio.reset(null),this.cantidad.reset(null),this.valorEgresado.reset(null),this.valorAdministrativo.reset(null),this.valorExterno.reset(null),this.valorEgresado.reset(null),this.configService.elementosQuery.refetch(),this.cdr.detectChanges()}catch(m){console.error("Error al actualizar la elemento:",m),this.alertaService.error("Error al actualizar la elemento. Por favor, int\xE9ntalo de nuevo.",5e3,this.configService.alertaConfig(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}finally{this.appService.setGuardando(!1)}})}onToggleRow(t,o=!1){let a=t.id,m=this.tableState().expanded,f;o?f={[a]:!0}:(f=m[a]?{}:{[a]:!0},m[a]&&this.configService.setElementoSeleccionado(null)),this.tableState.update(T=>S(x({},T),{expanded:f}))}ngOnDestroy(){this.configService.setModoCreacionElemento(!1),this.appService.setEditando(!1),this.configService.setEditandoFilaElemento(0,!1),this.elementoEnEdicion.set(null),this.appService.setGuardando(!1),this.nombre.reset(null),this.espacio.reset(null),this.valorEgresado.reset(null),this.valorAdministrativo.reset(null),this.valorExterno.reset(null),this.valorEgresado.reset(null),this.cdr.detectChanges()}};n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=J({type:n,selectors:[["config-elementos"]],viewQuery:function(o,a){o&1&&(R(a.estadoCell,ki,5),R(a.nombreCell,zi,5),R(a.espacioCell,Di,5),R(a.fechaCell,Qi,5),R(a.cantidadCell,qi,5),R(a.valorEstudianteCell,Ni,5),R(a.valorAdministrativoCell,Hi,5),R(a.valorEgresadoCell,Li,5)),o&2&&Y(8)},decls:27,vars:9,consts:[["estadoCell",""],["nombreCell",""],["cantidadCell",""],["espacioCell",""],["fechaCell",""],["valorEstudianteCell",""],["valorAdministrativoCell",""],["valorEgresadoCell",""],["tablaElemento","responsiveTable"],["alertaRoles",""],["responsiveTable","",1,"table","w-full","rounded-box","table-sm","sm:table-md",3,"table"],[1,"sticky","top-0","z-20","bg-base-100"],[3,"cambioPaginacion","prefetchFunction","ngClass","estado","paginacion","mostrarInfo","mostrarSelectorTamano","mostrarExtremos","deshabilitado"],[1,"badge","font-semibold","badge-info"],[3,"ngClass"],[3,"click","ngClass"],["placeholder","Inserte nombre","pattern","[a-zA-Z0-9\xE1\xE9\xED\xF3\xFA ]*","type","text",1,"input","input-sm","h-9","placeholder:text-gray-400",3,"formControl"],[1,"font-semibold"],["placeholder","Inserte cantidad","step","1","type","number",1,"input","input-sm","h-9","placeholder:text-gray-400",3,"formControl"],[1,"select","input-sm","h-9","placeholder:text-gray-400",3,"formControl"],[1,"text-sm","md:text-base"],["disabled","","selected","",3,"value"],[3,"value"],["type","number","min","0","placeholder","Valor",1,"input","input-sm","h-9","w-full","placeholder:text-gray-400",3,"formControl"],[1,"p-2","text-left","first:rounded-tl-md","last:rounded-tr-md","bg-base-100","z-20",3,"colSpan"],[4,"flexRender","flexRenderProps"],[1,"text-left",3,"innerHTML"],[1,"text-center","text-gray-500"],[1,"bg-base-100"],[1,"py-1"],[1,"bg-base-300","border-none"],[3,"innerHTML"],[1,"bg-base-100","rounded-md","p-2","md:p-4","shadow-md","w-full"],[1,"space-y-2"],[1,"text-sm","text-base-content/70"],[1,"flex","my-2","flex-row","gap-2","items-center"],[1,"font-bold","text-base-content"]],template:function(o,a){if(o&1){let m=U();G(0,ji,2,1,"ng-template",null,0,F)(2,Wi,2,1,"ng-template",null,1,F)(4,Yi,2,1,"ng-template",null,2,F)(6,on,2,1,"ng-template",null,3,F)(8,ln,2,1,"ng-template",null,4,F)(10,dn,2,1,"ng-template",null,5,F)(12,un,2,1,"ng-template",null,6,F)(14,fn,2,1,"ng-template",null,7,F),c(16,"table",10,8)(18,"thead",11),P(19,xn,3,0,"tr",null,ke),s(),c(21,"tbody"),u(22,En,4,1,"tr")(23,Rn,2,0),s()(),c(24,"app-paginador",12),Q("cambioPaginacion",function(T){return V(m),M(a.onPageChange(T))})("prefetchFunction",function(T){return V(m),M(a.configService.prefetchCategorias(T))}),s(),G(25,$n,0,0,"ng-template",null,9,F)}o&2&&(l(16),d("table",a.tablaElementos()),l(3),A(a.tablaElementos().getHeaderGroups()),l(3),g(!a.elementosQuery.length&&!a.modoCreacion()?22:23),l(2),d("ngClass","flex flex-col sm:flex-row items-center justify-between gap-4 p-4 bg-base-100 sticky bottom-0 z-10 rounded-b-box")("estado",a.configService.paginacionCategorias())("paginacion",a.configService.datosPaginadorCategorias()??null)("mostrarInfo",!0)("mostrarSelectorTamano",!0)("mostrarExtremos",!0)("deshabilitado",a.configService.categoriasQuery.isFetching()))},dependencies:[te,ee,Le,ye,Ee,ge,Pe,Ae,de,Fe,Ge,pe,ue,Re,me,K,we],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});let e=n;return e})();var In=["alertaConfig"];function Vn(e,n){if(e&1){let i=U();c(0,"button",14),Q("click",function(){V(i);let o=r();return M(o.crear())}),v(1,"app-web-icon",15),p(2),s()}if(e&2){let i=r();d("disabled",i.appService.editando()),l(2),y(" ",i.tituloBotonCrear()," ")}}function Mn(e,n){}var dr=(()=>{let n=class n{constructor(){this.configService=C(oe),this.authService=C(ie),this.appService=C(ne),this.categoriasChecked=h(()=>this.configService.pestana()==="categorias"),this.gruposChecked=h(()=>this.configService.pestana()==="grupos"),this.elementosChecked=h(()=>this.configService.pestana()==="elementos"),this.alertaConfig=$.required("alertaConfig",{read:ze})}cambiarPestana(t){this.configService.setPestana(t),this.configService.setModoCreacionCategoria(!1),this.appService.setEditando(!1),this.configService.setPaginacionCategorias({pageIndex:0,pageSize:10})}ngOnInit(){this.configService.setAlertaConfig(this.alertaConfig())}crear(){switch(this.configService.pestana()){case"categorias":this.configService.inciarCrearCategoria();break;case"grupos":this.configService.inciarCrearGrupo();break;case"elementos":this.configService.inciarCrearElemento();break;default:console.error("Pestana no reconocida");break}}tituloBotonCrear(){switch(this.configService.pestana()){case"categorias":return"Crear Categor\xEDa";case"grupos":return"Crear Grupo";case"elementos":return"Crear Elemento";default:return"Crear"}}};n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=J({type:n,selectors:[["config-main-page"]],viewQuery:function(o,a){o&1&&R(a.alertaConfig,In,5,ze),o&2&&Y()},hostAttrs:[1,"flex","flex-col","w-full","h-full","sm:pl-3","relative","overflow-y-auto"],decls:21,vars:7,consts:[["tabCategorias",""],["tabGrupos",""],["alertaConfig",""],[1,"flex","flex-col","md:flex-row","md:pr-2","w-full","pb-2","md:pb-4","items-stretch","justify-center","md:justify-between","sticky","top-0","z-30","bg-base-300"],[1,"flex","items-center","justify-center","sm:justify-start","gap-2"],[1,"font-bold","text-4xl","mb-2","md:mb-0","max-md:text-2xl","max-sm:text-center"],[1,"flex","flex-col","md:flex-row","max-md:gap-1","gap-2"],[1,"btn","max-sm:btn-sm","btn-primary","sm:h-11","rounded-box",3,"disabled"],[1,"tabs","tabs-lift"],["type","radio","name","espaciosTabs","aria-label","Categor\xEDas",1,"tab","font-semibold","text-[1.125rem]","max-sm:text-base",3,"change","checked"],[1,"tab-content","border-base-300","bg-base-100","p-2","md:p-5"],[3,"ngClass"],["type","radio","name","espaciosTabs","aria-label","Grupos",1,"tab","font-semibold","text-[1.125rem]","max-sm:text-base",3,"change","checked"],["type","radio","name","espaciosTabs","aria-label","Elementos",1,"tab","font-semibold","text-[1.125rem]","max-sm:text-base",3,"change","checked"],[1,"btn","max-sm:btn-sm","btn-primary","sm:h-11","rounded-box",3,"click","disabled"],["estilos","h-6 w-6","nombreIcono","add-outline"]],template:function(o,a){if(o&1){let m=U();c(0,"div",3)(1,"div",4)(2,"h2",5),p(3," Configuraci\xF3n "),s()(),c(4,"div",6),u(5,Vn,3,2,"button",7),s()(),c(6,"div",8)(7,"input",9,0),Q("change",function(){return V(m),M(a.cambiarPestana("categorias"))}),s(),c(9,"div",10),v(10,"config-categorias",11),s(),c(11,"input",12,1),Q("change",function(){return V(m),M(a.cambiarPestana("grupos"))}),s(),c(13,"div",10),v(14,"config-grupos",11),s(),c(15,"input",13,1),Q("change",function(){return V(m),M(a.cambiarPestana("elementos"))}),s(),c(17,"div",10),v(18,"config-elementos",11),s()(),G(19,Mn,0,0,"ng-template",null,2,F)}o&2&&(l(5),g(a.authService.tienePermisos("PER000001")?5:-1),l(2),d("checked",a.categoriasChecked()),l(3),d("ngClass","flex flex-col overflow-y-auto"),l(),d("checked",a.gruposChecked()),l(3),d("ngClass","flex flex-col overflow-y-auto"),l(),d("checked",a.elementosChecked()),l(3),d("ngClass","flex flex-col overflow-y-auto"))},dependencies:[te,ee,Oe,nt,ot,at],styles:["[_nghost-%COMP%]{display:block}"]});let e=n;return e})();export{dr as default};
