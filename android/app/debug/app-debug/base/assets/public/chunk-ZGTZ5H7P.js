import{a as Ji}from"./chunk-M4CGKRW4.js";import{a as zi}from"./chunk-V377ZSN6.js";import{a as Qi}from"./chunk-FS5XWZUM.js";import{a as N}from"./chunk-KZG6SVMM.js";import{a as Bi,b as Oi}from"./chunk-LHBRERJU.js";import{b as ti,c as Li}from"./chunk-WXQYSXFO.js";import{a as _i,b as gi,e as Ui,f as $i,g as Gi,k as Hi,l as qi}from"./chunk-SVZGXVR3.js";import"./chunk-BONXZWWT.js";import{a as Be}from"./chunk-AMCW56AE.js";import{a as Ai}from"./chunk-VILVOQXR.js";import{b as V}from"./chunk-WNVXENDG.js";import{a as ue}from"./chunk-I7IWUYYH.js";import{a as ge,b as Ce,c as ve,d as xe,f as re,g as be,h as Se,i as Ee,j as ye,k as Ni}from"./chunk-KWYFY7T2.js";import{a as Vi}from"./chunk-AWJWBZOU.js";import{a as me}from"./chunk-ZU7Q4APP.js";import{b as Qe}from"./chunk-KTGXZBKE.js";import{m as G}from"./chunk-LKADUWP6.js";import{g as Ne}from"./chunk-6CQPCFUJ.js";import"./chunk-AI3LD7IZ.js";import{a as ii}from"./chunk-ODBDBKE7.js";import"./chunk-XPPSGRKL.js";import{a as ze,e as ei,h as de}from"./chunk-4HN4PAFJ.js";import{i as X}from"./chunk-AV73RGVI.js";import{f as ae}from"./chunk-N4CCYIXR.js";import"./chunk-UAEYNMJW.js";import{A as Mi,B as Ae,C as Xe,D as Ri,G as Pi,b as Di,c as le,e as v,g as ce,h as Je,j as K,k as Ke,l as De,m as _e,n as Ye,p as We,q as je,r as Me,s as Re,t as Ze,u as Pe,w as ji,x as Ve,z as Z}from"./chunk-YPFPCNBD.js";import{A as yi,Aa as F,Ba as p,Ca as l,D as we,Da as r,Db as W,Ea as _,Fa as B,Ga as O,H as g,Ia as D,Ja as E,Jb as Ii,Ka as c,Lb as J,N as x,O as b,P as Fi,Q as wi,R as te,Ra as R,Rb as he,Sa as oe,Ta as A,U as S,Va as fe,Wa as ui,Xa as m,Ya as Y,Za as k,_b as ki,aa as z,ba as Ti,bb as fi,c as pi,cb as ne,da as s,db as hi,eb as Le,ha as mi,hb as Te,ia as Q,ib as Ie,l as xi,lb as $,na as M,pb as w,qb as L,rb as He,sb as qe,ta as U,tb as P,u as bi,v as Si,va as f,wa as h,wb as ke,xa as se,z as Ei,za as y}from"./chunk-U6U25BWF.js";import"./chunk-B3LSNZRN.js";import"./chunk-WUBXWBRT.js";import"./chunk-B52GHH4C.js";import"./chunk-KZ3CI6ZI.js";import"./chunk-HC6MZPB3.js";import"./chunk-SV2ZKNWA.js";import"./chunk-IA5KSSRM.js";import"./chunk-RS5W3JWO.js";import"./chunk-XENCGOZ2.js";import"./chunk-XZRAAXKF.js";import"./chunk-7D6K5XYM.js";import"./chunk-OBXDPQ3V.js";import"./chunk-QY5CJPR3.js";import"./chunk-MCRJI3T3.js";import"./chunk-ZD4SBDZ6.js";import"./chunk-NCLOD2DI.js";import"./chunk-UYQ7EZNZ.js";import"./chunk-BAKMWPBW.js";import"./chunk-AESNPOCP.js";import"./chunk-H3ZVKW6B.js";import"./chunk-HMK4XMX7.js";import"./chunk-E7UUDSES.js";import"./chunk-JQ3FRJ6A.js";import"./chunk-3IVKBF6N.js";import"./chunk-NMYJD6OP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-SV7S5NYR.js";import{a as T,b as I,i as vi,j as q}from"./chunk-LVXXLD6S.js";var rt=(e,a)=>({"relative flex flex-col items-center justify-center p-6 border-2 border-dashed rounded-lg transition-colors border-gray-300 hover:border-gray-400 bg-white":!0,"cursor-pointer pointer-events-auto":e,"curosor-not-allowed opacity-80 pointer-events-none":a}),st=(e,a)=>({"absolute inset-0 w-full h-full opacity-0":!0,"cursor-pointer pointer-events-auto":e,"cursor-not-allowed":a});function lt(e,a){e&1&&_(0,"div",1)}var Ki=(()=>{let a=class a{constructor(){this.appService=g(X),this.fileDropped=He(),this.isDragOver=!1}get isDisabled(){return!this.appService.editando()}onDragOver(i){i.preventDefault(),this.isDragOver=!0}onDragLeave(i){i.preventDefault(),this.isDragOver=!1}onDrop(i){i.stopPropagation(),this.isDragOver=!1,i.dataTransfer?.files?.length&&this.fileDropped.emit(i.dataTransfer.files[0])}onFileSelected(i){let o=i.target;o.files?.length&&this.fileDropped.emit(o.files[0])}};a.\u0275fac=function(o){return new(o||a)},a.\u0275cmp=Q({type:a,selectors:[["imagen-drop"]],hostVars:4,hostBindings:function(o,n){o&1&&E("dragover",function(u){return n.onDragOver(u)})("dragleave",function(u){return n.onDragLeave(u)})("drop",function(u){return n.onDrop(u)}),o&2&&fe("drag-over",n.isDragOver)("cursor-not-allowed",n.isDisabled)},outputs:{fileDropped:"fileDropped"},decls:11,vars:9,consts:[[3,"ngClass"],[1,"absolute","inset-0","bg-accent/10","rounded-lg"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-12","h-12","text-gray-400","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d",`M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2
         M7 10l5-5m0 0l5 5m-5-5v12`],[1,"text-gray-600","text-center"],[1,"text-info","hover:underline"],[1,"text-sm","text-gray-500","text-center"],["type","file","accept",".png,.jpg,.svg",3,"change","ngClass"]],template:function(o,n){o&1&&(l(0,"div",0),f(1,lt,1,0,"div",1),Fi(),l(2,"svg",2),_(3,"path",3),r(),wi(),l(4,"p",4),m(5," Arrastra y suelta o "),l(6,"span",5),m(7," selecciona un archivo "),r()(),l(8,"p",6),m(9,"Formatos soportados: .png, .jpg, .svg"),r(),l(10,"input",7),E("change",function(u){return n.onFileSelected(u)}),r()()),o&2&&(p("ngClass",hi(3,rt,n.appService.editando(),!n.appService.editando())),s(),h(n.isDragOver?1:-1),s(9),p("ngClass",hi(6,st,n.appService.editando(),!n.appService.editando())))},dependencies:[J,W],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});let e=a;return e})();var Ue=(()=>{let a=class a{constructor(){this.http=g(he),this.queryClient=g(Mi),this.espacioConfigService=g(N),this.configsQuery=Xe(()=>({queryKey:["config-base",this.espacioConfigService.idEspacio()],queryFn:()=>Gi(this.http,this.espacioConfigService.idEspacio()),select:i=>i.data})),this.saveConfigMutation=Ae(()=>({mutationFn:i=>qi(this.http,i),onSuccess:()=>{this.queryClient.invalidateQueries({queryKey:["config-base"]})}}))}};a.\u0275fac=function(o){return new(o||a)},a.\u0275prov=we({token:a,factory:a.\u0275fac,providedIn:"root"});let e=a;return e})();var ct=["espaciosModal"],dt=["espacioImagenRef"],pt=["editor"],ni=e=>({"input input-bordered w-full h-11 rounded-md placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm":!0,"input-error":e}),oi=e=>({"select input-bordered w-full h-11 rounded-md placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm":!0,"input-error":e}),mt=e=>({"input input-bordered w-full h-11 uppercase rounded-md placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm":!0,"input-error":e}),Oe=(e,a)=>a.id;function ut(e,a){if(e&1){let t=D();l(0,"imagen-drop",48),E("fileDropped",function(o){x(t);let n=c();return b(n.onImagenDrop(o))}),r()}}function ft(e,a){if(e&1){let t=D();l(0,"button",55),E("click",function(){x(t);let o=c(2);return b(o.borrarImagen())}),m(1," Borrar "),r()}}function ht(e,a){if(e&1&&(l(0,"div",4),_(1,"img",49,2),l(3,"div",50)(4,"div",51)(5,"span",52),m(6),r(),l(7,"span",53),m(8),r()(),f(9,ft,2,0,"button",54),r()()),e&2){let t,i,o=c();s(),p("src",o.imagen,Ti),s(5),Y((t=o.tiltuloImagen())==null?null:t.nombre),s(2),Y((i=o.tiltuloImagen())==null?null:i.peso),s(),h(o.appService.editando()?9:-1)}}function _t(e,a){if(e&1&&(l(0,"div",11),m(1),r()),e&2){let t=c();s(),k(" ",t.formUtils.obtenerErrorDelCampo(t.espacioForm,"nombre")," ")}}function gt(e,a){if(e&1&&(l(0,"option",15),m(1),r()),e&2){let t=a.$implicit;p("value",t.id),s(),k(" ",`${t.nombre}`," ")}}function Ct(e,a){if(e&1&&(l(0,"div",11),m(1),r()),e&2){let t=c();s(),k(" ",t.formUtils.obtenerErrorDelCampo(t.espacioForm,"sede")," ")}}function vt(e,a){if(e&1&&(l(0,"option",15),m(1),r()),e&2){let t=a.$implicit;p("value",t.id),s(),k(" ",`${t.nombre}`," ")}}function xt(e,a){if(e&1&&(l(0,"div",11),m(1),r()),e&2){let t=c();s(),k(" ",t.formUtils.obtenerErrorDelCampo(t.espacioForm,"categoria")," ")}}function bt(e,a){if(e&1&&(l(0,"div",11),m(1),r()),e&2){let t=c(2);s(),k(" ",t.formUtils.obtenerErrorDelCampo(t.espacioForm,"valorMensualidad")," ")}}function St(e,a){if(e&1&&(l(0,"div",7)(1,"label",56),m(2," Valor mensualidad: "),r(),_(3,"input",57),f(4,bt,2,1,"div",11),r()),e&2){let t=c();s(3),p("ngClass",ne(2,ni,t.formUtils.esCampoInvalido(t.espacioForm,"valorMensualidad"))),s(),h(t.formUtils.esCampoInvalido(t.espacioForm,"valorMensualidad")?4:-1)}}function Et(e,a){if(e&1&&_(0,"quill-editor",24,3),e&2){let t=c();p("modules",t.quillConfig)}}function yt(e,a){if(e&1&&(l(0,"div",25),_(1,"quill-view-html",58),r()),e&2){let t=c();s(),p("content",t.espacioForm.controls.descripcion.value)}}function Ft(e,a){if(e&1&&(l(0,"div",11),m(1),r()),e&2){let t=c();s(),k(" ",t.formUtils.obtenerErrorDelCampo(t.espacioForm,"limiteTiempoReserva")," ")}}function wt(e,a){if(e&1&&(l(0,"option",15),m(1),r()),e&2){let t=a.$implicit;p("value",t.id),s(),k(" ",`${t.codigo} - ${t.nombre}`," ")}}function Tt(e,a){if(e&1&&(l(0,"div",11),m(1),r()),e&2){let t=c();s(),k(" ",t.formUtils.obtenerErrorDelCampo(t.espacioForm,"codigoEdificio")," ")}}function It(e,a){if(e&1&&(l(0,"div",11),m(1),r()),e&2){let t=c();s(),k(" ",t.formUtils.obtenerErrorDelCampo(t.espacioForm,"codigoEspacio")," ")}}function kt(e,a){if(e&1&&(l(0,"div",11),m(1),r()),e&2){let t=c(2);s(),k(" ",t.formUtils.obtenerErrorDelCampo(t.espacioForm,"minimoJugadores")," ")}}function Dt(e,a){if(e&1&&(l(0,"div",11),m(1),r()),e&2){let t=c(2);s(),k(" ",t.formUtils.obtenerErrorDelCampo(t.espacioForm,"maximoJugadores")," ")}}function jt(e,a){if(e&1&&(l(0,"div",6)(1,"div",7)(2,"label",59),m(3," M\xEDnimo de participantes: "),l(4,"span",9),m(5,"*"),r()(),_(6,"input",60),f(7,kt,2,1,"div",11),r(),l(8,"div",7)(9,"label",61),m(10," M\xE1ximo de participantes: "),l(11,"span",9),m(12,"*"),r()(),_(13,"input",62),f(14,Dt,2,1,"div",11),r(),l(15,"div",7),_(16,"label",19),l(17,"label",63),_(18,"input",64),l(19,"span",65),m(20,"Se puede agregar beneficiarios"),r()()()()),e&2){let t=c();s(6),p("ngClass",ne(4,ni,t.formUtils.esCampoInvalido(t.espacioForm,"minimoJugadores"))),s(),h(t.formUtils.esCampoInvalido(t.espacioForm,"minimoJugadores")?7:-1),s(6),p("ngClass",ne(6,ni,t.formUtils.esCampoInvalido(t.espacioForm,"maximoJugadores"))),s(),h(t.formUtils.esCampoInvalido(t.espacioForm,"maximoJugadores")?14:-1)}}function Mt(e,a){if(e&1){let t=D();l(0,"div",67),E("click",function(){let o=x(t).$implicit,n=c(2);return b(n.seleccionarElemento(o))}),m(1),r()}if(e&2){let t=a.$implicit,i=a.$index,o=c(2);fe("highlighted",i===o.indiceOpcionSeleccionadaElementos()),p("id","elemento-option-"+i),U("aria-selected",i===o.indiceOpcionSeleccionadaElementos()),s(),k(" ",t.nombre," ")}}function Rt(e,a){if(e&1&&(l(0,"div",43),y(1,Mt,2,5,"div",66,Oe),r()),e&2){let t=c();s(),F(t.elementosFiltrados())}}function Pt(e,a){e&1&&(l(0,"div",44)(1,"div",68),m(2," No se encontraron elementos "),r()())}function Vt(e,a){if(e&1){let t=D();l(0,"button",73),E("click",function(){x(t);let o=c().$implicit,n=c(2);return b(n.eliminarElemento(o))}),_(1,"app-web-icon",74),r()}}function At(e,a){if(e&1&&(l(0,"div",71),m(1),f(2,Vt,2,0,"button",72),r()),e&2){let t=a.$implicit,i=c(2);s(),k(" ",t.nombre," "),s(),h(i.appService.editando()?2:-1)}}function Nt(e,a){if(e&1&&(l(0,"div",45)(1,"label",69),m(2,"Elementos asociados:"),r(),l(3,"div",70),y(4,At,3,2,"div",71,Oe),r()()),e&2){let t=c();s(4),F(t.elementosSeleccionados())}}function Ut(e,a){}function $t(e,a){if(e&1){let t=D();l(0,"button",75),E("click",function(){x(t);let o=c();return b(o.cancelarEditar())}),m(1," Cancelar "),r(),l(2,"button",76),m(3," Actualizar "),r()}if(e&2){let t=c();s(2),ui("btn btn-accent  btn-soft h-11 rounded-md"),p("disabled",t.espacioForm.invalid||!1)}}function Gt(e,a){if(e&1){let t=D();l(0,"button",77),E("click",function(){x(t);let o=c();return b(o.editarGeneral())}),m(1," Editar "),r()}e&2&&ui("btn btn-secondary btn-soft h-11 rounded-md")}var Yi=(()=>{let a=class a{constructor(){this.fb=g(Ve),this.injector=g(te),this.alertaService=g(me),this.estilosAlerta=S("fixed bottom-10 right-10 p-4 transition-all ease-in-out max-w-sm").asReadonly(),this.file=S(null),this.enviroment=Pi,this.configBaseService=g(Ue),this.http=g(he),this.destroy$=new pi,this.authService=g(ae),this.espaciosService=g(zi),this.espacioConfigService=g(N),this.appService=g(X),this.formUtils=Vi,this.espacioForm=this.fb.group({nombre:["",[v.required]],descripcion:["",[v.required]],categoria:["",[v.required]],sede:["",[v.required]],permitirJugadores:[!1],permitirExternos:[!1],aprobarReservas:[!1],limiteTiempoReserva:[null,[v.required,v.min(0)]],despuesHora:[!1],codigoEdificio:[null,[v.required]],codigoEspacio:[null,[v.required,v.pattern(/^[a-zA-Z0-9\s\-_]+$/)]],minimoJugadores:[""],maximoJugadores:[""],reservasSimultaneas:[1,[v.min(1)]],pagoMensualidad:[!1],valorMensualidad:[{value:null,disabled:!0},[v.min(0)]],elementosEnlazados:[[]]}),this.tiltuloImagen=S(null),this.edificios=w(()=>this.espaciosService.edificiosQuery.data()),this.terminoBusquedaElementos=S(""),this.elementosFiltrados=S([]),this.elementosSeleccionados=S([]),this.mostrarOpcionesElementos=S(!1),this.indiceOpcionSeleccionadaElementos=S(-1),this.elementoSearchSubject=new pi,this.quillConfig={toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link"]],modules:{imageResize:!1,imageCompress:!1}},this.modalEspacios=P("espaciosModal"),this.espacioImagenRef=P("espacioImagenRef"),this.editor=P("editor")}ngAfterViewInit(){L(()=>{let i=this.espacioConfigService.espacioQuery.data(),o=this.espacioConfigService.espacioQuery.isLoading();if(this.espacioConfigService.espacioQuery.isError()){this.alertaService.error("No se pudo cargar el espacio. Por favor, int\xE9ntalo de nuevo m\xE1s tarde.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta());return}!o&&i&&this.cargarDatosEspacio(i)},{injector:this.injector}),this.configurarEditorQuill(),this.configurarAutocompleteElementos()}configurarEditorQuill(){setTimeout(()=>{let i=this.editor();if(i&&i.quillEditor){let o=i.quillEditor;o.clipboard.addMatcher(Node.ELEMENT_NODE,(d,u)=>{let j=(u.ops||[]).filter(H=>!(H.insert&&typeof H.insert=="object"&&H.insert.image)),ee=Qi.import("delta");return new ee(j)}),o.container.addEventListener("drop",d=>{let u=d.dataTransfer?.files;u&&u.length>0&&(d.preventDefault(),d.stopPropagation(),this.alertaService.error("No se permite insertar archivos en el editor de texto.",3e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta()))})}},100)}configurarAutocompleteElementos(){this.elementoSearchSubject.pipe(bi(300),Si(),Ei(this.destroy$)).subscribe(i=>q(this,null,function*(){if(i.trim().length>0)try{let o=yield Li(this.http,i,null);this.elementosFiltrados.set(o.data||[])}catch(o){console.error("Error al buscar elementos:",o),this.elementosFiltrados.set([])}else this.elementosFiltrados.set([])}))}onElementoInputChange(i){let n=i.target.value;this.terminoBusquedaElementos.set(n),this.mostrarOpcionesElementos.set(!0),this.indiceOpcionSeleccionadaElementos.set(-1),this.elementoSearchSubject.next(n)}onElementoKeyDown(i){let o=this.elementosFiltrados(),n=this.indiceOpcionSeleccionadaElementos();switch(i.key){case"ArrowDown":i.preventDefault();let d=n<o.length-1?n+1:0;this.indiceOpcionSeleccionadaElementos.set(d);break;case"ArrowUp":i.preventDefault();let u=n>0?n-1:o.length-1;this.indiceOpcionSeleccionadaElementos.set(u);break;case"Enter":i.preventDefault(),n>=0&&o[n]&&this.seleccionarElemento(o[n]);break;case"Escape":i.preventDefault(),this.mostrarOpcionesElementos.set(!1),this.indiceOpcionSeleccionadaElementos.set(-1);break}}seleccionarElemento(i){let o=this.elementosSeleccionados();o.find(n=>n.id===i.id)||(this.elementosSeleccionados.set([...o,i]),this.espacioForm.get("elementosEnlazados")?.setValue([...o.map(n=>n.id),i.id])),this.terminoBusquedaElementos.set(""),this.mostrarOpcionesElementos.set(!1),this.indiceOpcionSeleccionadaElementos.set(-1)}eliminarElemento(i){let n=this.elementosSeleccionados().filter(d=>d.id!==i.id);this.elementosSeleccionados.set(n),this.espacioForm.get("elementosEnlazados")?.setValue(n.map(d=>d.id))}ocultarOpcionesElementos(){setTimeout(()=>{this.mostrarOpcionesElementos.set(!1),this.indiceOpcionSeleccionadaElementos.set(-1)},150)}get imagen(){return this.espacioConfigService.imagen()}cargarDatosEspacio(i){try{if(this.espacioForm.patchValue({nombre:i?.nombre||"",descripcion:i?.descripcion||"",categoria:i?.categoria?.id||"",sede:i?.sede?.id||"",permitirJugadores:i?.agregar_jugadores||!1,permitirExternos:i?.permite_externos||!1,aprobarReservas:i?.aprobar_reserva??!1,limiteTiempoReserva:i?.tiempo_limite_reserva||null,despuesHora:i.despues_hora||!1,codigoEdificio:i?.id_edificio||"",codigoEspacio:i?.codigo||"",minimoJugadores:i?.minimo_jugadores||"",maximoJugadores:i?.maximo_jugadores||"",reservasSimultaneas:i?.reservas_simultaneas||1,pagoMensualidad:i?.pago_mensual||!1,valorMensualidad:i?.valor_mensualidad??null}),i.imagen&&(this.espacioConfigService.setImagen(`${this.enviroment.apiUrl}${i.imagen.ubicacion}`),this.tiltuloImagen.set({nombre:i.imagen.titulo,peso:""})),i.elementos&&this.elementosSeleccionados.set(i.elementos),i?.agregar_jugadores){let u=this.espacioForm.get("minimoJugadores"),C=this.espacioForm.get("maximoJugadores");u?.setValidators([v.required,v.min(1)]),C?.setValidators([v.required,v.min(1)]),u?.updateValueAndValidity(),C?.updateValueAndValidity()}let o=this.espacioForm.get("pagoMensualidad"),n=this.espacioForm.get("valorMensualidad");this.espacioConfigService.modoEdicionGeneral()&&o?.value?(n?.enable({emitEvent:!1}),n?.setValidators([v.required,v.min(0)])):(n?.disable({emitEvent:!1}),n?.clearValidators()),n?.updateValueAndValidity({emitEvent:!1}),this.espacioConfigService.modoEdicionGeneral()||this.espacioForm.disable()}catch(o){console.error("Error al cargar datos del espacio:",o),this.alertaService.error("Error al cargar los datos del espacio.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta())}}onAprobarReservasChange(i){return q(this,null,function*(){if(i.target.checked&&!(yield this.alertaService.confirmacion({referencia:this.espacioConfigService.alertaEspacioConfigRef(),titulo:"Confirmar cambio",tipo:"warning",mensaje:"Este cambio har\xE1 que <strong>todas las franjas horarias</strong> de este espacio (base y futuras) tengan <strong>valor 0</strong>. Para revertirlo tendr\xE1s que reconfigurar manualmente las franjas horarias. \xBFDeseas continuar?",botones:[{texto:"Cancelar",tipo:"cancelar",estilo:"btn-ghost"},{texto:"Confirmar",tipo:"confirmar",estilo:"btn-warning"}]}))){this.espacioForm.get("aprobarReservas")?.setValue(!1,{emitEvent:!1});return}})}onPermitirJugadoresChange(i){let o=i.target,n=this.espacioForm.get("minimoJugadores"),d=this.espacioForm.get("maximoJugadores");o.checked?(n?.setValidators([v.required,v.min(1)]),d?.setValidators([v.required,v.min(1)])):(n?.clearValidators(),d?.clearValidators()),n?.updateValueAndValidity(),n?.markAsTouched(),d?.updateValueAndValidity(),d?.markAsTouched()}enviarFormulario(){if(this.espacioForm.markAllAsTouched(),this.espacioForm.invalid){this.alertaService.error("Por favor, completa todos los campos requeridos.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta());return}let i=I(T({},this.espacioForm.value),{imagen:this.file(),elementosEnlazados:this.espacioForm.value.elementosEnlazados});this.espacioConfigService.actualizarGeneral(i,this.espacioConfigService.espacioQuery.data()?.id||0).then(o=>{this.alertaService.success("Espacio actualizado exitosamente.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta()),this.espacioConfigService.espacioQuery.refetch(),this.espaciosService.espaciosQuery.refetch(),this.configBaseService.configsQuery.refetch(),this.cancelarEditar()}).catch(o=>{console.error("Error al actualizar espacio:",o);let n="Error al actualizar el espacio.";o?.errors?n=`Error al actualizar el espacio: ${Object.values(o.errors).join(", ")}`:o?.message&&(n=`Error al actualizar el espacio: ${o.message}`),this.alertaService.error(n,5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta())})}onPagoMensualidadChange(i){let o=i.target,n=this.espacioForm.get("valorMensualidad");o.checked?(n?.enable(),n?.setValidators([v.required,v.min(0)])):(n?.clearValidators(),n?.setValue(null),n?.disable()),n?.updateValueAndValidity()}editarGeneral(){this.espacioConfigService.setModoEdicionGeneral(!0),this.appService.setEditando(!0),this.espacioForm.enable();let i=this.espacioForm.get("pagoMensualidad"),o=this.espacioForm.get("valorMensualidad");i?.value?(o?.enable(),o?.setValidators([v.required,v.min(0)])):(o?.clearValidators(),o?.disable()),o?.updateValueAndValidity(),this.espacioForm.markAsPristine()}cancelarEditar(){this.espacioConfigService.setModoEdicionGeneral(!1),this.appService.setEditando(!1),this.espacioForm.disable()}onImagenDrop(i){if(!i){this.alertaService.error("No se ha seleccionado ning\xFAn archivo.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta());return}if(this.file.set(i),!["image/jpeg","image/jpg","image/png","image/webp"].includes(i.type)){this.alertaService.error("Formato de imagen no v\xE1lido. Solo se permiten archivos JPEG, PNG y WebP.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta());return}let n=5*1024*1024;if(i.size>n){this.alertaService.error("La imagen es demasiado grande. El tama\xF1o m\xE1ximo permitido es 5MB.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta());return}let d=new FileReader;d.onload=u=>{let C=u.target?.result;this.espacioConfigService.setImagen(C),this.tiltuloImagen.set({nombre:i.name,peso:(i.size/1024).toFixed(2)+" KB"}),this.alertaService.success("Imagen cargada correctamente.",3e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta())},d.onerror=()=>{this.alertaService.error("Error al cargar la imagen.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta())},d.readAsDataURL(i)}borrarImagen(){this.espacioConfigService.setImagen(""),this.tiltuloImagen.set(null),this.file.set(null),this.alertaService.success("Imagen eliminada correctamente.",3e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta())}ngOnDestroy(){this.espacioConfigService.setAlertaEspacioConfigRef(null),this.destroy$.next(),this.destroy$.complete()}};a.\u0275fac=function(o){return new(o||a)},a.\u0275cmp=Q({type:a,selectors:[["espacio-general"]],viewQuery:function(o,n){o&1&&(R(n.modalEspacios,ct,5),R(n.espacioImagenRef,dt,5),R(n.editor,pt,5)),o&2&&oe(3)},decls:108,vars:39,consts:[["permitirJugadores",""],["alertaFormEspacio",""],["espacioImagenRef",""],["editor",""],[1,"flex","border","border-base-content","rounded-lg","p-2","mb-2"],[3,"ngSubmit","formGroup"],[1,"my-4","flex","flex-col","md:flex-row","w-full","gap-2","md:gap-3"],[1,"flex","flex-col","w-full","md:w-1/3"],["for","nombre",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],[1,"text-error"],["type","text","id","nombre","formControlName","nombre","placeholder","Nombre",3,"ngClass"],[1,"text-sm","text-error"],["for","tipoDocumento",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],["type","text","id","sede","formControlName","sede",3,"ngClass"],["value","","disabled","","selected",""],[3,"value"],["type","text","id","categoria","formControlName","categoria",3,"ngClass"],["for","reservasSimultaneas",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],["type","number","id","reservasSimultaneas","formControlName","reservasSimultaneas","placeholder","Ubicaci\xF3n del espacio",1,"input","input-bordered","w-full","h-11","rounded-md","placeholder:text-gray-400","placeholder:text-xs","md:placeholder:text-sm"],[1,"label","text-sm","font-[600]","text-base-content","h-5","mb-1","md:mb-2"],["for","pagoMensualidad",1,"label","text-sm","h-11","text-base-content"],["id","pagoMensualidad","formControlName","pagoMensualidad","type","checkbox",1,"checkbox","checkbox-bordered","mr-2",3,"change"],[1,"flex","flex-col","w-full"],["for","descripcion",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],["id","descripcion","theme","snow","formControlName","descripcion","placeholder","Describe tu espacio aqu\xED...",3,"modules"],[1,"border","border-base-content/70","rounded-lg","prose","quill-reset"],[1,"my-2","flex","flex-col","md:flex-row","w-full","gap-2","md:gap-3"],["for","aprobarReservas",1,"label","text-sm","text-base-content"],["id","aprobarReservas","formControlName","aprobarReservas","type","checkbox",1,"checkbox","checkbox-bordered","mr-2",3,"change"],["for","limiteTiempoReserva",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2","tooltip"],["type","number","id","limiteTiempoReserva","formControlName","limiteTiempoReserva",3,"ngClass"],[1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],[1,"flex","items-center","h-11","gap-6"],[1,"label","text-sm","text-base-content","cursor-pointer"],["id","despuesHora","type","checkbox","formControlName","despuesHora",1,"checkbox","checkbox-bordered","mr-2"],["type","text","id","codigoEdificio","formControlName","codigoEdificio",3,"ngClass"],["for","codigoEspacio",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2","tooltip"],["type","text","id","codigoEspacio","formControlName","codigoEspacio",3,"ngClass"],["for","permitirJugadores",1,"label","text-sm","text-base-content"],["id","permitirJugadores","formControlName","permitirJugadores","type","checkbox",1,"checkbox","checkbox-bordered","mr-2",3,"change"],["for","elementos",1,"label","text-sm","font-[600]","text-base-content","mb-1"],[1,"relative"],["type","text","id","elementos","placeholder","Buscar elementos...","autocomplete","off","role","combobox",1,"input","max-sm:input-sm","sm:h-11","input-bordered","w-full","h-11","rounded-md","placeholder:text-gray-400","placeholder:text-xs","md:placeholder:text-sm",3,"input","keydown","focus","blur","value","disabled"],["role","listbox",1,"absolute","z-10","w-full","mt-1","bg-base-100","shadow-lg","border-base-300","border","rounded-lg","max-h-60","overflow-y-auto"],[1,"absolute","z-10","w-full","mt-1","bg-base-100","shadow-lg","border-base-300","border","rounded-lg","max-h-60","overflow-y-auto","animate-fade-in","text-sm"],[1,"mt-2"],[1,"modal-action"],["type","button",3,"class"],[3,"fileDropped"],["alt","Imagen del espacio",1,"w-full","max-w-32","max-h-32","object-cover","rounded-lg",3,"src"],[1,"flex","w-full","flex-row","justify-between","items-center","ml-4"],[1,"flex","flex-col","gap-2"],[1,"text-base","font-semibold"],[1,"text-sm","italic","text-gray-500"],["type","button",1,"btn","btn-error","btn-soft","h-8"],["type","button",1,"btn","btn-error","btn-soft","h-8",3,"click"],["for","valorMensualidad",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],["type","number","id","valorMensualidad","formControlName","valorMensualidad","min","0","placeholder","0",3,"ngClass"],[1,"text-sm",3,"content"],["for","minimoJugadores",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],["type","text","id","minimoJugadores","formControlName","minimoJugadores","placeholder","3",3,"ngClass"],["for","maximoJugadores",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],["type","text","id","maximoJugadores","formControlName","maximoJugadores","placeholder","10",3,"ngClass"],["for","permitirExternos",1,"label","text-sm","h-11","text-base-content"],["id","permitirExternos","formControlName","permitirExternos","type","checkbox",1,"checkbox","checkbox-bordered"],[1,"text-wrap"],["role","option",1,"py-3","px-4","cursor-pointer","border-b","border-base-100/10","transition-colors","duration-200","hover:bg-base-100","last:border-b-0","animate-fade-in","text-sm",3,"id","highlighted"],["role","option",1,"py-3","px-4","cursor-pointer","border-b","border-base-100/10","transition-colors","duration-200","hover:bg-base-100","last:border-b-0","animate-fade-in","text-sm",3,"click","id"],[1,"py-3","px-4","text-gray-500","italic"],[1,"label","text-sm","font-[600]","text-base-content"],[1,"flex","flex-wrap","gap-2"],[1,"badge","badge-accent","gap-2"],["type","button",1,"btn","btn-xs","btn-square","btn-accent","p-0","h-5","w-5"],["type","button",1,"btn","btn-xs","btn-square","btn-accent","p-0","h-5","w-5",3,"click"],["nombreIcono","remove-circle-outline","estilos","h-full w-full"],["type","button",1,"btn","btn-ghost","h-11","rounded-md",3,"click"],["type","submit",3,"disabled"],["type","button",3,"click"]],template:function(o,n){if(o&1){let d=D();f(0,ut,1,0,"imagen-drop")(1,ht,10,4,"div",4),l(2,"form",5),E("ngSubmit",function(){return x(d),b(n.enviarFormulario())}),l(3,"div",6)(4,"div",7)(5,"label",8),m(6," Nombre "),l(7,"span",9),m(8,"*"),r()(),_(9,"input",10),f(10,_t,2,1,"div",11),r(),l(11,"div",7)(12,"label",12),m(13," Sede "),l(14,"span",9),m(15,"*"),r()(),l(16,"select",13)(17,"option",14),m(18,"Seleccione"),r(),y(19,gt,2,2,"option",15,Oe),r(),f(21,Ct,2,1,"div",11),r(),l(22,"div",7)(23,"label",12),m(24," Tipo de espacio: "),l(25,"span",9),m(26,"*"),r()(),l(27,"select",16)(28,"option",14),m(29,"Seleccione"),r(),y(30,vt,2,2,"option",15,Oe),r(),f(32,xt,2,1,"div",11),r()(),l(33,"div",6)(34,"div",7)(35,"label",17),m(36," Reservas simult\xE1neas por hora: "),r(),_(37,"input",18),r(),l(38,"div",7),_(39,"label",19),l(40,"label",20)(41,"input",21),E("change",function(C){return x(d),b(n.onPagoMensualidadChange(C))}),r(),m(42," Pago con mensualidad "),r()(),f(43,St,5,4,"div",7),r(),l(44,"div",6)(45,"div",22)(46,"label",23),m(47," Notas importantes: "),r(),f(48,Et,2,1,"quill-editor",24)(49,yt,2,1,"div",25),r()(),l(50,"div",26)(51,"div",22)(52,"label",27)(53,"input",28),E("change",function(C){return x(d),b(n.onAprobarReservasChange(C))}),r(),m(54," Requiere aprobar reservas manualmente "),r()()(),l(55,"div",6)(56,"div",7)(57,"label",29),m(58," L\xEDmite (minutos): "),r(),_(59,"input",30),f(60,Ft,2,1,"div",11),r(),l(61,"div",7)(62,"label",31),m(63," Tipo de l\xEDmite: "),r(),l(64,"div",32)(65,"label",33),_(66,"input",34),m(67," Despu\xE9s de la hora "),r()()(),l(68,"div",7)(69,"label",12),m(70," C\xF3digo del edificio: "),l(71,"span",9),m(72,"*"),r()(),l(73,"select",35)(74,"option",14),m(75,"Seleccione"),r(),y(76,wt,2,2,"option",15,Oe),r(),f(78,Tt,2,1,"div",11),r()(),l(79,"div",6)(80,"div",7)(81,"label",36),m(82," C\xF3digo del espacio: "),l(83,"span",9),m(84,"*"),r()(),_(85,"input",37),f(86,It,2,1,"div",11),r()(),l(87,"div",6)(88,"div",22)(89,"label",38)(90,"input",39,0),E("change",function(C){return x(d),b(n.onPermitirJugadoresChange(C))}),r(),m(92," Se puede agregar participantes "),r()()(),f(93,jt,21,8,"div",6),l(94,"div",6)(95,"div",22)(96,"label",40),m(97," Buscar elementos a asociar: "),r(),l(98,"div",41)(99,"input",42),E("input",function(C){return x(d),b(n.onElementoInputChange(C))})("keydown",function(C){return x(d),b(n.onElementoKeyDown(C))})("focus",function(){return x(d),b(n.mostrarOpcionesElementos.set(!0))})("blur",function(){return x(d),b(n.ocultarOpcionesElementos())}),r(),f(100,Rt,3,0,"div",43),f(101,Pt,3,0,"div",44),r(),f(102,Nt,6,0,"div",45),r()(),M(103,Ut,0,0,"ng-template",null,1,$),l(105,"div",46),f(106,$t,4,3),f(107,Gt,2,2,"button",47),r()()}if(o&2){let d=A(91);h(n.imagen?1:0),s(2),p("formGroup",n.espacioForm),s(7),p("ngClass",ne(27,ni,n.formUtils.esCampoInvalido(n.espacioForm,"nombre"))),s(),h(n.formUtils.esCampoInvalido(n.espacioForm,"nombre")?10:-1),s(6),p("ngClass",ne(29,oi,n.formUtils.esCampoInvalido(n.espacioForm,"sede"))),s(3),F(n.appService.sedesQuery.data()),s(2),h(n.formUtils.esCampoInvalido(n.espacioForm,"sede")?21:-1),s(6),p("ngClass",ne(31,oi,n.formUtils.esCampoInvalido(n.espacioForm,"categoria"))),s(3),F(n.appService.categoriasQuery.data()),s(2),h(n.formUtils.esCampoInvalido(n.espacioForm,"categoria")?32:-1),s(11),h(n.espacioForm.controls.pagoMensualidad.value?43:-1),s(5),h(n.appService.editando()?48:49),s(9),U("data-tip","L\xEDmite de tiempo para poder reservar"),s(2),p("ngClass",ne(33,oi,n.formUtils.esCampoInvalido(n.espacioForm,"limiteTiempoReserva"))),s(),h(n.formUtils.esCampoInvalido(n.espacioForm,"limiteTiempoReserva")?60:-1),s(13),p("ngClass",ne(35,oi,n.formUtils.esCampoInvalido(n.espacioForm,"codigoEdificio"))),s(3),F(n.edificios()),s(2),h(n.formUtils.esCampoInvalido(n.espacioForm,"codigoEdificio")?78:-1),s(3),U("data-tip","C\xF3digo interno del espacio"),s(4),p("ngClass",ne(37,mt,n.formUtils.esCampoInvalido(n.espacioForm,"codigoEspacio"))),s(),h(n.formUtils.esCampoInvalido(n.espacioForm,"codigoEspacio")?86:-1),s(7),h(d.checked?93:-1),s(6),p("value",n.terminoBusquedaElementos())("disabled",!n.appService.editando()),U("aria-expanded",n.mostrarOpcionesElementos()),s(),h(n.mostrarOpcionesElementos()&&n.elementosFiltrados().length>0?100:-1),s(),h(n.mostrarOpcionesElementos()&&n.elementosFiltrados().length===0&&n.terminoBusquedaElementos()?101:-1),s(),h(n.elementosSeleccionados().length>0?102:-1),s(4),h(n.espacioConfigService.modoEdicionGeneral()?106:-1),s(),h(n.authService.tienePermisos("ESP000004")&&!n.espacioConfigService.modoEdicionGeneral()?107:-1)}},dependencies:[J,W,Z,Ke,Me,Re,le,De,Di,je,ce,Je,Pe,Ye,We,Ki,Bi,Oi,de],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   quill-editor[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:auto}[_nghost-%COMP%]   quill-editor.ql-container[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   quill-editor.ql-container.ql-snow[_ngcontent-%COMP%]{height:auto;border:none}"],changeDetection:0});let e=a;return e})();function Wi(e,a){return+Ne(e)>+Ne(a)}function $e(e,a){return+Ne(e)<+Ne(a)}var Ht=["estadoCell"],qt=["celdaAcciones"],zt=(e,a,t)=>({"badge font-semibold min-w-20 hover:cursor-pointer hover:scale-105 transition-all tooltip tooltip-right lg:tooltip-left align-middle":!0,"badge-success":e,"badge-error":a,"opacity-50 pointer-events-none badge-ghost":t}),ri=(e,a)=>a.id;function Qt(e,a){if(e&1){let t=D();l(0,"div",9),E("click",function(){let o=x(t).$implicit,n=c();return b(n.authService.tienePermisos("ESP000012")?n.appService.editando()?null:n.cambiarEstadoConfig(o.row.original):null)}),m(1),Te(2,"upperFirst"),r()}if(e&2){let t=a.$implicit,i=c();p("ngClass",Le(5,zt,t.getValue()===null,t.getValue()!==null,i.appService.editando())),U("data-tip",t.getValue()===null?"Desactivar":"Activar"),s(),k(" ",Ie(2,3,t.getValue()===null?"activo":"inactivo")," ")}}function Bt(e,a){if(e&1){let t=D();l(0,"button",10),E("click",function(){x(t);let o=c();return b(o.crearTipoConfig())}),_(1,"app-web-icon",11),l(2,"span"),m(3,"Nueva config."),r()()}if(e&2){let t=c();p("disabled",t.appService.editando()||t.modoCreacion()),s(),p("nombreIcono","add-outline")("estilos","h-5 w-5 mr-1")}}function Ot(e,a){e&1&&(l(0,"div",5),_(1,"app-web-icon",11),l(2,"span"),m(3,"Todos los tipos de usuario ya est\xE1n configurados."),r()()),e&2&&(s(),p("nombreIcono","information-circle-outline")("estilos","h-5 w-5 mr-2"))}function Lt(e,a){e&1&&_(0,"th",12)}function Jt(e,a){if(e&1&&(B(0),_(1,"span",15),O()),e&2){let t=a.$implicit;s(),p("innerHTML",t,z)}}function Kt(e,a){if(e&1&&M(0,Jt,2,1,"ng-container",14),e&2){let t=c().$implicit;p("flexRender",t.column.columnDef.header)("flexRenderProps",t.getContext())}}function Yt(e,a){if(e&1&&(l(0,"th",13),f(1,Kt,1,2,"ng-container"),r()),e&2){let t=a.$implicit;p("colSpan",t.colSpan),s(),h(t.isPlaceholder?-1:1)}}function Wt(e,a){if(e&1&&(l(0,"tr"),f(1,Lt,1,0,"th",12),y(2,Yt,2,2,"th",13,ri),r()),e&2){let t=a.$implicit;c();let i=A(6);s(),h(i.hiddenColumnIds().size!==0?1:-1),s(),F(t.headers)}}function Zt(e,a){if(e&1){let t=D();l(0,"td",16)(1,"app-table-expansor",25),E("toggleExpand",function(){return x(t),b(null)}),r()()}if(e&2){let t=c(2);s(),p("disabled",t.appService.editando())("isExpanded",!1)}}function Xt(e,a){if(e&1&&(l(0,"option",20),m(1),r()),e&2){let t=a.$implicit;p("value",t.toLowerCase()),s(),k(" ",t," ")}}function eo(e,a){if(e&1&&(l(0,"tr",8),f(1,Zt,2,2,"td",16),l(2,"td",17)(3,"select",18)(4,"option",19),m(5,"Seleccione"),r(),y(6,Xt,2,2,"option",20,se),r()(),l(8,"td",17),_(9,"input",21),r(),l(10,"td",17),_(11,"input",22),r(),l(12,"td",17),m(13),r(),l(14,"td",17),_(15,"span",23),r(),l(16,"td",17),_(17,"acciones-tabla",24),r()()),e&2){let t=c(),i=A(6);s(),h(i.hiddenColumnIds().size!==0?1:-1),s(2),p("formControl",t.tipo_usuario),s(3),F(t.tiposUsuariosDisponibles()),s(3),p("formControl",t.porcentaje_descuento),s(2),p("formControl",t.minutos_retraso),s(2),k(" ",t.fechaActual()," "),s(4),p("visibles",!0)("acciones",t.accionesNuevo())("ngClass","flex justify-between")}}function io(e,a){if(e&1&&(l(0,"tr")(1,"td",26)(2,"span"),m(3,"No hay configuraciones a\xFAn..."),r()()()),e&2){let t=c(),i=A(6);s(),U("colspan",t.tablaTipoUsuarioConfig().getAllColumns().length+(i.hiddenColumnIds().size>0?1:0))}}function to(e,a){if(e&1){let t=D();l(0,"td",16)(1,"app-table-expansor",25),E("toggleExpand",function(){x(t);let o=c().$implicit;return b(o.toggleExpanded())}),r()()}if(e&2){let t=c().$implicit,i=c(2);s(),p("disabled",i.appService.editando())("isExpanded",t.getIsExpanded())}}function oo(e,a){if(e&1&&_(0,"input",29),e&2){let t=c(5);p("formControl",t.porcentaje_descuento)}}function no(e,a){if(e&1&&_(0,"input",30),e&2){let t=c(5);p("formControl",t.minutos_retraso)}}function ao(e,a){if(e&1&&f(0,oo,1,1,"input",29)(1,no,1,1,"input",30),e&2){let t,i=c().$implicit;h((t=i.column.id)==="porcentaje_descuento"?0:t==="retraso_reserva"?1:-1)}}function ro(e,a){if(e&1&&(B(0),_(1,"div",31),O()),e&2){let t=a.$implicit;s(),p("innerHTML",t,z)}}function so(e,a){if(e&1&&M(0,ro,2,1,"ng-container",14),e&2){let t=c().$implicit;p("flexRender",t.column.columnDef.cell)("flexRenderProps",t.getContext())}}function lo(e,a){if(e&1&&(l(0,"td",27),f(1,ao,2,1)(2,so,1,2,"ng-container"),r()),e&2){let t=a.$implicit,i=c().$implicit,o=c(2);s(),h(o.espaciosConfigService.filaConfigEditando()[i.original.id]&&o.esColumnaEditable(t.column.id)?1:2)}}function co(e,a){if(e&1&&_(0,"input",29),e&2){let t=c(8);p("formControl",t.porcentaje_descuento)}}function po(e,a){if(e&1&&_(0,"input",30),e&2){let t=c(8);p("formControl",t.minutos_retraso)}}function mo(e,a){if(e&1&&f(0,co,1,1,"input",29)(1,po,1,1,"input",30),e&2){let t,i=c(2).$implicit;h((t=i.id)==="porcentaje_descuento"?0:t==="retraso_reserva"?1:-1)}}function uo(e,a){if(e&1&&(B(0),_(1,"div",31),O()),e&2){let t=a.$implicit;s(),p("innerHTML",t,z)}}function fo(e,a){if(e&1&&M(0,uo,2,1,"ng-container",14),e&2){let t=c(2).$implicit,i=c(3).$implicit;c(2);let o=A(6);p("flexRender",o.getCell(t,i).column.columnDef.cell)("flexRenderProps",o.getCell(t,i).getContext())}}function ho(e,a){if(e&1&&(l(0,"div",34)(1,"span",35),m(2),r(),l(3,"div"),f(4,mo,2,1)(5,fo,1,2,"ng-container"),r()()),e&2){let t=c().$implicit,i=c(3).$implicit,o=c(2);s(2),k(" ",t.columnDef.header,": "),s(2),h(o.espaciosConfigService.filaConfigEditando()[i.original.id]&&o.esColumnaEditable(t.id)?4:5)}}function _o(e,a){if(e&1&&f(0,ho,6,2,"div",34),e&2){let t=a.$implicit;c(5);let i=A(6);h(i.hiddenColumnIds().has(t.id)?0:-1)}}function go(e,a){if(e&1&&(l(0,"div",33),y(1,_o,1,1,null,null,se),r()),e&2){let t=c(4);s(),F(t.tablaTipoUsuarioConfig().getAllLeafColumns())}}function Co(e,a){if(e&1&&(l(0,"tr",28)(1,"td")(2,"div",32),f(3,go,3,0,"div",33),r()()()),e&2){let t=c().$implicit;c(2);let i=A(6);s(),U("colspan",t.getVisibleCells().length+(i.hiddenColumnIds().size>0?1:0)),s(2),h(i.hiddenColumnIds().size!==0?3:-1)}}function vo(e,a){if(e&1&&(l(0,"tr",8),f(1,to,2,2,"td",16),y(2,lo,3,1,"td",27,ri),r(),f(4,Co,4,2,"tr",28)),e&2){let t=a.$implicit;c(2);let i=A(6);s(),h(i.hiddenColumnIds().size!==0?1:-1),s(),F(t.getVisibleCells()),s(2),h(t.getIsExpanded()&&i.hiddenColumnIds().size!==0?4:-1)}}function xo(e,a){if(e&1&&y(0,vo,5,2,null,null,ri),e&2){let t=c();F(t.tablaTipoUsuarioConfig().getRowModel().rows)}}function bo(e,a){}var Zi=(()=>{let a=class a{constructor(){this.injector=g(te),this.alertasService=g(me),this.espaciosConfigService=g(N),this.alertaService=g(me),this.authService=g(ae),this.permisos=ei,this.tipoUsrConfigEnEdicion=S(null),this.estadoCell=P.required("estadoCell"),this.fechaActual=w(()=>Qe(new Date,"dd/MM/yyyy HH:mm a")),this.tiposUsuarios=w(()=>[Be.Administrativo,Be.Egresado,Be.Estudiante,Be.Externo]),this.tiposUsuariosDisponibles=w(()=>{let i=this.configsTipoUsurioQuery.map(o=>o.tipo_usuario);return this.tiposUsuarios().filter(o=>!i.includes(o))}),this.puedeCrearNueva=w(()=>this.tiposUsuariosDisponibles().length>0),this.accionesNuevo=w(()=>[{icono:"remove-circle-outline",color:"error",tooltip:"Cancelar",eventoClick:i=>this.cancelarCreacion()},{icono:"save-outline",color:"success",tooltip:"Guardar",eventoClick:i=>this.onGuardarNuevo()}]),this.columnasPorDefecto=S([{id:"tipo_usuario",accessorKey:"tipo_usuario",header:"Tipo de Usuario",cell:i=>`<span class="capitalize font-semibold">${i.getValue()}</span>`},{id:"porcentaje_descuento",accessorKey:"porcentaje_descuento",size:150,header:"Porcentaje Descuento",cell:i=>i.getValue()+"%"},{id:"retraso_reserva",accessorKey:"retraso_reserva",size:150,header:"Minutos de Retraso",cell:i=>i.getValue()+" min"},{accessorKey:"creado_en",header:"Creado en",size:200,accessorFn:i=>{let o=new Date(i.creado_en);return isNaN(o.getTime())?"Fecha inv\xE1lida":Qe(o,"dd/MM/yyyy HH:mm a")}},{id:"estado",accessorKey:"eliminado_en",header:"Estado",cell:this.estadoCell},{id:"acciones",header:"Acciones",cell:i=>{let o=i.row.original.id,n=this.espaciosConfigService.filaConfigEditando()[o],d=[];this.authService.tienePermisos(this.permisos.EDITAR_NOVEDADES_ESPACIO)&&d.push({tooltip:"Editar",icono:"pencil-outline",color:"accent",disabled:this.appService.editando(),eventoClick:C=>this.iniciarEdicion(i.row)});let u=n?[{tooltip:"Cancelar",icono:"remove-circle-outline",color:"error",eventoClick:C=>this.onCancelarEdicion(i.row)},{tooltip:"Guardar",icono:"save-outline",color:"success",eventoClick:C=>this.onGuardarEdicion(i.row)}]:d;return re(ue,{inputs:{visibles:i.column.getIsVisible(),acciones:u}})}}]),this.tipo_usuario=new K("",[v.required]),this.porcentaje_descuento=new K(null,[v.required,v.min(0),v.max(100)]),this.minutos_retraso=new K(null,[v.required,v.min(0)]),this.appService=g(X),this.cdr=g(ke),this.celdaAcciones=P.required("celdaAcciones"),this.tableState=S({expanded:{}}),this.modoCreacion=w(()=>this.espaciosConfigService.modoCreacionTipoConfig()),this.tablaTipoUsuarioConfig=Se(()=>({data:this.configsTipoUsurioQuery??[],columns:this.columnasPorDefecto(),getCoreRowModel:ge(),getPaginationRowModel:xe(),getRowCanExpand:()=>!0,autoResetExpanded:!1,getFilteredRowModel:ve(),getExpandedRowModel:Ce(),manualPagination:!0,autoResetPageIndex:!1,state:{expanded:this.tableState().expanded},onExpandedChange:i=>{let o=typeof i=="function"?i(this.tableState().expanded):i;this.tableState.update(n=>I(T({},n),{expanded:o}))}}))}get configsTipoUsurioQuery(){return this.espaciosConfigService.espacioQuery.data()?.tipo_usuario_config||[]}esColumnaEditable(i){return["porcentaje_descuento","retraso_reserva"].includes(i)}cambiarEstadoConfig(i){let o=i.eliminado_en===null?"inactivo":"activo",n=o==="activo"?"activar":"desactivar";this.alertaService.confirmarAccion(`\xBFEst\xE1s seguro de que quieres ${n} a la configuraci\xF3n para <strong>${i.tipo_usuario}</strong>?`,this.espaciosConfigService.alertaEspacioConfigRef(),`${n.charAt(0).toUpperCase()+n.slice(1)} config`,o==="activo"?"success":"warning").then(d=>{d&&this.espaciosConfigService.cambiarEstadoTipoConfig(i.id,o).then(()=>{this.alertaService.success(`Espacio ${n==="activar"?"activado":"desactivado"} exitosamente.`,5e3,this.espaciosConfigService.alertaEspacioConfigRef(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.espaciosConfigService.espacioQuery.refetch()}).catch(u=>{console.error(`Error al ${n} el config:`,u),this.alertaService.error(`Error al ${n} el config. Por favor, int\xE9ntalo de nuevo.`,5e3,this.espaciosConfigService.alertaEspacioConfigRef(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")})})}crearTipoConfig(){if(!this.puedeCrearNueva()){this.alertasService.warning("No hay tipos de usuario disponibles para configurar.",3e3,this.espaciosConfigService.alertaEspacioConfigRef(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4");return}this.espaciosConfigService.setModoCreacionTipoConfig(!0),this.appService.setEditando(!0),this.tipoUsrConfigEnEdicion.set(null),this.tipo_usuario.reset(""),this.porcentaje_descuento.reset(),this.minutos_retraso.reset(),this.cdr.detectChanges()}cancelarCreacion(){this.espaciosConfigService.setModoCreacionTipoConfig(!1),this.appService.setEditando(!1),this.tipo_usuario.reset(""),this.porcentaje_descuento.reset(),this.minutos_retraso.reset(),this.cdr.detectChanges()}onCancelarEdicion(i){let o=i.original.id;this.espaciosConfigService.setEditandoFilaConfig(o,!1),this.espaciosConfigService.setModoCreacionTipoConfig(!1),this.appService.setEditando(!1),this.tipoUsrConfigEnEdicion.set(null),this.tipo_usuario.reset(""),this.porcentaje_descuento.reset(),this.minutos_retraso.reset(),this.cdr.detectChanges()}iniciarEdicion(i){let o=i.original,n=o.id;this.espaciosConfigService.setEditandoFilaConfig(n,!0),this.tipoUsrConfigEnEdicion.set(o),this.appService.setEditando(!0),setTimeout(()=>{this.tipo_usuario.setValue(o.tipo_usuario),this.porcentaje_descuento.setValue(o.porcentaje_descuento),this.minutos_retraso.setValue(o.retraso_reserva),this.tipo_usuario.markAsPristine(),this.porcentaje_descuento.markAsPristine(),this.minutos_retraso.markAsPristine(),this.cdr.detectChanges()},0)}onGuardarEdicion(i){return q(this,null,function*(){if(this.tipo_usuario.markAsTouched(),this.porcentaje_descuento.markAsTouched(),this.minutos_retraso.markAsTouched(),this.tipo_usuario.invalid||this.porcentaje_descuento.invalid||this.minutos_retraso.invalid){this.alertasService.error("Por favor, complete todos los campos requeridos.",5e3,this.espaciosConfigService.alertaEspacioConfigRef(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4");return}let o=i.original,n=I(T({},o),{tipo_usuario:this.tipo_usuario.value,porcentaje_descuento:this.porcentaje_descuento.value,retraso_reserva:this.minutos_retraso.value});try{yield this.espaciosConfigService.actualizarTipoUsuarioConfig(o.id,n),this.alertasService.success("Configuraci\xF3n actualizada exitosamente.",5e3,this.espaciosConfigService.alertaEspacioConfigRef(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.espaciosConfigService.setEditandoFilaConfig(o.id,!1),this.appService.setEditando(!1),this.tipoUsrConfigEnEdicion.set(null),this.tipo_usuario.reset(""),this.porcentaje_descuento.reset(),this.minutos_retraso.reset(),this.espaciosConfigService.espacioQuery.refetch(),this.cdr.detectChanges()}catch(d){console.error("Error al actualizar la configuraci\xF3n:",d),this.alertasService.error("Error al actualizar la configuraci\xF3n. Por favor, int\xE9ntalo de nuevo.",5e3,this.espaciosConfigService.alertaEspacioConfigRef(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}})}onGuardarNuevo(){return q(this,null,function*(){if(this.tipo_usuario.markAsTouched(),this.porcentaje_descuento.markAsTouched(),this.minutos_retraso.markAsTouched(),this.tipo_usuario.invalid||this.porcentaje_descuento.invalid||this.minutos_retraso.invalid){this.alertasService.error("Todos los campos son requeridos.",5e3,this.espaciosConfigService.alertaEspacioConfigRef(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4");return}let i=this.tipo_usuario.value;if(!this.tiposUsuariosDisponibles().includes(i)){this.alertasService.error("El tipo de usuario seleccionado ya est\xE1 configurado.",5e3,this.espaciosConfigService.alertaEspacioConfigRef(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4");return}let o={id_espacio:this.espaciosConfigService.espacioQuery.data()?.id||0,tipo_usuario:i,porcentaje_descuento:this.porcentaje_descuento.value,minutos_retraso:this.minutos_retraso.value};try{yield this.espaciosConfigService.crearTipoUsuarioCofig(o),this.alertasService.success("Configuraci\xF3n creada exitosamente.",5e3,this.espaciosConfigService.alertaEspacioConfigRef(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.cancelarCreacion(),this.espaciosConfigService.espacioQuery.refetch()}catch(n){console.error("Error al crear configuraci\xF3n:",n),this.alertasService.error("Error al crear el configuraci\xF3n. Por favor, int\xE9ntalo de nuevo.",5e3,this.espaciosConfigService.alertaEspacioConfigRef(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}})}};a.\u0275fac=function(o){return new(o||a)},a.\u0275cmp=Q({type:a,selectors:[["tabla-config-tipo-usuario"]],viewQuery:function(o,n){o&1&&(R(n.estadoCell,Ht,5),R(n.celdaAcciones,qt,5)),o&2&&oe(2)},decls:16,vars:4,consts:[["estadoCell",""],["tablaTipoUsuario","responsiveTable"],["alertaRoles",""],[1,"flex","w-full","mb-3"],[1,"btn","btn-primary","h-8",3,"disabled"],[1,"alert","alert-info"],["responsiveTable","",1,"table","w-full","rounded-md","table-sm","sm:table-md","border-t","border-base-200",3,"table"],[1,"sticky","top-0","z-20","bg-base-100"],[1,"bg-base-100"],[3,"click","ngClass"],[1,"btn","btn-primary","h-8",3,"click","disabled"],[3,"nombreIcono","estilos"],[1,"p-2","text-left","first:rounded-tl-md","last:rounded-tr-md","bg-base-100","z-20"],[1,"p-2","text-left","first:rounded-tl-md","last:rounded-tr-md","bg-base-100","z-20",3,"colSpan"],[4,"flexRender","flexRenderProps"],[1,"text-left",3,"innerHTML"],[1,"!pe-0"],[1,"p-2"],["placeholder","Inserte nombre","type","text",1,"select","input-sm","h-9","placeholder:text-gray-400",3,"formControl"],["value","","disabled","","selected",""],[3,"value"],["placeholder","Inserte porcentaje","pattern","[0-9]*","type","number","min","0","max","100","step","1",1,"input","input-sm","h-9","placeholder:text-gray-400",3,"formControl"],["placeholder","Inserte minutos de retraso","pattern","[0-9]*","type","number","min","0","step","1",1,"input","input-sm","h-9","placeholder:text-gray-400",3,"formControl"],[1,"text-sm"],[3,"visibles","acciones","ngClass"],[3,"toggleExpand","disabled","isExpanded"],[1,"text-center","text-gray-500"],[1,"py-1"],[1,"bg-base-300","border-none"],["type","number","min","0","max","100","step","1",1,"input","input-sm","h-9","w-full",3,"formControl"],["type","number","min","0","step","1",1,"input","input-sm","h-9","w-full",3,"formControl"],[3,"innerHTML"],[1,"bg-base-100","rounded-md","p-3","shadow-md","w-full"],[1,"grid","grid-cols-1","gap-4"],[1,"flex","flex-col","gap-2"],[1,"font-bold","text-base-content","text-sm"]],template:function(o,n){o&1&&(M(0,Qt,3,9,"ng-template",null,0,$),l(2,"div",3),f(3,Bt,4,3,"button",4)(4,Ot,4,2,"div",5),r(),l(5,"table",6,1)(7,"thead",7),y(8,Wt,4,1,"tr",null,ri),r(),l(10,"tbody"),f(11,eo,18,8,"tr",8),f(12,io,4,1,"tr")(13,xo,2,0),r()(),M(14,bo,0,0,"ng-template",null,2,$)),o&2&&(s(3),h(n.authService.tienePermisos("ESP000010")&&n.puedeCrearNueva()?3:n.authService.tienePermisos("ESP000010")&&!n.puedeCrearNueva()?4:-1),s(2),p("table",n.tablaTipoUsuarioConfig()),s(3),F(n.tablaTipoUsuarioConfig().getHeaderGroups()),s(3),h(n.modoCreacion()?11:-1),s(),h(!n.configsTipoUsurioQuery.length&&!n.modoCreacion()?12:13))},dependencies:[J,W,Z,Me,Re,le,De,je,ce,ji,Pe,Ze,_e,be,de,ue,ye,Ee,ii],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});let e=a;return e})();var et=vi(Ai());var Xi=(()=>{let a=class a{constructor(){this.http=g(he),this._fecha=S(null),this.fecha=this._fecha.asReadonly(),this.espacioConfigService=g(N)}setFechaSeleccionada(i){this._fecha.set(i)}obtenerConfiguracionPorFecha(){return $i(this.http,this.espacioConfigService.idEspacio(),this._fecha())}};a.\u0275fac=function(o){return new(o||a)},a.\u0275prov=we({token:a,factory:a.\u0275fac,providedIn:"root"});let e=a;return e})();var So=["horaInicioCell"],Eo=["horaFinCell"],yo=["valorCell"],Fo=["fechaPicker"],si=(e,a)=>a.id;function wo(e,a){if(e&1){let t=D();l(0,"button",20),E("click",function(){x(t);let o=c();return b(o.nuevaFranja())}),_(1,"app-web-icon",21),l(2,"span"),m(3,"Nueva franja"),r()()}e&2&&(s(),p("nombreIcono","add-outline"))}function To(e,a){if(e&1&&(l(0,"option",25),m(1),r()),e&2){let t=a.$implicit;p("value",t),s(),Y(t)}}function Io(e,a){if(e&1&&(l(0,"select",22)(1,"option",24),m(2,"Seleccione hora inicio"),r(),y(3,To,2,2,"option",25,se),r()),e&2){let t=c(2);p("formControl",t.horaInicio),s(3),F(t.opcionesTiempo())}}function ko(e,a){if(e&1&&(l(0,"span",23),m(1),r()),e&2){let t=c().$implicit;s(),Y(t.getValue())}}function Do(e,a){if(e&1&&f(0,Io,5,1,"select",22)(1,ko,2,1,"span",23),e&2){let t=a.$implicit,i=c();h(t.row.original.id===-1||i.filaFranjaEditando()[t.row.original.id]?0:1)}}function jo(e,a){if(e&1&&(l(0,"option",25),m(1),r()),e&2){let t=a.$implicit;p("value",t),s(),Y(t)}}function Mo(e,a){if(e&1&&(l(0,"select",22)(1,"option",24),m(2,"Seleccione hora fin"),r(),y(3,jo,2,2,"option",25,se),r()),e&2){let t=c(2);p("formControl",t.horaFin),s(3),F(t.opcionesTiempoFin())}}function Ro(e,a){if(e&1&&(l(0,"span",23),m(1),r()),e&2){let t=c().$implicit;s(),Y(t.getValue())}}function Po(e,a){if(e&1&&f(0,Mo,5,1,"select",22)(1,Ro,2,1,"span",23),e&2){let t=a.$implicit,i=c();h(t.row.original.id===-1||i.filaFranjaEditando()[t.row.original.id]?0:1)}}function Vo(e,a){if(e&1&&_(0,"input",26),e&2){let t=c(2);p("formControl",t.valor)}}function Ao(e,a){if(e&1&&(l(0,"span",27),m(1),Te(2,"number"),r()),e&2){let t=c().$implicit;s(),k("$",Ie(2,1,t.getValue()||0))}}function No(e,a){if(e&1&&f(0,Vo,1,1,"input",26)(1,Ao,3,3,"span",27),e&2){let t=a.$implicit,i=c();h(t.row.original.id===-1||i.filaFranjaEditando()[t.row.original.id]?0:1)}}function Uo(e,a){if(e&1&&(B(0),_(1,"span",30),O()),e&2){let t=a.$implicit;s(),p("innerHTML",t,z)}}function $o(e,a){if(e&1&&M(0,Uo,2,1,"ng-container",29),e&2){let t=c().$implicit;p("flexRender",t.column.columnDef.header)("flexRenderProps",t.getContext())}}function Go(e,a){if(e&1&&(l(0,"th",28),f(1,$o,1,2,"ng-container"),r()),e&2){let t=a.$implicit;p("colSpan",t.colSpan),s(),h(t.isPlaceholder?-1:1)}}function Ho(e,a){if(e&1&&(l(0,"tr"),y(1,Go,2,2,"th",28,si),r()),e&2){let t=a.$implicit;s(),F(t.headers)}}function qo(e,a){if(e&1&&(l(0,"tr")(1,"td",31)(2,"span"),m(3,"No hay franjas horarias configuradas para este d\xEDa..."),r()()()),e&2){let t=c();s(),U("colspan",t.tablaTarifas().getAllColumns().length)}}function zo(e,a){if(e&1&&(B(0),_(1,"div",34),O()),e&2){let t=a.$implicit;s(),p("innerHTML",t,z)}}function Qo(e,a){if(e&1&&(l(0,"td",32),M(1,zo,2,1,"ng-container",29),r()),e&2){let t=a.$implicit;s(),p("flexRender",t.column.columnDef.cell)("flexRenderProps",t.getContext())}}function Bo(e,a){if(e&1&&(B(0),_(1,"div",34),O()),e&2){let t=a.$implicit;s(),p("innerHTML",t,z)}}function Oo(e,a){if(e&1&&(l(0,"li",36)(1,"span",37),m(2),r(),l(3,"span"),M(4,Bo,2,1,"ng-container",29),r()()),e&2){let t=c().$implicit,i=c(3).$implicit;c(2);let o=A(29);s(2),k(" ",t.columnDef.header,": "),s(2),p("flexRender",o.getCell(t,i).column.columnDef.cell)("flexRenderProps",o.getCell(t,i).getContext())}}function Lo(e,a){if(e&1&&f(0,Oo,5,3,"li",36),e&2){let t=a.$implicit;c(5);let i=A(29);h(i.hiddenColumnIds().has(t.id)?0:-1)}}function Jo(e,a){if(e&1&&(l(0,"ul"),y(1,Lo,1,1,null,null,se),r()),e&2){let t=c(4);s(),F(t.tablaTarifas.getAllLeafColumns())}}function Ko(e,a){if(e&1&&(l(0,"tr",33)(1,"td")(2,"div",35),f(3,Jo,3,0,"ul"),r()()()),e&2){let t=c().$implicit;c(2);let i=A(29);s(),U("colspan",t.getVisibleCells().length),s(2),h(i.hiddenColumnIds().size!==0?3:-1)}}function Yo(e,a){if(e&1&&(l(0,"tr",19),y(1,Qo,2,2,"td",32,si),r(),f(3,Ko,4,2,"tr",33)),e&2){let t=a.$implicit;s(),F(t.getVisibleCells()),s(2),h(t.getIsExpanded()?3:-1)}}function Wo(e,a){if(e&1&&y(0,Yo,4,1,null,null,si),e&2){let t=c();F(t.tablaTarifas().getRowModel().rows)}}var li=(()=>{let a=class a{constructor(){this.HORA_APERTURA="05:00",this.injector=g(te),this.espacioConfigService=g(N),this.cdr=g(ke),this.configuracionForm=qe.required(),this.diaNumero=qe.required(),this.permisoFranjas=qe.required(),this.permisoEliminarFranja=qe.required(),this.agregarFranja=He(),this.eliminarFranja=He(),this.authService=g(ae),this.appService=g(X),this.horaInicio=new K("",[v.required]),this.horaFin=new K("",[v.required]),this.valor=new K("",[v.required,v.min(0)]),this.modoCreacion=S(!1),this.horaInicioCellTemplate=P.required("horaInicioCell"),this.horaFinCellTemplate=P.required("horaFinCell"),this.valorCellTemplate=P.required("valorCell"),this.filaFranjaEditando=S({}),this.tableState=S({expanded:{}}),this.minutosUsoSignal=w(()=>{let i=this.configuracionForm();return i?(this.formChangesSignal(),i.get("minutos_uso")?.value||60):60}),this.horaAperturaSignal=w(()=>this.configuracionForm()?(this.formChangesSignal(),this.HORA_APERTURA):this.HORA_APERTURA),this.franjasHorariasSignal=w(()=>{let i=this.configuracionForm();return i?(this.formChangesSignal(),i.get("franjas_horarias")?.value||[]):[]}),this.formChangesSignal=S(0),this.horaInicioSignal=ti(this.horaInicio.valueChanges,{initialValue:null}),this.opcionesTiempo=w(()=>{let i=+this.minutosUsoSignal(),o=this.horaAperturaSignal(),n=this.franjasHorariasSignal().filter(d=>!this.filaFranjaEditando()[d.id]);if(!o||!i||i<=0)return[];try{let[d,u]=o.split(":").map(H=>parseInt(H,10));if(d<0||d>23||u<0||u>59)return[];let C=[],j=d*60+u,ee=24*60;for(;j<ee;){let H=Math.floor(j/60),ie=j%60,Ge=new Date(1970,0,1,H,ie,0);C.push(G(Ge,"hh:mm a")),j+=i}return C.filter(H=>{let ie=this.convertirHoraA24(H);return!this.estaHoraOcupada(ie,n)})}catch(d){return console.error("Error generando opciones de tiempo:",d),[]}}),this.opcionesTiempoFin=w(()=>{let i=this.horaInicioSignal()?this.convertirHoraA24(this.horaInicioSignal()):null;if(!i)return[];let o=+this.minutosUsoSignal(),n=this.franjasHorariasSignal().filter(d=>!this.filaFranjaEditando()[d.id]);try{let[d,u]=i.split(":").map(H=>parseInt(H,10));if(d<0||d>23||u<0||u>59)return[];let C=[],j=d*60+u+o,ee=24*60;for(;j<=ee;){let H=Math.floor(j/60),ie=j%60;if(H>=24)break;let Ge=new Date(1970,0,1,H,ie,0);C.push(G(Ge,"hh:mm a")),j+=o}return C.filter(H=>{let ie=this.convertirHoraA24(H);return!this.validarSolapamientoRango(i,ie,n)})}catch(d){return console.error("Error generando opciones de tiempo:",d),[]}}),this.accionesNuevaFranja=w(()=>[{icono:"remove-circle-outline",color:"error",tooltip:"Cancelar",disabled:this.appService.guardando(),eventoClick:()=>this.cancelarCreacion()},{icono:"save-outline",color:"success",tooltip:"Guardar",disabled:this.appService.guardando(),eventoClick:()=>this.onGuardarNueva()}]),this.columnasPorDefecto=S([{id:"expansor",header:"",size:40,meta:{priority:1/0},cell:i=>re(Ee,{inputs:{isExpanded:i.row.getIsExpanded(),disabled:this.appService.editando()},outputs:{toggleExpand:()=>this.onToggleRow(i.row)}})},{id:"hora_inicio",accessorKey:"hora_inicio",header:"Hora Inicio",meta:{priority:2},size:150,accessorFn:i=>{let o=V(i.hora_inicio,"HH:mm",new Date);return G(o,"hh:mm a")},cell:this.horaInicioCellTemplate},{id:"hora_fin",header:"Hora Fin",accessorFn:i=>{let o=V(i.hora_fin,"HH:mm",new Date);return G(o,"hh:mm a")},accessorKey:"hora_fin",size:150,cell:this.horaFinCellTemplate},{id:"valor",header:"Valor",meta:{priority:1},size:150,accessorKey:"valor",cell:this.valorCellTemplate},{id:"acciones",header:"Acciones",cell:i=>{let o=i.row.original,n=o.id;if(n===-1)return re(ue,{inputs:{acciones:this.accionesNuevaFranja()}});let d=this.filaFranjaEditando()[n]&&!this.modoCreacion(),u=[];return d?u.push({tooltip:"Cancelar",icono:"remove-circle-outline",color:"error",disabled:this.appService.guardando(),eventoClick:C=>this.onCancelarEdicionFranja(n)},{tooltip:"Guardar",icono:"save-outline",color:"success",disabled:this.appService.guardando(),eventoClick:C=>this.onGuardarEdicionFranja(n)}):(u.push({tooltip:"Editar",icono:"pencil-outline",color:"accent",disabled:this.appService.editando()||this.appService.guardando(),eventoClick:C=>this.iniciarEdicionFranja(n)}),this.permisoEliminarFranja()&&u.push({tooltip:"Eliminar",icono:"remove-circle-outline",color:"error",disabled:this.appService.editando()||this.appService.guardando(),eventoClick:C=>this.eliminarFranjaLocal(o,i.row.index)})),re(ue,{inputs:{acciones:u}})}}]),this.tablaTarifas=Se(()=>({data:this.franjasQuery(),columns:this.columnasPorDefecto(),getCoreRowModel:ge(),getFilteredRowModel:ve(),getPaginationRowModel:xe(),getExpandedRowModel:Ce(),getRowCanExpand:()=>!0,autoResetExpanded:!1,state:{expanded:this.tableState().expanded},onExpandedChange:i=>{let o=typeof i=="function"?i(this.tableState().expanded):i;this.tableState.update(n=>I(T({},n),{expanded:o}))}})),this.fechaPicker=P.required("fechaPicker"),this.franjasQuery=w(()=>{let i=this.franjasHorariasSignal();return this.modoCreacion()?[{id:-1,hora_inicio:"",hora_fin:"",valor:0,activa:!0},...i]:i})}ngOnInit(){let i=this.configuracionForm();i.get("minutos_uso")?.value||i.patchValue({minutos_uso:60,dias_previos_apertura:3,hora_apertura:this.HORA_APERTURA,tiempo_cancelacion:60}),i.get("minutos_uso")?.valueChanges.subscribe(()=>{this.formChangesSignal.update(n=>n+1)}),i.get("hora_apertura")?.valueChanges.subscribe(()=>{this.formChangesSignal.update(n=>n+1)});let o=i.get("franjas_horarias");o&&o.valueChanges.subscribe(()=>{this.formChangesSignal.update(n=>n+1)}),L(()=>{this.horaInicioSignal(),this.horaInicio.value?this.horaFin.enable():this.horaFin.disable()},{injector:this.injector}),L(()=>{this.horaAperturaSignal(),this.minutosUsoSignal(),this.horaInicio.value&&(this.horaInicio.reset(),this.horaFin.reset(),this.horaFin.disable())},{injector:this.injector}),L(()=>{let n=this.espacioConfigService.espacioQuery.data()?.aprobar_reserva;this.modoCreacion()&&n?(this.valor.setValue("0",{emitEvent:!1}),this.valor.disable({emitEvent:!1})):this.modoCreacion()&&!n&&this.valor.disabled&&this.valor.enable({emitEvent:!1})},{injector:this.injector})}actualizarFranjasSignal(){this.formChangesSignal.update(i=>i+1)}onToggleRow(i,o=!1){let n=i.id,d=this.tableState().expanded,u;o?u={[n]:!0}:u=d[n]?{}:{[n]:!0},this.tableState.update(C=>I(T({},C),{expanded:u}))}onCancelarFecha(){this.pickaFecha.setDate(null),this.modoCreacion.set(!1)}nuevaFranja(){this.modoCreacion.set(!0),this.espacioConfigService.setCrandoFranja(!0),this.appService.setEditando(!1),this.filaFranjaEditando.set({}),this.espacioConfigService.espacioQuery.data()?.aprobar_reserva?(this.valor.setValue("0",{emitEvent:!1}),this.valor.disable({emitEvent:!1})):(this.valor.disabled&&this.valor.enable({emitEvent:!1}),this.valor.reset())}cancelarCreacion(){this.resetearFormularioCreacion(),this.espacioConfigService.setCrandoFranja(!1)}eliminarFranjaLocal(i,o){this.eliminarFranja.emit({dia:this.diaNumero(),index:o})}onGuardarNueva(){let i=this.espacioConfigService.espacioQuery.data()?.aprobar_reserva;if(this.horaInicio.valid&&this.horaFin.valid&&(this.valor.valid||i)){let o={hora_inicio:this.convertirHoraA24(this.horaInicio.value),hora_fin:this.convertirHoraA24(this.horaFin.value),valor:i?0:+this.valor.value,activa:!0},n=this.franjasHorariasSignal();if(this.validarSolapamientoRango(o.hora_inicio,o.hora_fin,n)){console.error("El horario ingresado se solapa con un horario existente.");return}this.agregarFranja.emit({dia:this.diaNumero(),franja:o}),this.espacioConfigService.setCrandoFranja(!1),this.resetearFormularioCreacion()}}convertirHoraA24(i){let o=V(i,"hh:mm a",new Date);return G(o,"HH:mm")}estaHoraOcupada(i,o){let n=V(i,"HH:mm",new Date);return o.some(d=>{let u=V(d.hora_inicio,"HH:mm",new Date),C=V(d.hora_fin,"HH:mm",new Date);return!$e(n,u)&&$e(n,C)})}validarSolapamientoRango(i,o,n){let d=V(i,"HH:mm",new Date),u=V(o,"HH:mm",new Date);return n.some(C=>{let j=V(C.hora_inicio,"HH:mm",new Date),ee=V(C.hora_fin,"HH:mm",new Date);return $e(d,ee)&&Wi(u,j)})}resetearFormularioCreacion(){this.horaInicio.reset(),this.horaFin.reset(),this.valor.reset(),this.modoCreacion.set(!1),!this.espacioConfigService.espacioQuery.data()?.aprobar_reserva&&this.valor.disabled&&this.valor.enable({emitEvent:!1})}iniciarEdicionFranja(i){let o=this.franjasQuery(),n=o.find(d=>d.id===i);if(n){this.horaInicio.setValue(this.convertirHoraA12(n.hora_inicio)),this.horaFin.setValue(this.convertirHoraA12(n.hora_fin)),this.valor.setValue(n.valor?.toString()||""),this.filaFranjaEditando.update(u=>I(T({},u),{[i]:!0})),this.appService.setEditando(!0);let d=o.findIndex(u=>u.id===i);this.onToggleRow({id:d.toString()},!0)}}onCancelarEdicionFranja(i){this.filaFranjaEditando.update(o=>I(T({},o),{[i]:!1})),this.appService.setEditando(!1),this.tableState.update(o=>I(T({},o),{expanded:{}})),this.horaInicio.reset(),this.horaFin.reset(),this.valor.reset()}onGuardarEdicionFranja(i){if(this.horaInicio.invalid||this.horaFin.invalid||this.valor.invalid)return;let o=this.franjasHorariasSignal(),n=o.find(ie=>ie.id===i),d=o.findIndex(ie=>ie.id===i);if(!n||d===-1)return;let u=I(T({},n),{hora_inicio:this.convertirHoraA24(this.horaInicio.value),hora_fin:this.convertirHoraA24(this.horaFin.value),valor:+this.valor.value}),C=o.filter((ie,Ge)=>Ge!==d);if(this.validarSolapamientoRango(u.hora_inicio,u.hora_fin,C)){console.error("El horario modificado se solapa con un horario existente.");return}this.configuracionForm().get("franjas_horarias").at(d).patchValue(u),this.onCancelarEdicionFranja(i)}convertirHoraA12(i){let o=V(i,"HH:mm",new Date);return G(o,"hh:mm a")}ngOnDestroy(){this.pickaFecha&&this.pickaFecha.destroy()}};a.\u0275fac=function(o){return new(o||a)},a.\u0275cmp=Q({type:a,selectors:[["configuracion-form"]],viewQuery:function(o,n){o&1&&(R(n.horaInicioCellTemplate,So,5),R(n.horaFinCellTemplate,Eo,5),R(n.valorCellTemplate,yo,5),R(n.fechaPicker,Fo,5)),o&2&&oe(4)},inputs:{configuracionForm:[1,"configuracionForm"],diaNumero:[1,"diaNumero"],permisoFranjas:[1,"permisoFranjas"],permisoEliminarFranja:[1,"permisoEliminarFranja"]},outputs:{agregarFranja:"agregarFranja",eliminarFranja:"eliminarFranja"},decls:36,vars:4,consts:[["horaInicioCell",""],["horaFinCell",""],["valorCell",""],["tablaTarifa","responsiveTable"],[3,"formGroup"],[1,"my-4","mt-0","lg:mt-4","grid","grid-cols-[repeat(auto-fill,minmax(15rem,1fr))]","2xl:grid-cols-[repeat(auto-fill,minmax(25rem,1fr))]","w-full","gap-1","gap-x-4"],[1,"flex","justify-between","w-full","gap-1"],["for","minutos_uso",1,"label","text-sm","font-[600]","text-base-content","md:mb-0","md:items-center","max-sm:w-1/2","wrap-break-word","text-wrap"],["type","number","id","minutos_uso","formControlName","minutos_uso","placeholder","60","min","15","max","480","step","15",1,"input","input-bordered","w-full","max-w-36","md:max-w-40","max-sm:input-sm","sm:h-11","rounded-box","placeholder:text-gray-400","placeholder:text-xs","md:placeholder:text-sm","max-sm:w-1/2"],["for","dias_previos_apertura",1,"label","text-sm","font-[600]","text-base-content","md:mb-0","md:items-center","max-sm:w-1/2","wrap-break-word","text-wrap"],["type","number","id","dias_previos_apertura","formControlName","dias_previos_apertura","placeholder","3","min","1","max","30",1,"input","input-bordered","w-full","max-w-36","md:max-w-40","max-sm:input-sm","sm:h-11","rounded-box","placeholder:text-gray-400","placeholder:text-xs","md:placeholder:text-sm","max-sm:w-1/2"],["for","hora_apertura",1,"label","text-sm","font-[600]","text-base-content","md:mb-0","md:items-center","max-sm:w-1/2","wrap-break-word","text-wrap"],["type","time","id","hora_apertura","formControlName","hora_apertura",1,"input","input-bordered","w-full","max-w-36","md:max-w-40","max-sm:input-sm","sm:h-11","rounded-box","placeholder:text-gray-400","placeholder:text-xs","md:placeholder:text-sm","max-sm:w-1/2"],["for","tiempo_cancelacion",1,"label","text-sm","font-[600]","text-base-content","md:mb-0","md:items-center","max-sm:w-1/2","wrap-break-word","text-wrap"],["type","number","id","tiempo_cancelacion","formControlName","tiempo_cancelacion","placeholder","60","min","30","max","1440","step","30",1,"input","input-bordered","w-full","max-w-36","md:max-w-40","max-sm:input-sm","sm:h-11","rounded-box","placeholder:text-gray-400","placeholder:text-xs","md:placeholder:text-sm","max-sm:w-1/2"],[1,"flex","w-full","items-center"],[1,"flex","h-full","text-xl"],[1,"btn","max-sm:btn-xs","btn-primary","h-8","ml-2"],["responsiveTable","",1,"table",3,"table"],[1,"bg-base-100"],[1,"btn","max-sm:btn-xs","btn-primary","h-8","ml-2",3,"click"],["estilos","max-sm:w-4 h-5 max-sm:w-4 w-5 mr-1",3,"nombreIcono"],[1,"select","select-sm","h-9","w-full",3,"formControl"],[1,"text-sm","md:text-base"],["value","","disabled",""],[3,"value"],["placeholder","Valor","type","number","min","0","step","1000",1,"input","input-sm","h-9","placeholder:text-gray-400",3,"formControl"],[1,"font-semibold","text-sm","md:text-base"],[1,"p-2","text-left","first:rounded-tl-md","last:rounded-tr-md","bg-base-100",3,"colSpan"],[4,"flexRender","flexRenderProps"],[1,"text-left",3,"innerHTML"],[1,"text-center","text-gray-500","p-2"],[1,"py-1"],[1,"bg-base-300","border-none"],[3,"innerHTML"],[1,"bg-base-100","rounded-md","p-2","md:p-4","shadow-md","w-full"],[1,"flex","my-2","flex-row","gap-2","items-center"],[1,"font-bold","text-base-content"]],template:function(o,n){o&1&&(l(0,"form",4)(1,"div",5)(2,"div",6)(3,"label",7),m(4," Minutos de uso: "),r(),_(5,"input",8),r(),l(6,"div",6)(7,"label",9),m(8," Dias previos de apertura: "),r(),_(9,"input",10),r(),l(10,"div",6)(11,"label",11),m(12," Hora de apertura: "),r(),_(13,"input",12),r(),l(14,"div",6)(15,"label",13),m(16," Tiempo para cancelar: "),r(),_(17,"input",14),r()()(),l(18,"div",15)(19,"h3",16),m(20,"Franjas Horarias"),r(),f(21,wo,4,1,"button",17),r(),M(22,Do,2,1,"ng-template",null,0,$)(24,Po,2,1,"ng-template",null,1,$)(26,No,2,1,"ng-template",null,2,$),l(28,"table",18,3)(30,"thead",19),y(31,Ho,3,0,"tr",null,si),r(),l(33,"tbody"),f(34,qo,4,1,"tr")(35,Wo,2,0),r()()),o&2&&(p("formGroup",n.configuracionForm()),s(21),h(n.permisoFranjas()?21:-1),s(7),p("table",n.tablaTarifas()),s(3),F(n.tablaTarifas.getHeaderGroups()),s(3),h(n.tablaTarifas().getRowModel().rows.length?35:34))},dependencies:[J,Ii,Z,Ke,Me,Re,le,De,je,ce,Je,Pe,Ze,_e,Ye,We,be,de,ye],encapsulation:2,changeDetection:0});let e=a;return e})();var Zo=["fechaPicker"],Xo=e=>({"text-gray-400":e});function en(e,a){if(e&1){let t=D();l(0,"button",8),E("click",function(){x(t);let o=c();return b(o.limpiarFecha())}),_(1,"app-web-icon",5),r()}e&2&&(s(),p("nombreIcono","close-circle-outline")("estilos","h-6 w-6"))}function tn(e,a){e&1&&(l(0,"div",9),_(1,"span",12),l(2,"p",13),m(3,"Cargando configuraci\xF3n..."),r()())}function on(e,a){e&1&&(l(0,"span"),m(1,"Guardando..."),r())}function nn(e,a){e&1&&(_(0,"app-web-icon",5),l(1,"span"),m(2,"Guardar Configuraci\xF3n"),r()),e&2&&p("nombreIcono","save-outline")("estilos","h-5 w-5 mr-2")}function an(e,a){if(e&1){let t=D();l(0,"div",15)(1,"button",16),E("click",function(){x(t);let o=c(3);return b(o.guardarConfiguracion())}),f(2,on,2,0,"span")(3,nn,3,2),r()()}if(e&2){let t=c(3);s(),fe("btn-loading",t.cargandoConfiguracion()),p("disabled",t.configuracionForm.invalid||t.espacioConfigService.creandoFranja()),s(),h(t.cargandoConfiguracion()?2:3)}}function rn(e,a){if(e&1){let t=D();l(0,"configuracion-form",14),E("agregarFranja",function(o){x(t);let n=c(2);return b(n.agregarFranja(o))})("eliminarFranja",function(o){x(t);let n=c(2);return b(n.eliminarFranja(o))}),r(),f(1,an,4,4,"div",15)}if(e&2){let t=c(2);p("configuracionForm",t.configuracionForm)("diaNumero",0)("permisoFranjas",t.authService.tienePermisos("ESP000013"))("permisoEliminarFranja",t.authService.tienePermisos("ESP000009")),s(),h(t.authService.tienePermisos("ESP000008")?1:-1)}}function sn(e,a){if(e&1){let t=D();l(0,"div",10),_(1,"app-web-icon",5),l(2,"div",17)(3,"span"),m(4,"No hay configuraci\xF3n base disponible para esta fecha."),r(),l(5,"span",18),m(6,"Configure primero la configuraci\xF3n base en la pesta\xF1a correspondiente."),r()(),l(7,"button",19),E("click",function(){x(t);let o=c(2);return b(o.irAConfiguracionBase())}),m(8," Ir a Configuraci\xF3n Base "),r()()}e&2&&(s(),p("nombreIcono","information-circle-outline")("estilos","h-5 w-5"))}function ln(e,a){e&1&&(l(0,"div",11),_(1,"app-web-icon",5),l(2,"span"),m(3,"No se pudo cargar la configuraci\xF3n para la fecha seleccionada."),r()()),e&2&&(s(),p("nombreIcono","warning-outline")("estilos","h-5 w-5"))}function cn(e,a){if(e&1&&(l(0,"div",7),f(1,tn,4,0,"div",9)(2,rn,2,5)(3,sn,9,2,"div",10)(4,ln,4,2,"div",11),r()),e&2){let t=c();s(),h(t.cargandoConfiguracion()?1:t.configuracionCargada()?2:t.necesitaConfiguracionBase()?3:4)}}var it=(()=>{let a=class a{constructor(){this.fb=g(Ve),this.espacioConfigService=g(N),this.configuracionService=g(Ue),this.configPorFechaService=g(Xi),this.alertasService=g(me),this.injector=g(te),this.authService=g(ae),this.fecha=new K(""),this.fechaSeleccionada=S(""),this.cargandoConfiguracion=S(!1),this.configuracionCargada=S(!1),this.necesitaConfiguracionBase=S(!1),this.configuracionForm=this.fb.group({id:[null],id_espacio:[this.espacioConfigService.idEspacio(),[]],fecha:["",[v.required]],minutos_uso:["",[v.required,v.min(15)]],dias_previos_apertura:["",[v.required,v.min(1),v.max(30)]],hora_apertura:["",[v.required]],tiempo_cancelacion:["",[v.required,v.min(30),v.max(1440)]],franjas_horarias:this.fb.array([])}),this.fechaPicker=P.required("fechaPicker"),this.fechaDelServicio=this.configPorFechaService.fecha}ngOnInit(){this.initializePikaday(),L(()=>{this.espacioConfigService.pestana(),this.resetFormulario(),this.fecha.setValue(""),this.fechaSeleccionada.set(""),this.pikaday.setDate(null),this.configuracionCargada.set(!1),this.necesitaConfiguracionBase.set(!1),this.cargandoConfiguracion.set(!1),this.configPorFechaService.setFechaSeleccionada(null),this.espacioConfigService.resetAll()},{injector:this.injector}),L(()=>{let i=this.fechaDelServicio();i?(this.fechaSeleccionada.set(i),this.getConfiguracionPorFecha()):(this.fechaSeleccionada.set(""),this.configuracionCargada.set(!1),this.necesitaConfiguracionBase.set(!1),this.resetFormulario())},{injector:this.injector}),L(()=>{this.espacioConfigService.pestana(),this.resetFormulario(),this.fecha.setValue(""),this.fechaSeleccionada.set(""),this.pikaday.setDate(null),this.configuracionCargada.set(!1),this.necesitaConfiguracionBase.set(!1),this.cargandoConfiguracion.set(!1)},{injector:this.injector})}initializePikaday(){this.pikaday=new et.default({field:this.fechaPicker()?.nativeElement,minDate:new Date,i18n:ze,format:"DD/MM/YYYY",onSelect:i=>{this.configPorFechaService.setFechaSeleccionada(G(i,"yyyy-MM-dd")),this.fecha.setValue(G(i,"dd/MM/yyyy"))}})}getConfiguracionPorFecha(){this.cargandoConfiguracion.set(!0),this.configuracionCargada.set(!1),this.necesitaConfiguracionBase.set(!1),this.configPorFechaService.obtenerConfiguracionPorFecha().then(i=>{if(i.error){i.message&&i.message.includes("configuraci\xF3n base")?(this.necesitaConfiguracionBase.set(!0),this.configuracionCargada.set(!1)):(this.alertasService.error(Object.values(i.errors||{}).join(", "),5e3,this.espacioConfigService.alertaEspacioConfigRef()),this.configuracionCargada.set(!1));return}if(i.data&&i.data){let o=i.data;this.configuracionForm.patchValue({id:o.id,fecha:this.fecha.value,id_espacio:o.id_espacio,minutos_uso:o.minutos_uso,dias_previos_apertura:o.dias_previos_apertura,hora_apertura:o.hora_apertura,tiempo_cancelacion:o.tiempo_cancelacion});let n=this.configuracionForm.get("franjas_horarias");n.clear(),o.franjas_horarias?.length&&o.franjas_horarias.forEach(d=>{let u=this.fb.group({id:[d.id],hora_inicio:[d.hora_inicio],hora_fin:[d.hora_fin],valor:[d.valor],activa:[d.activa]});n.push(u)}),this.configuracionCargada.set(!0)}else this.necesitaConfiguracionBase.set(!0),this.configuracionCargada.set(!1)}).catch(i=>{i.message&&i.message.includes("configuraci\xF3n base")?(this.necesitaConfiguracionBase.set(!0),this.configuracionCargada.set(!1)):(this.alertasService.error(Object.values(i.errors||{}).join(", "),5e3,this.espacioConfigService.alertaEspacioConfigRef()),this.configuracionCargada.set(!1))}).finally(()=>{this.cargandoConfiguracion.set(!1)})}resetFormulario(){this.configuracionForm.reset({id:null,id_espacio:this.espacioConfigService.idEspacio(),fecha:"",minutos_uso:"",dias_previos_apertura:"",hora_apertura:"",tiempo_cancelacion:""})}limpiarFecha(){this.configPorFechaService.setFechaSeleccionada(null),this.pikaday.setDate(null),this.fecha.setValue("")}irAConfiguracionBase(){this.espacioConfigService.setPestana("base")}agregarFranja(i){let o=this.configuracionForm.get("franjas_horarias");o&&o.push(this.fb.control(i.franja))}eliminarFranja(i){let o=this.configuracionForm.get("franjas_horarias");o&&i.index>=0&&i.index<o.length&&o.removeAt(i.index)}guardarConfiguracion(){return q(this,null,function*(){let i=this.configuracionForm;if(i.valid)try{let o=I(T({},i.value),{id_espacio:this.espacioConfigService.idEspacio(),franjas_horarias:i.get("franjas_horarias")?.value||[],fecha:this.fechaSeleccionada()});delete o.dia_semana,yield this.configuracionService.saveConfigMutation.mutateAsync(o),this.alertasService.success("Configuraci\xF3n guardada correctamente",3e3,this.espacioConfigService.alertaEspacioConfigRef(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}catch(o){console.error("Error guardando configuraci\xF3n:",o),this.alertasService.error("Error al guardar la configuraci\xF3n",5e3,this.espacioConfigService.alertaEspacioConfigRef(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")}})}ngOnDestroy(){this.pikaday&&this.pikaday.destroy()}};a.\u0275fac=function(o){return new(o||a)},a.\u0275cmp=Q({type:a,selectors:[["config-por-fecha"]],viewQuery:function(o,n){o&1&&R(n.fechaPicker,Zo,5),o&2&&oe()},decls:9,vars:8,consts:[["fechaPicker",""],[1,"flex","w-full","gap-2","items-center"],["for","fecha",1,"label","text-base","max-sm:text-sm","font-[600]","text-base-content","md:mb-0"],[1,"input","input-bordered","max-sm:input-sm","w-full","max-w-60","sm:h-11","rounded-box",3,"ngClass"],["id","fecha","type","text","placeholder","dd/mm/yyyy",1,"grow","pika-single","placeholder:text-gray-400","placeholder:text-xs","md:placeholder:text-sm",3,"formControl"],[3,"nombreIcono","estilos"],["data-tip","Cancelar",1,"btn","btn-sm","btn-error","btn-soft","btn-circle","tooltip","tooltip-left","lg:tooltip-right"],[1,"mt-4"],["data-tip","Cancelar",1,"btn","btn-sm","btn-error","btn-soft","btn-circle","tooltip","tooltip-left","lg:tooltip-right",3,"click"],[1,"flex","justify-center","items-center","py-8"],[1,"alert","alert-info"],[1,"alert","alert-warning"],[1,"loading","loading-spinner","loading-lg"],[1,"ml-3","text-base-content/70"],[3,"agregarFranja","eliminarFranja","configuracionForm","diaNumero","permisoFranjas","permisoEliminarFranja"],[1,"flex","justify-end","mt-6"],[1,"btn","btn-primary",3,"click","disabled"],[1,"flex","flex-col","gap-2"],[1,"text-sm"],[1,"btn","btn-sm","btn-outline",3,"click"]],template:function(o,n){o&1&&(l(0,"div",1)(1,"label",2),m(2," Seleccione la fecha: "),r(),l(3,"label",3),_(4,"input",4,0)(6,"app-web-icon",5),r(),f(7,en,2,2,"button",6),r(),f(8,cn,5,1,"div",7)),o&2&&(s(3),p("ngClass",ne(6,Xo,!n.fechaSeleccionada())),s(),p("formControl",n.fecha),s(2),p("nombreIcono","calendar-outline")("estilos","h-5 w-5"),s(),h(n.fechaSeleccionada()?7:-1),s(),h(n.fechaSeleccionada()?8:-1))},dependencies:[J,W,Z,le,ce,_e,de,li],encapsulation:2,changeDetection:0});let e=a;return e})();var ci=(e,a)=>a.id;function dn(e,a){if(e&1&&(B(0),_(1,"span",6),O()),e&2){let t=a.$implicit;s(),p("innerHTML",t,z)}}function pn(e,a){if(e&1&&M(0,dn,2,1,"ng-container",5),e&2){let t=c().$implicit;p("flexRender",t.column.columnDef.header)("flexRenderProps",t.getContext())}}function mn(e,a){if(e&1&&(l(0,"th",4),f(1,pn,1,2,"ng-container"),r()),e&2){let t=a.$implicit;p("colSpan",t.colSpan),s(),h(t.isPlaceholder?-1:1)}}function un(e,a){if(e&1&&(l(0,"tr"),y(1,mn,2,2,"th",4,ci),r()),e&2){let t=a.$implicit;s(),F(t.headers)}}function fn(e,a){if(e&1&&(l(0,"tr")(1,"td",7)(2,"span"),m(3,"No hay franjas horarias configuradas..."),r()()()),e&2){let t=c();s(),U("colspan",t.tablaConfigs().getAllColumns().length)}}function hn(e,a){if(e&1&&(B(0),_(1,"div",11),O()),e&2){let t=a.$implicit;s(),p("innerHTML",t,z)}}function _n(e,a){if(e&1&&(l(0,"td",9),M(1,hn,2,1,"ng-container",5),r()),e&2){let t=a.$implicit;s(),p("flexRender",t.column.columnDef.cell)("flexRenderProps",t.getContext())}}function gn(e,a){if(e&1&&(B(0),_(1,"div",11),O()),e&2){let t=a.$implicit;s(),p("innerHTML",t,z)}}function Cn(e,a){if(e&1&&(l(0,"li",16)(1,"span",17),m(2),r(),l(3,"span"),M(4,gn,2,1,"ng-container",5),r()()),e&2){let t=c().$implicit,i=c(3).$implicit;c(2);let o=A(2);s(2),k(" ",t.columnDef.header,": "),s(2),p("flexRender",o.getCell(t,i).column.columnDef.cell)("flexRenderProps",o.getCell(t,i).getContext())}}function vn(e,a){if(e&1&&f(0,Cn,5,3,"li",16),e&2){let t=a.$implicit;c(5);let i=A(2);h(i.hiddenColumnIds().has(t.id)?0:-1)}}function xn(e,a){if(e&1&&(l(0,"ul"),y(1,vn,1,1,null,null,se),r(),_(3,"div",15)),e&2){let t=c(4);s(),F(t.tablaConfigs.getAllLeafColumns())}}function bn(e,a){if(e&1){let t=D();l(0,"configuracion-form",18),E("agregarFranja",function(o){x(t);let n=c(4);return b(n.agregarFranja(o.dia,o.franja))})("eliminarFranja",function(o){x(t);let n=c(4);return b(n.eliminarFranja(o.dia,o.index))}),r()}if(e&2){let t=c(2).$implicit,i=c(2);p("ngClass","flex flex-col h-full w-full px-2 lg:px-4")("configuracionForm",a)("diaNumero",t.original.numero)("permisoFranjas",i.authService.tienePermisos("ESP000006"))("permisoEliminarFranja",i.authService.tienePermisos("ESP000007"))}}function Sn(e,a){e&1&&(l(0,"div",14),_(1,"span",19),l(2,"p",20),m(3," Cargando configuraci\xF3n... "),r()())}function En(e,a){e&1&&(l(0,"span"),m(1,"Guardando..."),r())}function yn(e,a){e&1&&(l(0,"span"),m(1,"Guardar Configuraci\xF3n"),r())}function Fn(e,a){if(e&1){let t=D();l(0,"button",24),E("click",function(){x(t);let o=c(3).$implicit,n=c(2);return b(n.guardarConfiguracion(o.original.numero))}),f(1,En,2,0,"span")(2,yn,2,0,"span"),r()}if(e&2){let t=c(3).$implicit,i=c(2);fe("btn-loading",i.estaGuardando(t.original.numero)),p("disabled",!a.valid||i.estaGuardando(t.original.numero)||i.espacioConfigService.creandoFranja()),s(),h(i.estaGuardando(t.original.numero)?1:2)}}function wn(e,a){if(e&1&&(_(0,"div",21),l(1,"div",22),f(2,Fn,3,4,"button",23),r()),e&2){let t,i=c(2).$implicit,o=c(2);s(2),h((t=o.getFormPorDiaSafe(i.original.numero))?2:-1,t)}}function Tn(e,a){if(e&1&&(l(0,"tr",10)(1,"td")(2,"div",12),f(3,xn,4,0),f(4,bn,1,5,"configuracion-form",13)(5,Sn,4,0,"div",14),f(6,wn,3,1),r()()()),e&2){let t,i=c().$implicit,o=c(2),n=A(2);s(),U("colspan",i.getVisibleCells().length+1),s(2),h(n.hiddenColumnIds().size!==0?3:-1),s(),h((t=o.getFormPorDiaSafe(i.original.numero))?4:5,t),s(2),h(o.authService.tienePermisos("ESP000005")?6:-1)}}function In(e,a){if(e&1&&(l(0,"tr",8),y(1,_n,2,2,"td",9,ci),r(),f(3,Tn,7,4,"tr",10)),e&2){let t=a.$implicit;s(),F(t.getVisibleCells()),s(2),h(t.getIsExpanded()?3:-1)}}function kn(e,a){if(e&1&&y(0,In,4,1,null,null,ci),e&2){let t=c();F(t.tablaConfigs.getRowModel().rows)}}var tt=(()=>{let a=class a{constructor(){this.fb=g(Ve),this.espacioConfigService=g(N),this.configuracionService=g(Ue),this.appService=g(X),this.authService=g(ae),this.dias=S([{nombre:"Lunes",numero:1},{nombre:"Martes",numero:2},{nombre:"Mi\xE9rcoles",numero:3},{nombre:"Jueves",numero:4},{nombre:"Viernes",numero:5},{nombre:"S\xE1bado",numero:6},{nombre:"Domingo",numero:7},{nombre:"Festivos",numero:8}]),this.configuracionesFromQuery=w(()=>this.configuracionService.configsQuery.data()||[]),this.formPorDia=[],this.configuracionesGuardando=S(new Set),this.columnasPorDefecto=S([{id:"expansor",header:"",size:55,cell:i=>re(Ee,{inputs:{isExpanded:i.row.getIsExpanded(),disabled:this.appService.editando()},outputs:{toggleExpand:()=>this.onToggleRow(i.row)}})},{header:"No. D\xEDa",accessorKey:"numero",size:50,cell:i=>i.getValue()},{header:"Nombre",accessorKey:"nombre",cell:i=>i.getValue()},{id:"estado",header:"Estado",size:120,cell:i=>{let o=i.row.original.numero;if(this.formPorDia.length===0)return'<span class="badge badge-ghost">Cargando...</span>';let n=this.tieneConfiguracionGuardada(o),d=this.tieneFranjasConfiguradas(o);return this.estaGuardando(o)?'<span class="badge badge-warning font-semibold max-sm:text-xs">Guardando...</span>':n?d?'<span class="badge badge-success font-semibold max-sm:text-xs">Configurado</span>':'<span class="badge badge-error font-semibold max-sm:text-xs">Sin franjas</span>':'<span class="badge badge-ghost font-semibold max-sm:text-xs">Sin configurar</span>'}}]),this.tableState=S({expanded:{},globalFilter:""}),this.tablaConfigs=Se(()=>({data:this.dias(),columns:this.columnasPorDefecto(),getCoreRowModel:ge(),getPaginationRowModel:xe(),getRowCanExpand:()=>!0,autoResetExpanded:!1,getFilteredRowModel:ve(),getExpandedRowModel:Ce(),manualPagination:!0,autoResetPageIndex:!1,state:{expanded:this.tableState().expanded},onExpandedChange:i=>{let o=typeof i=="function"?i(this.tableState().expanded):i;this.tableState.update(n=>I(T({},n),{expanded:o}))}})),this.inicializarFormulariosVacios(),L(()=>{let i=this.configuracionesFromQuery();i.length>0&&this.actualizarFormulariosConDatos(i)})}inicializarFormulariosVacios(){this.formPorDia=this.dias().map(i=>this.fb.group({id:[null],dia_semana:[i.numero],minutos_uso:[60],dias_previos_apertura:[3],hora_apertura:["08:00"],tiempo_cancelacion:[60],franjas_horarias:this.fb.array([])}))}actualizarFormulariosConDatos(i){this.formPorDia.forEach(o=>{let n=o.get("dia_semana")?.value,d=i.find(u=>u.dia_semana===n);if(d){o.patchValue({id:d.id,minutos_uso:d.minutos_uso,dias_previos_apertura:d.dias_previos_apertura,hora_apertura:d.hora_apertura,tiempo_cancelacion:d.tiempo_cancelacion});let u=o.get("franjas_horarias");u.clear(),d.franjas_horarias?.length&&d.franjas_horarias.forEach(C=>{let j=this.fb.group({id:[C.id],hora_inicio:[C.hora_inicio],hora_fin:[C.hora_fin],valor:[C.valor],activa:[C.activa]});u.push(j)})}})}onToggleRow(i,o=!1){let n=i.id,d=this.tableState().expanded,u;o?u={[n]:!0}:u=d[n]?{}:{[n]:!0},this.tableState.update(C=>I(T({},C),{expanded:u}))}getFormPorDia(i){let o=this.formPorDia.find(n=>n.get("dia_semana")?.value===i);if(!o)throw new Error(`No se encontr\xF3 formulario para el d\xEDa ${i}`);return o}getFormPorDiaSafe(i){return this.formPorDia.length===0?null:this.formPorDia.find(o=>o.get("dia_semana")?.value===i)||null}getFranjasFormArray(i){return this.getFormPorDia(i).get("franjas_horarias")}agregarFranja(i,o){let n=this.getFranjasFormArray(i),d=this.fb.group({hora_inicio:[o.hora_inicio],hora_fin:[o.hora_fin],valor:[o.valor],activa:[!0]});n.push(d)}eliminarFranja(i,o){this.getFranjasFormArray(i).removeAt(o)}obtenerConfiguracionCompleta(){return this.formPorDia.map(i=>I(T({},i.value),{franjas_horarias:i.get("franjas_horarias")?.value||[]}))}validarConfiguraciones(){return this.formPorDia.every(i=>i.valid)}guardarConfiguracion(i){return q(this,null,function*(){let o=this.getFormPorDia(i);if(!o.valid){console.warn("Formulario inv\xE1lido para el d\xEDa",i);return}this.configuracionesGuardando.update(n=>new Set(n).add(i));try{let n=I(T({},o.value),{id_espacio:this.espacioConfigService.idEspacio(),franjas_horarias:o.get("franjas_horarias")?.value||[]});yield this.configuracionService.saveConfigMutation.mutateAsync(n)}catch(n){console.error("Error guardando configuraci\xF3n:",n)}finally{this.configuracionesGuardando.update(n=>{let d=new Set(n);return d.delete(i),d})}})}estaGuardando(i){return this.configuracionesGuardando().has(i)}tieneConfiguracionGuardada(i){return this.configuracionesFromQuery().some(n=>n.dia_semana===i)}tieneFranjasConfiguradas(i){let n=this.configuracionesFromQuery().find(d=>d.dia_semana===i);return n?(n.franjas_horarias?.length||0)>0:!1}};a.\u0275fac=function(o){return new(o||a)},a.\u0275cmp=Q({type:a,selectors:[["config-base"]],decls:10,vars:2,consts:[["tablaBase","responsiveTable"],[1,"overflow-y-auto","max-h-full"],["responsiveTable","",1,"table","w-full","rounded-md","table-sm","sm:table-md",3,"table"],[1,"sticky","top-0","z-20","bg-base-100","shadow-sm"],[1,"p-2","text-left","first:rounded-tl-md","last:rounded-tr-md","bg-base-100","border-b","border-base-300",3,"colSpan"],[4,"flexRender","flexRenderProps"],[1,"text-left",3,"innerHTML"],[1,"text-center","text-gray-500","p-2"],[1,"bg-base-100"],[1,"py-1"],[1,"bg-base-300","border-none"],[3,"innerHTML"],[1,"bg-base-100","rounded-md","p-1","px-3","shadow-md","w-full"],[3,"ngClass","configuracionForm","diaNumero","permisoFranjas","permisoEliminarFranja"],[1,"text-center","p-4"],[1,"divider","my-1"],[1,"flex","my-2","flex-row","gap-2","items-center"],[1,"font-bold","text-base-content"],[3,"agregarFranja","eliminarFranja","ngClass","configuracionForm","diaNumero","permisoFranjas","permisoEliminarFranja"],[1,"loading","loading-spinner","loading-md"],[1,"text-sm","text-gray-500","mt-2"],[1,"divider","my-2"],[1,"flex","justify-end","px-1","lg:px-4","lg:pb-4","pb-1"],[1,"btn","btn-primary","max-sm:btn-sm","sm:h-11",3,"btn-loading","disabled"],[1,"btn","btn-primary","max-sm:btn-sm","sm:h-11",3,"click","disabled"]],template:function(o,n){o&1&&(l(0,"div",1)(1,"table",2,0)(3,"thead",3),y(4,un,3,0,"tr",null,ci),r(),_(6,"tbody"),l(7,"tbody"),f(8,fn,4,1,"tr")(9,kn,2,0),r()()()),o&2&&(s(),p("table",n.tablaConfigs()),s(3),F(n.tablaConfigs.getHeaderGroups()),s(4),h(n.tablaConfigs().getRowModel().rows.length?9:8))},dependencies:[J,W,Z,ye,be,li],encapsulation:2,changeDetection:0});let e=a;return e})();var Ci=vi(Ai());var ot=(()=>{let a=class a{constructor(){this.http=g(he),this.queryClient=Ri(),this.espacioConfigService=g(N),this._modoCreacion=S(!1),this._filaEditando=S({}),this._novedadSeleccionada=S(null),this.modoCreacion=w(()=>this._modoCreacion()),this.filaEditando=w(()=>this._filaEditando()),this.novedadSeleccionada=w(()=>this._novedadSeleccionada()),this.novedadesQuery=Xe(()=>({queryKey:["novedades",this.espacioConfigService.idEspacio()],queryFn:()=>Hi(this.http,this.espacioConfigService.idEspacio()),enabled:this.espacioConfigService.idEspacio()!==null})),this.crearNovedadMutation=Ae(()=>({mutationFn:i=>gi(this.http,i),onSuccess:()=>{this.queryClient.invalidateQueries({queryKey:["novedades",this.espacioConfigService.idEspacio()]})}})),this.actualizarNovedadMutation=Ae(()=>({mutationFn:({id:i,novedad:o})=>_i(this.http,i,o),onSuccess:()=>{this.queryClient.invalidateQueries({queryKey:["novedades",this.espacioConfigService.idEspacio()]})}})),this.eliminarNovedadMutation=Ae(()=>({mutationFn:({id:i,estado:o})=>Ui(this.http,i,o),onSuccess:()=>{this.queryClient.invalidateQueries({queryKey:["novedades",this.espacioConfigService.idEspacio()]})}}))}setModoCreacion(i){this._modoCreacion.set(i)}setEditandoFila(i,o){this._filaEditando.update(n=>I(T({},n),{[i]:o}))}setNovedadSeleccionada(i){this._novedadSeleccionada.set(i)}iniciarCrearNovedad(){this.setModoCreacion(!0),this.setEditandoFila(0,!0)}crearNovedad(i){return q(this,null,function*(){let o=this.espacioConfigService.idEspacio();if(o===null)throw new Error("No se ha seleccionado un espacio");let n=I(T({},i),{id_espacio:o});return gi(this.http,n)})}actualizarNovedad(i,o){return q(this,null,function*(){return _i(this.http,i,o)})}cambiarEstadoNovedad(i,o){return this.eliminarNovedadMutation.mutateAsync({id:i,estado:o})}invalidarQueries(){this.queryClient.invalidateQueries({queryKey:["novedades",this.espacioConfigService.idEspacio()]})}resetAll(){this._modoCreacion.set(!1),this._filaEditando.set({}),this._novedadSeleccionada.set(null)}};a.\u0275fac=function(o){return new(o||a)},a.\u0275prov=we({token:a,factory:a.\u0275fac,providedIn:"root"});let e=a;return e})();var Dn=["estadoCell"],jn=["fechaInicioCell"],Mn=["fechaFinCell"],Rn=["horaInicioCell"],Pn=["horaFinCell"],Vn=["descripcionCell"],An=["fechaInicioPicker"],Nn=["fechaFinPicker"],Un=(e,a,t)=>({"badge font-semibold min-w-20 hover:cursor-pointer hover:scale-105 transition-all tooltip tooltip-right lg:tooltip-left align-middle":!0,"badge-success":e,"badge-error":a,"opacity-50 pointer-events-none badge-ghost":t}),nt=()=>({"pika-single grow w-full h-11 rounded-box placeholder:text-xs md:placeholder:text-sm":!0}),di=(e,a)=>a.id;function $n(e,a){e&1&&(l(0,"span",15),m(1,"Nuevo"),r())}function Gn(e,a){if(e&1){let t=D();l(0,"div",17),E("click",function(){x(t);let o=c().$implicit,n=c();return b(n.authService.tienePermisos("ESP000012")?n.appService.editando()?null:n.cambiarEstadoNovedad(o.row.original):null)}),m(1),Te(2,"upperFirst"),r()}if(e&2){let t=c().$implicit,i=c();p("ngClass",Le(6,Un,t.getValue()===null,t.getValue()!==null,i.appService.editando())),U("data-tip",t.getValue()===null?"Desactivar":"Activar")("disabled",i.appService.guardando()),s(),k(" ",Ie(2,4,t.getValue()===null?"activo":"inactivo")," ")}}function Hn(e,a){if(e&1&&f(0,$n,2,0,"span",15)(1,Gn,3,10,"div",16),e&2){let t=a.$implicit;h(t.row.original.id===-1?0:1)}}function qn(e,a){if(e&1&&(l(0,"label",18),_(1,"input",20,8)(3,"app-web-icon",21),r()),e&2){let t=c(2);s(),p("formControl",t.fechaInicio)("ngClass",fi(4,nt)),s(2),p("nombreIcono","calendar-outline")("estilos","h-5 w-5")}}function zn(e,a){if(e&1&&(l(0,"span",19),m(1),r()),e&2){let t=c().$implicit;s(),Y(t.getValue())}}function Qn(e,a){if(e&1&&f(0,qn,4,5,"label",18)(1,zn,2,1,"span",19),e&2){let t=a.$implicit,i=c();h(t.row.original.id===-1||i.novedadesService.filaEditando()[t.row.original.id]?0:1)}}function Bn(e,a){if(e&1&&(l(0,"label",18),_(1,"input",22,9)(3,"app-web-icon",21),r()),e&2){let t=c(2);s(),p("formControl",t.fechaFin)("ngClass",fi(4,nt)),s(2),p("nombreIcono","calendar-outline")("estilos","h-5 w-5")}}function On(e,a){if(e&1&&(l(0,"span",19),m(1),r()),e&2){let t=c().$implicit;s(),Y(t.getValue())}}function Ln(e,a){if(e&1&&f(0,Bn,4,5,"label",18)(1,On,2,1,"span",19),e&2){let t=a.$implicit,i=c();h(t.row.original.id===-1||i.novedadesService.filaEditando()[t.row.original.id]?0:1)}}function Jn(e,a){if(e&1&&_(0,"input",23),e&2){let t=c(2);p("formControl",t.horaInicio)}}function Kn(e,a){if(e&1&&(l(0,"span",19),m(1),r()),e&2){let t=c().$implicit;s(),Y(t.getValue())}}function Yn(e,a){if(e&1&&f(0,Jn,1,1,"input",23)(1,Kn,2,1,"span",19),e&2){let t=a.$implicit,i=c();h(t.row.original.id===-1||i.novedadesService.filaEditando()[t.row.original.id]?0:1)}}function Wn(e,a){if(e&1&&_(0,"input",23),e&2){let t=c(2);p("formControl",t.horaFin)}}function Zn(e,a){if(e&1&&(l(0,"span",19),m(1),r()),e&2){let t=c().$implicit;s(),Y(t.getValue())}}function Xn(e,a){if(e&1&&f(0,Wn,1,1,"input",23)(1,Zn,2,1,"span",19),e&2){let t=a.$implicit,i=c();h(t.row.original.id===-1||i.novedadesService.filaEditando()[t.row.original.id]?0:1)}}function ea(e,a){if(e&1&&_(0,"textarea",24),e&2){let t=c(2);p("formControl",t.descripcion)}}function ia(e,a){if(e&1&&(l(0,"span",25),m(1),r()),e&2){let t=c().$implicit;s(),Y(t.getValue())}}function ta(e,a){if(e&1&&f(0,ea,1,1,"textarea",24)(1,ia,2,1,"span",25),e&2){let t=a.$implicit,i=c();h(t.row.original.id===-1||i.novedadesService.filaEditando()[t.row.original.id]?0:1)}}function oa(e,a){if(e&1){let t=D();l(0,"button",26),E("click",function(){x(t);let o=c();return b(o.novedadesService.iniciarCrearNovedad())}),_(1,"app-web-icon",21),m(2," Nueva Novedad "),r()}if(e&2){let t=c();p("disabled",t.appService.editando()||t.appService.guardando()||t.novedadesService.novedadesQuery.isFetching()),s(),p("nombreIcono","add-outline")("estilos","h-5 w-5")}}function na(e,a){if(e&1&&(B(0),_(1,"span",29),O()),e&2){let t=a.$implicit;s(),p("innerHTML",t,z)}}function aa(e,a){if(e&1&&M(0,na,2,1,"ng-container",28),e&2){let t=c().$implicit;p("flexRender",t.column.columnDef.header)("flexRenderProps",t.getContext())}}function ra(e,a){if(e&1&&(l(0,"th",27),f(1,aa,1,2,"ng-container"),r()),e&2){let t=a.$implicit;p("colSpan",t.colSpan),s(),h(t.isPlaceholder?-1:1)}}function sa(e,a){if(e&1&&(l(0,"tr"),y(1,ra,2,2,"th",27,di),r()),e&2){let t=a.$implicit;s(),F(t.headers)}}function la(e,a){if(e&1&&(l(0,"tr")(1,"td",30)(2,"span"),m(3,"No hay novedades registradas"),r()()()),e&2){let t=c(),i=A(15);s(),U("colspan",t.tablaNovedades().getAllColumns().length+(i.hiddenColumnIds().size>0?1:0))}}function ca(e,a){if(e&1&&(B(0),_(1,"div",34),O()),e&2){let t=a.$implicit;s(),p("innerHTML",t,z)}}function da(e,a){if(e&1&&(l(0,"td",32),M(1,ca,2,1,"ng-container",28),r()),e&2){let t=a.$implicit;s(),p("flexRender",t.column.columnDef.cell)("flexRenderProps",t.getContext())}}function pa(e,a){if(e&1&&(B(0),_(1,"div",34),O()),e&2){let t=a.$implicit;s(),p("innerHTML",t,z)}}function ma(e,a){if(e&1&&(l(0,"li",38)(1,"span",39),m(2),r(),l(3,"span",40),M(4,pa,2,1,"ng-container",28),r()()),e&2){let t=c().$implicit,i=c(3).$implicit;c(2);let o=A(15);s(2),k(" ",t.columnDef.header,": "),s(2),p("flexRender",o.getCell(t,i).column.columnDef.cell)("flexRenderProps",o.getCell(t,i).getContext())}}function ua(e,a){if(e&1&&f(0,ma,5,3,"li",38),e&2){let t=a.$implicit;c(5);let i=A(15);h(i.hiddenColumnIds().has(t.id)?0:-1)}}function fa(e,a){if(e&1&&(_(0,"div",36),l(1,"div",37)(2,"ul"),y(3,ua,1,1,null,null,se),r()()),e&2){let t=c(4);s(3),F(t.tablaNovedades().getAllLeafColumns())}}function ha(e,a){if(e&1&&(l(0,"tr",33)(1,"td")(2,"div",35),f(3,fa,5,0),r()()()),e&2){let t=c().$implicit;c(2);let i=A(15);s(),U("colspan",t.getVisibleCells().length+1),s(2),h(i.hiddenColumnIds().size!==0?3:-1)}}function _a(e,a){if(e&1&&(l(0,"tr",31),y(1,da,2,2,"td",32,di),r(),f(3,ha,4,2,"tr",33)),e&2){let t=a.$implicit;s(),F(t.getVisibleCells()),s(2),h(t.getIsExpanded()?3:-1)}}function ga(e,a){if(e&1&&y(0,_a,4,1,null,null,di),e&2){let t=c();F(t.tablaNovedades().getRowModel().rows)}}function Ca(e,a){}var at=(()=>{let a=class a{constructor(){this.injector=g(te),this.alertasService=g(me),this.cdr=g(ke),this.novedadesService=g(ot),this.espacioConfigService=g(N),this.authService=g(ae),this.appService=g(X),this.estilosAlerta="fixed flex p-4 transition-all ease-in-out bottom-4 right-4",this.permisos=ei,this.modoCreacion=w(()=>this.novedadesService.modoCreacion()),this.fechaActual=w(()=>Qe(new Date,"dd/MM/yyyy HH:mm a")),this.fechaInicio=new K("",[v.required]),this.fechaFin=new K(""),this.horaInicio=new K("",[v.required]),this.horaFin=new K("",[v.required]),this.descripcion=new K("",[v.required,v.minLength(5),v.maxLength(13)]),this.novedadEnEdicion=S(null),this.estadoCell=P.required("estadoCell"),this.fechaInicioCell=P.required("fechaInicioCell"),this.fechaFinCell=P.required("fechaFinCell"),this.horaInicioCell=P.required("horaInicioCell"),this.horaFinCell=P.required("horaFinCell"),this.descripcionCell=P.required("descripcionCell"),this.fechaInicioPicker=P("fechaInicioPicker"),this.fechaFinPicker=P("fechaFinPicker"),this.tableState=S({expanded:{}}),this.paginacion=S({pageIndex:0,pageSize:10}),this.columnasPorDefecto=S([{id:"expansor",header:"",size:40,cell:i=>re(Ee,{inputs:{isExpanded:i.row.getIsExpanded(),disabled:this.appService.editando()},outputs:{toggleExpand:()=>this.onToggleRow(i.row)}})},{id:"fecha_inicio",accessorKey:"fecha_inicio",header:"Fecha Inicio",size:120,cell:this.fechaInicioCell},{id:"fecha_fin",accessorKey:"fecha_fin",header:"Fecha Fin",size:120,cell:this.fechaFinCell},{id:"hora_inicio",accessorKey:"hora_inicio",header:"Hora Inicio",size:100,cell:this.horaInicioCell},{id:"hora_fin",accessorKey:"hora_fin",header:"Hora Fin",size:100,cell:this.horaFinCell},{id:"descripcion",accessorKey:"descripcion",header:"Descripci\xF3n",size:300,cell:this.descripcionCell},{id:"estado",accessorKey:"eliminado_en",header:"Estado",size:200,cell:this.estadoCell},{id:"acciones",header:"Acciones",size:150,cell:i=>{let n=i.row.original.id;if(n===-1)return re(ue,{inputs:{acciones:[{tooltip:"Cancelar",icono:"remove-circle-outline",color:"error",disabled:this.appService.guardando(),eventoClick:j=>this.cancelarCreacion()},{tooltip:"Guardar",icono:"save-outline",color:"success",disabled:this.appService.guardando(),eventoClick:j=>this.onGuardarNuevo()}]}});let d=this.novedadesService.filaEditando()[n],u=[];this.authService.tienePermisos(this.permisos.EDITAR_NOVEDADES_ESPACIO)&&u.push({tooltip:"Editar",icono:"pencil-outline",color:"accent",disabled:this.appService.editando()||this.appService.guardando(),eventoClick:j=>this.iniciarEdicion(i.row)});let C=d?[{tooltip:"Cancelar",icono:"remove-circle-outline",color:"error",disabled:this.appService.guardando(),eventoClick:j=>this.onCancelarEdicion(i.row)},{tooltip:"Guardar",icono:"save-outline",color:"success",disabled:this.appService.guardando(),eventoClick:j=>this.onGuardarEdicion(i.row)}]:u;return re(ue,{inputs:{acciones:C}})}}]),this.tablaNovedades=Se(()=>({data:this.novedadesQuery??[],columns:this.columnasPorDefecto(),getCoreRowModel:ge(),getPaginationRowModel:xe(),getRowCanExpand:()=>!0,autoResetExpanded:!1,getFilteredRowModel:ve(),getExpandedRowModel:Ce(),manualPagination:!0,autoResetPageIndex:!1,state:{expanded:this.tableState().expanded,pagination:this.paginacion()},onExpandedChange:i=>{let o=typeof i=="function"?i(this.tableState().expanded):i;this.tableState.update(n=>I(T({},n),{expanded:o}))},onPaginationChange:i=>{let o=typeof i=="function"?i(this.paginacion()):i;this.paginacion.set(o)}})),this.descripcion.valueChanges.subscribe(i=>{i&&i.length>13&&this.descripcion.setValue(i.slice(0,13),{emitEvent:!1})})}ngOnInit(){L(()=>{let i=this.modoCreacion(),o=this.novedadesService.filaEditando(),n=Object.values(o).some(d=>d);i||n?setTimeout(()=>{this.initializePikaday()},100):!this.fechaInicio.value&&!this.fechaFin.value&&this.limpiarFormulario()},{injector:this.injector})}ngAfterViewInit(){}initializePikaday(){if(!this.fechaInicioPicker()?.nativeElement||!this.fechaFinPicker()?.nativeElement)return;this.pikadayInicio&&this.pikadayInicio.destroy(),this.pikadayFin&&this.pikadayFin.destroy();let i=null,o=null,n=()=>{i&&this.pikadayInicio&&this.pikadayFin&&(this.pikadayInicio.setStartRange(i),this.pikadayInicio.setEndRange(o),this.pikadayFin.setStartRange(i),this.pikadayFin.setMinDate(i),o&&this.pikadayFin.setEndRange(o))},d=()=>{o&&this.pikadayInicio&&this.pikadayFin&&(this.pikadayInicio.setEndRange(o),this.pikadayInicio.setMaxDate(o),this.pikadayFin.setEndRange(o),i&&this.pikadayInicio.setStartRange(i))};this.pikadayInicio=new Ci.default({field:this.fechaInicioPicker()?.nativeElement,format:"DD/MM/YYYY",firstDay:1,minDate:new Date,yearRange:[new Date().getFullYear(),new Date().getFullYear()+5],i18n:ze,onSelect:j=>{i=j;let ee=G(i,"dd/MM/yyyy");this.fechaInicio.setValue(ee),this.fechaInicio.markAsTouched(),o&&$e(o,i)&&(o=null,this.fechaFin.setValue(""),this.pikadayFin&&this.pikadayFin.setDate(null)),n(),this.cdr.detectChanges()}}),this.pikadayFin=new Ci.default({field:this.fechaFinPicker()?.nativeElement,format:"DD/MM/YYYY",firstDay:1,minDate:new Date,yearRange:[new Date().getFullYear(),new Date().getFullYear()+5],i18n:ze,onSelect:j=>{o=j;let ee=G(o,"dd/MM/yyyy");this.fechaFin.setValue(ee),this.fechaFin.markAsTouched(),d(),this.cdr.detectChanges()}});let u=this.fechaInicio.value,C=this.fechaFin.value;u&&(i=V(u,"dd/MM/yyyy",new Date),this.pikadayInicio.setDate(i),n()),C&&(o=V(C,"dd/MM/yyyy",new Date),this.pikadayFin.setDate(o),d())}updatePikadayValues(i,o){if(this.pikadayInicio&&i){let n=V(i,"dd/MM/yyyy",new Date);this.pikadayInicio.setDate(n),this.pikadayInicio.setStartRange(n)}if(this.pikadayFin&&o){let n=V(o,"dd/MM/yyyy",new Date);if(this.pikadayFin.setDate(n),this.pikadayFin.setEndRange(n),i&&this.pikadayInicio){let d=V(i,"dd/MM/yyyy",new Date);this.pikadayFin.setMinDate(d),this.pikadayFin.setStartRange(d),this.pikadayInicio.setEndRange(n),this.pikadayInicio.setMaxDate(n)}}}get novedadesQuery(){let i=this.novedadesService.novedadesQuery.data()?.data||[];return this.modoCreacion()?[{id:-1,id_espacio:this.espacioConfigService.idEspacio()||0,fecha_inicio:"",fecha_fin:"",hora_inicio:"",hora_fin:"",descripcion:"",creado_en:this.fechaActual(),eliminado_en:null,creado_por:this.authService.usuario().id,actualizado_en:"",actualizado_por:null,eliminado_por:null},...i]:i}iniciarEdicion(i){let o=i.original,n=o.id;this.novedadesService.setEditandoFila(n,!0),this.novedadesService.setNovedadSeleccionada(o),this.appService.setEditando(!0),setTimeout(()=>{let d=G(V(o.fecha_inicio,"yyyy-MM-dd",new Date),"dd/MM/yyyy"),u=G(V(o.fecha_fin,"yyyy-MM-dd",new Date),"dd/MM/yyyy");this.fechaInicio.setValue(d),this.fechaFin.setValue(u),this.horaInicio.setValue(o.hora_inicio),this.horaFin.setValue(o.hora_fin),this.descripcion.setValue(o.descripcion),this.fechaInicio.markAsPristine(),this.fechaFin.markAsPristine(),this.horaInicio.markAsPristine(),this.horaFin.markAsPristine(),this.descripcion.markAsPristine(),this.updatePikadayValues(d,u),this.onToggleRow(i,!0),this.cdr.detectChanges()},0)}onCancelarEdicion(i){let o=i.original.id;this.novedadesService.setEditandoFila(o,!1),this.appService.setEditando(!1),this.novedadesService.setNovedadSeleccionada(null),this.tableState.update(n=>I(T({},n),{expanded:{}})),this.limpiarFormulario(),this.cdr.detectChanges()}cancelarCreacion(){this.novedadesService.setModoCreacion(!1),this.appService.setEditando(!1),this.tableState.update(i=>I(T({},i),{expanded:{}})),this.limpiarFormulario(),this.cdr.detectChanges()}onGuardarNuevo(){return q(this,null,function*(){if(this.marcarTodosTouched(),this.formularioInvalido()){this.alertasService.error("Todos los campos son requeridos.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta);return}this.appService.setGuardando(!0);let i=G(V(this.fechaInicio.value,"dd/MM/yyyy",new Date),"yyyy-MM-dd"),o=this.fechaFin.value?G(V(this.fechaFin.value,"dd/MM/yyyy",new Date),"yyyy-MM-dd"):void 0,n={fecha_inicio:i,fecha_fin:o,hora_inicio:this.horaInicio.value,hora_fin:this.horaFin.value,descripcion:this.descripcion.value};try{yield this.novedadesService.crearNovedad(n),this.alertasService.success("Novedad creada exitosamente.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta),this.novedadesService.invalidarQueries(),this.finalizarOperacion()}catch(d){console.error("Error al crear novedad:",d),this.alertasService.error("Error al crear la novedad. Intente de nuevo.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta)}finally{this.appService.setGuardando(!1)}})}onGuardarEdicion(i){return q(this,null,function*(){if(this.marcarTodosTouched(),this.formularioInvalido()){this.alertasService.error("Complete los campos necesarios.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta);return}this.appService.setGuardando(!0);let o=i.original,n=G(V(this.fechaInicio.value,"dd/MM/yyyy",new Date),"yyyy-MM-dd"),d=G(V(this.fechaFin.value,"dd/MM/yyyy",new Date),"yyyy-MM-dd"),u={fecha_inicio:n,fecha_fin:d,hora_inicio:this.horaInicio.value,hora_fin:this.horaFin.value,descripcion:this.descripcion.value};try{yield this.novedadesService.actualizarNovedad(o.id,I(T({},o),{fecha_inicio:n,fecha_fin:d,hora_inicio:this.horaInicio.value,hora_fin:this.horaFin.value,descripcion:this.descripcion.value})),this.alertasService.success("Novedad actualizada exitosamente.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta),this.novedadesService.invalidarQueries(),this.finalizarOperacion(),this.novedadesService.setEditandoFila(o.id,!1)}catch(C){console.error("Error al actualizar novedad:",C),this.alertasService.error("Error al actualizar la novedad. Intente de nuevo.",5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta)}finally{this.appService.setGuardando(!1)}})}cambiarEstadoNovedad(i){let o=i.eliminado_en===null?"inactivo":"activo",n=o==="activo"?"activar":"desactivar";this.appService.setGuardando(!0),this.cdr.detectChanges(),this.alertasService.confirmarAccion(`\xBFEst\xE1s seguro de que quieres ${n} esta novedad?`,this.espacioConfigService.alertaEspacioConfigRef(),`${n.charAt(0).toUpperCase()+n.slice(1)} novedad`,o==="activo"?"success":"warning").then(d=>q(this,null,function*(){if(d)try{yield this.novedadesService.cambiarEstadoNovedad(i.id,o),this.alertasService.success(`Novedad ${n==="activar"?"activada":"desactivada"} exitosamente.`,5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta)}catch(u){console.error(`Error al ${n} novedad:`,u),this.alertasService.error(`Error al ${n} la novedad. Intente de nuevo.`,5e3,this.espacioConfigService.alertaEspacioConfigRef(),this.estilosAlerta)}this.appService.setGuardando(!1)}))}onToggleRow(i,o=!1){let n=i.id,d=this.tableState().expanded,u;o?u={[n]:!0}:u=I(T({},d),{[n]:!d[n]}),this.tableState.update(C=>I(T({},C),{expanded:u}))}onPageChange(i){this.paginacion.set(i)}marcarTodosTouched(){this.fechaInicio.markAsTouched(),this.fechaFin.markAsTouched(),this.horaInicio.markAsTouched(),this.horaFin.markAsTouched(),this.descripcion.markAsTouched()}formularioInvalido(){return this.fechaInicio.invalid||this.fechaFin.invalid||this.horaInicio.invalid||this.horaFin.invalid||this.descripcion.invalid}limpiarFormulario(){this.fechaInicio.reset(""),this.fechaFin.reset(""),this.horaInicio.reset(""),this.horaFin.reset(""),this.descripcion.reset(""),this.pikadayInicio&&(this.pikadayInicio.setDate(null),this.pikadayInicio.setStartRange(null),this.pikadayInicio.setEndRange(null),this.pikadayInicio.setMinDate(new Date),this.pikadayInicio.setMaxDate(null)),this.pikadayFin&&(this.pikadayFin.setDate(null),this.pikadayFin.setStartRange(null),this.pikadayFin.setEndRange(null),this.pikadayFin.setMinDate(new Date),this.pikadayFin.setMaxDate(null))}finalizarOperacion(){this.novedadesService.setModoCreacion(!1),this.appService.setEditando(!1),this.tableState.update(i=>I(T({},i),{expanded:{}})),this.limpiarFormulario(),this.cdr.detectChanges()}ngOnDestroy(){this.novedadesService.resetAll(),this.appService.setEditando(!1),this.appService.setGuardando(!1),this.limpiarFormulario(),this.pikadayInicio&&this.pikadayInicio.destroy(),this.pikadayFin&&this.pikadayFin.destroy(),this.cdr.detectChanges()}};a.\u0275fac=function(o){return new(o||a)},a.\u0275cmp=Q({type:a,selectors:[["novedades"]],viewQuery:function(o,n){o&1&&(R(n.estadoCell,Dn,5),R(n.fechaInicioCell,jn,5),R(n.fechaFinCell,Mn,5),R(n.horaInicioCell,Rn,5),R(n.horaFinCell,Pn,5),R(n.descripcionCell,Vn,5),R(n.fechaInicioPicker,An,5),R(n.fechaFinPicker,Nn,5)),o&2&&oe(8)},decls:25,vars:10,consts:[["estadoCell",""],["fechaInicioCell",""],["fechaFinCell",""],["horaInicioCell",""],["horaFinCell",""],["descripcionCell",""],["tablaNov","responsiveTable"],["alertaRef",""],["fechaInicioPicker",""],["fechaFinPicker",""],[1,"flex","justify-end","mb-6"],[1,"btn","btn-primary","h-11","rounded-box",3,"disabled"],["responsiveTable","",1,"table","w-full","rounded-md","table-sm","sm:table-md","border-t","border-base-200",3,"table"],[1,"sticky","top-0","z-20","bg-base-100"],[3,"cambioPaginacion","ngClass","estado","paginacion","mostrarInfo","mostrarSelectorTamano","mostrarExtremos","deshabilitado"],[1,"badge","font-semibold","badge-info"],[3,"ngClass"],[3,"click","ngClass"],[1,"input","input-bordered","w-full","h-11","rounded-box"],[1,"text-sm","md:text-base"],["type","text","id","fechaInicio","placeholder","dd/mm/yyyy",3,"formControl","ngClass"],[3,"nombreIcono","estilos"],["type","text","id","fechaFin","placeholder","dd/mm/yyyy",3,"formControl","ngClass"],["type","time",1,"input","input-bordered","w-full","h-11","rounded-box",3,"formControl"],["placeholder","Descripci\xF3n de la novedad","rows","2",1,"textarea","grow","w-full","h-11","rounded-box",3,"formControl"],[1,"text-sm","md:text-base","line-clamp-2"],[1,"btn","btn-primary","h-11","rounded-box",3,"click","disabled"],[1,"p-2","text-left","first:rounded-tl-md","last:rounded-tr-md","bg-base-100","z-20",3,"colSpan"],[4,"flexRender","flexRenderProps"],[1,"text-left","max-sm:text-sm",3,"innerHTML"],[1,"text-center","max-sm:text-sm","text-base","text-gray-500","py-8"],[1,"bg-base-100"],[1,"py-1"],[1,"bg-base-300","border-none"],[3,"innerHTML"],[1,"bg-base-100","rounded-md","p-4","shadow-md","w-full"],[1,"divider","my-4"],[1,"space-y-2"],[1,"flex","my-2","flex-row","gap-2","items-center","w-full"],[1,"inline-flex","w-3/12","font-bold","text-base-content"],[1,"inline-flex","w-9/12"]],template:function(o,n){if(o&1){let d=D();M(0,Hn,2,1,"ng-template",null,0,$)(2,Qn,2,1,"ng-template",null,1,$)(4,Ln,2,1,"ng-template",null,2,$)(6,Yn,2,1,"ng-template",null,3,$)(8,Xn,2,1,"ng-template",null,4,$)(10,ta,2,1,"ng-template",null,5,$),l(12,"div",10),f(13,oa,3,3,"button",11),r(),l(14,"table",12,6)(16,"thead",13),y(17,sa,3,0,"tr",null,di),r(),l(19,"tbody"),f(20,la,4,1,"tr")(21,ga,2,0),r()(),l(22,"app-paginador",14),E("cambioPaginacion",function(C){return x(d),b(n.onPageChange(C))}),r(),M(23,Ca,0,0,"ng-template",null,7,$)}o&2&&(s(13),h(n.authService.tienePermisos("ESP000010")?13:-1),s(),p("table",n.tablaNovedades()),s(3),F(n.tablaNovedades().getHeaderGroups()),s(3),h(!n.novedadesQuery.length&&!n.modoCreacion()?20:21),s(2),p("ngClass","flex flex-col sm:flex-row items-center justify-between max-md:gap-2 gap-4 max-md:p-2 p-4 bg-base-100 sticky bottom-0 z-10 rounded-b-box")("estado",n.paginacion())("paginacion",null)("mostrarInfo",!0)("mostrarSelectorTamano",!0)("mostrarExtremos",!0)("deshabilitado",n.novedadesService.novedadesQuery.isFetching()))},dependencies:[J,W,Z,le,ce,_e,de,ye,be,Ni,ii],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});let e=a;return e})();var va=["alertaEspacioConfig"];function xa(e,a){}var wl=(()=>{let a=class a{constructor(){this.appService=g(X),this.injector=g(te),this.espacioConfigService=g(N),this.route=g(ki),this.espacioId=ti(this.route.paramMap.pipe(xi(i=>i.get("id")??""),yi(i=>this.espacioConfigService.setIdEspacio(parseInt(i,10))))),this.generalChecked=w(()=>this.espacioConfigService.pestana()==="general"),this.baseChecked=w(()=>this.espacioConfigService.pestana()==="base"),this.tipoUsuarioChecked=w(()=>this.espacioConfigService.pestana()==="tipoUsuario"),this.fechaChecked=w(()=>this.espacioConfigService.pestana()==="fecha"),this.novedadesChecked=w(()=>this.espacioConfigService.pestana()==="novedades"),this.alertaEspacioConfig=P.required("alertaEspacioConfig",{read:mi})}ngOnInit(){this.espacioConfigService.setAlertaEspacioConfigRef(this.alertaEspacioConfig()),L(()=>{this.espacioConfigService.pestana(),this.appService.setEditando(!1),this.espacioConfigService.resetAll()},{injector:this.injector})}get espacioQuery(){return this.espacioConfigService.espacioQuery}cambiarPestana(i){this.appService.setEditando(!1),this.espacioConfigService.setPestana(i)}ngOnDestroy(){this.espacioConfigService.setImagen(""),this.espacioConfigService.setPestana("general")}};a.\u0275fac=function(o){return new(o||a)},a.\u0275cmp=Q({type:a,selectors:[["app-configuracion"]],viewQuery:function(o,n){o&1&&R(n.alertaEspacioConfig,va,5,mi),o&2&&oe()},hostAttrs:[1,"flex","flex-col","h-full","w-full","sm:pl-3","relative","overflow-y-auto"],decls:28,vars:11,consts:[["tabGeneral",""],["tabBase",""],["tabTipoUsuario",""],["tabFecha",""],["tabNovedades",""],["alertaEspacioConfig",""],[1,"flex","flex-col","md:flex-row","mt-2","pr-2","w-full","pb-2","md:pb-4","items-stretch","justify-center","md:justify-between","sticky","top-0","z-30","bg-base-300"],[1,"flex","max-sm:flex-col","items-center","justify-between","w-full"],[1,"font-bold","text-4xl"],[1,"tabs","max-md:tabs-box","tabs-lift"],["type","radio","name","espaciosTabs","aria-label","General",1,"tab","font-semibold","max-md:text-base","max-sm:h-11","text-[1.125rem]",3,"change","checked"],[1,"tab-content","border-base-300","bg-base-100","max-md:p-2","p-5","xl:p-10"],[3,"ngClass"],["type","radio","name","espaciosTabs","aria-label","Base",1,"tab","font-semibold","max-md:text-base","max-sm:h-11","text-[1.125rem]",3,"change","checked"],["type","radio","name","espaciosTabs","aria-label","Tipo de Usuario",1,"tab","font-semibold","max-md:text-base","max-sm:h-11","text-[1.125rem]",3,"change","checked"],["type","radio","name","espaciosTabs","aria-label","Por Fecha",1,"tab","font-semibold","max-md:text-base","max-sm:h-11","text-[1.125rem]",3,"change","checked"],["type","radio","name","espaciosTabs","aria-label","Novedades",1,"tab","font-semibold","max-md:text-base","max-sm:h-11","text-[1.125rem]",3,"change","checked"]],template:function(o,n){if(o&1){let d=D();l(0,"div",6)(1,"div",7)(2,"h2",8),m(3),r(),_(4,"app-breadcrumbs"),r()(),l(5,"div",9)(6,"input",10,0),E("change",function(){return x(d),b(n.cambiarPestana("general"))}),r(),l(8,"div",11),_(9,"espacio-general",12),r(),l(10,"input",13,1),E("change",function(){return x(d),b(n.cambiarPestana("base"))}),r(),l(12,"div",11),_(13,"config-base",12),r(),l(14,"input",14,2),E("change",function(){return x(d),b(n.cambiarPestana("tipoUsuario"))}),r(),l(16,"div",11),_(17,"tabla-config-tipo-usuario",12),r(),l(18,"input",15,3),E("change",function(){return x(d),b(n.cambiarPestana("fecha"))}),r(),l(20,"div",11),_(21,"config-por-fecha",12),r(),l(22,"input",16,4),E("change",function(){return x(d),b(n.cambiarPestana("novedades"))}),r(),l(24,"div",11),_(25,"novedades",12),r()(),M(26,xa,0,0,"ng-template",null,5,$)}if(o&2){let d;s(3),k(" ",(d=n.espacioQuery.data())==null?null:d.nombre," "),s(3),p("checked",n.generalChecked()),s(3),p("ngClass","flex flex-col h-full"),s(),p("checked",n.baseChecked()),s(3),p("ngClass","flex flex-col h-full"),s(),p("checked",n.tipoUsuarioChecked()),s(3),p("ngClass","flex flex-col h-full"),s(),p("checked",n.fechaChecked()),s(3),p("ngClass","flex flex-col h-full"),s(),p("checked",n.novedadesChecked()),s(3),p("ngClass","flex flex-col h-full")}},dependencies:[J,W,Z,Yi,Zi,it,tt,Ji,at],encapsulation:2,changeDetection:0});let e=a;return e})();export{wl as ConfiguracionPage};
