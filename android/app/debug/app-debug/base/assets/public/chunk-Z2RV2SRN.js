import{a as le,b as Je,c as se,d as Ze,e as et}from"./chunk-RC4ZV7A2.js";import{a as ht}from"./chunk-VILVOQXR.js";import{b as z}from"./chunk-WNVXENDG.js";import{a as tt,b as it,c as ot,d as at,e as nt,g as rt,h as lt,i as st,j as ct,k as dt}from"./chunk-KWYFY7T2.js";import{a as A}from"./chunk-AWJWBZOU.js";import{a as $}from"./chunk-ZU7Q4APP.js";import{m as ie}from"./chunk-LKADUWP6.js";import"./chunk-6CQPCFUJ.js";import{a as qe,b as ze,c as Qe,e as Oe,f as je,g as We,h as Ge,k as Le,p as He,r as Ke,t as Be,w as Ye}from"./chunk-MBZLMIXQ.js";import{a as Xe}from"./chunk-ODBDBKE7.js";import"./chunk-XPPSGRKL.js";import{a as ke,c as $e,h as te}from"./chunk-4HN4PAFJ.js";import{i as ee}from"./chunk-AV73RGVI.js";import{f as Ae}from"./chunk-N4CCYIXR.js";import{F as Ne}from"./chunk-UAEYNMJW.js";import{A as De,C as Ve,c as ye,e as F,g as Se,h as we,k as Ee,n as Ue,p as Fe,q as Me,r as Te,s as Pe,x as Ie,y as Re,z as Z}from"./chunk-YPFPCNBD.js";import{Aa as I,Ba as u,Ca as s,D as me,Da as r,Db as X,Ea as f,Fa as H,Ga as K,H as C,Ia as w,Ja as v,Ka as c,Lb as J,N as g,O as b,Ra as E,Rb as Ce,Sa as B,Ta as k,U as S,Ua as pe,Va as _e,Wa as Y,Xa as d,Ya as q,Za as x,aa as j,c as ne,cb as M,da as l,db as re,fb as fe,gb as xe,ha as N,hb as he,ia as W,ib as ge,lb as D,na as R,pb as V,qb as be,rb as ve,ta as G,tb as U,u as ce,v as de,va as m,wa as p,xa as L,z as ue,za as P}from"./chunk-U6U25BWF.js";import"./chunk-B3LSNZRN.js";import"./chunk-WUBXWBRT.js";import"./chunk-B52GHH4C.js";import"./chunk-KZ3CI6ZI.js";import"./chunk-HC6MZPB3.js";import"./chunk-SV2ZKNWA.js";import"./chunk-IA5KSSRM.js";import"./chunk-RS5W3JWO.js";import"./chunk-XENCGOZ2.js";import"./chunk-XZRAAXKF.js";import"./chunk-7D6K5XYM.js";import"./chunk-OBXDPQ3V.js";import"./chunk-QY5CJPR3.js";import"./chunk-MCRJI3T3.js";import"./chunk-ZD4SBDZ6.js";import"./chunk-NCLOD2DI.js";import"./chunk-UYQ7EZNZ.js";import"./chunk-BAKMWPBW.js";import"./chunk-AESNPOCP.js";import"./chunk-H3ZVKW6B.js";import"./chunk-HMK4XMX7.js";import"./chunk-E7UUDSES.js";import"./chunk-JQ3FRJ6A.js";import"./chunk-3IVKBF6N.js";import"./chunk-NMYJD6OP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-SV7S5NYR.js";import{a as h,b as y,i as xt,j as O}from"./chunk-LVXXLD6S.js";var oe=(()=>{let n=class n{constructor(){this.http=C(Ce),this.alertaService=C($),this.queryClient=C(De),this._paginacion=S({pageIndex:0,pageSize:10}),this._datosPaginador=S(null),this._filtroTexto=S(""),this.paginacion=V(()=>this._paginacion()),this.datosPaginador=V(()=>this._datosPaginador()),this.filtroTexto=this._filtroTexto.asReadonly(),this.queryUsuarios=Ve(()=>({queryKey:["usuarios",this.paginacion(),this._filtroTexto()],queryFn:()=>le(this.http,y(h({},this.paginacion()),{search:this._filtroTexto()})),select:t=>(this._datosPaginador.set(t.meta),t.data)})),this._usuarioAEditar=S(null),this.usuarioAEditar=this._usuarioAEditar.asReadonly(),this._i18nDatePicker=S(ke),this.i18nDatePicker=this._i18nDatePicker.asReadonly(),this._modalAbierta=S(!1),this.modalAbierta=this._modalAbierta.asReadonly(),this._modoEdicion=S(!1),this.modoEdicion=this._modoEdicion.asReadonly(),this.colorModal=V(()=>this._modoEdicion()?"secondary":"primary"),this.tituloModal=V(()=>this._modoEdicion()?"Editar Usuario":"Nuevo Egresado")}setUsuarioAEditar(t){this._usuarioAEditar.set(t)}abrirModal(){this._modalAbierta.set(!0)}cerrarModal(){this._modalAbierta.set(!1),this._modoEdicion.set(!1),this._usuarioAEditar.set(null)}setModoEdicion(t){this._modoEdicion.set(t)}guardarUsuario(t){return Je(this.http,t,this._modoEdicion(),!0)}activarUsuario(t){return O(this,null,function*(){return se(this.http,t,"activo")})}cambiarRolUsuario(t,a){return O(this,null,function*(){return Ze(this.http,t,a)})}cambiarEstadoUsuario(t,a){return O(this,null,function*(){return se(this.http,t,a)})}setPaginacion(t){this._paginacion.set(t)}setFiltroTexto(t){this._filtroTexto.set(t),this.setPaginacion(y(h({},this._paginacion()),{pageIndex:0}))}limpiarFiltro(){this._filtroTexto.set("")}setDatosPaginador(t){this._datosPaginador.update(a=>h(h({},a),t))}prefetchUsuarios(t){this.queryClient.prefetchQuery({queryKey:["usuarios",t,this._filtroTexto()],queryFn:()=>le(this.http,y(h({},t),{search:this._filtroTexto()})),staleTime:1e3*60*5})}};n.\u0275fac=function(a){return new(a||n)},n.\u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();var mt=xt(ht());var bt=["usuariosModal"],vt=["alertaFormUsuario"],Ct=["fechaNacimientoPicker"],yt=["contenedorCalendario"],Q=e=>({"input input-bordered w-full h-11 rounded-box placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm":!0,"input-error":e}),St=e=>({"select input-bordered w-full h-11 rounded-box placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm":!0,"input-error":e}),wt=e=>({"pika-single grow w-full h-11 rounded-box placeholder:text-xs md:placeholder:text-sm":!0,"input-error":e}),Et=e=>({"input input-bordered w-full h-11 rounded-box placeholder:text-gray-400 placeholder:accent-base-300 placeholder:text-sm":!0,"input-error":e}),Ut=(e,n)=>n.id;function Ft(e,n){if(e&1&&(s(0,"div",18),d(1),r()),e&2){let i=c();l(),x(" ",i.formUtils.obtenerErrorDelCampo(i.usuarioForm,"nombre")," ")}}function Mt(e,n){if(e&1&&(s(0,"div",18),d(1),r()),e&2){let i=c();l(),x(" ",i.formUtils.obtenerErrorDelCampo(i.usuarioForm,"apellido")," ")}}function Tt(e,n){if(e&1&&(s(0,"option",25),d(1),r()),e&2){let i=n.$implicit;u("value",i.id),l(),x(" ",`${i.codigo} - ${i.nombre}`," ")}}function Pt(e,n){if(e&1&&(s(0,"div",18),d(1),r()),e&2){let i=c();l(),x(" ",i.formUtils.obtenerErrorDelCampo(i.usuarioForm,"tipoDocumento")," ")}}function It(e,n){if(e&1&&(s(0,"div",18),d(1),r()),e&2){let i=c();l(),x(" ",i.formUtils.obtenerErrorDelCampo(i.usuarioForm,"documento")," ")}}function Rt(e,n){if(e&1&&(s(0,"div",18),d(1),r()),e&2){let i=c();l(),x(" ",i.formUtils.obtenerErrorDelCampo(i.usuarioForm,"fechaNacimiento")," ")}}function Dt(e,n){if(e&1&&(s(0,"div",18),d(1),r()),e&2){let i=c();l(),x(" ",i.formUtils.obtenerErrorDelCampo(i.usuarioForm,"telefono")," ")}}function Vt(e,n){if(e&1&&(s(0,"div",18),d(1),r()),e&2){let i=c();l(),x(" ",i.formUtils.obtenerErrorDelCampo(i.usuarioForm,"email")," ")}}function At(e,n){if(e&1&&(s(0,"div",18),d(1),r()),e&2){let i=c();l(),x(" ",i.formUtils.obtenerErrorDelCampo(i.usuarioForm,"direccion")," ")}}function Nt(e,n){}var pt=(()=>{let n=class n{ngAfterViewInit(){setTimeout(()=>{this.initializePikaday()},0)}initializePikaday(){this.pikaday=new mt.default({field:this.fechaNacimientoPicker()?.nativeElement,container:this.contenedorCalendario()?.nativeElement,yearRange:[1950,new Date().getFullYear()-16],maxDate:new Date(new Date().getFullYear()-16,new Date().getMonth(),new Date().getDate()),i18n:this.usuarioService.i18nDatePicker(),format:"DD/MM/YYYY",onSelect:t=>{let a=ie(t,"dd/MM/yyyy");this.usuarioForm.get("fechaNacimiento")?.setValue(a)}}),this.usuarioForm.get("fechaNacimiento")?.valueChanges.subscribe(t=>{if(t){let a=z(t,"dd/MM/yyyy",new Date);this.pikaday.setDate(a,!0)}else this.pikaday.setDate(null)})}constructor(){this.fb=C(Ie),this.alertaService=C($),this.estilosAlerta=S("flex justify-center p-4 transition-all ease-in-out w-full").asReadonly(),this.guardadoExitoso=ve(),this.usuarioService=C(oe),this.appService=C(ee),this.formUtils=A,this.usuarioForm=this.fb.group({nombre:["",[F.required]],apellido:["",[F.required]],email:["",[F.required,F.pattern(A.patronEmail)],[A.validarRespuestaServidor]],telefono:["",[F.required,F.pattern(A.patronSoloNumeros),F.minLength(10)]],direccion:[""],fechaNacimiento:[""],tipoUsuario:["externo"],documento:["",[F.required,F.pattern(A.patronSoloNumeros),F.minLength(7)]],tipoDocumento:["",[F.required]]}),this.usuariosModal=U("usuariosModal"),this.alertaFormUsuario=U.required("alertaFormUsuario",{read:N}),this.fechaNacimientoPicker=U.required("fechaNacimientoPicker"),this.contenedorCalendario=U.required("contenedorCalendario"),be(()=>{let t=this.usuariosModal()?.nativeElement;t&&(this.usuarioService.modalAbierta()?this.abrirModal(t):this.cerrarModal(t))})}abrirModal(t){if(t.showModal(),this.usuarioService.modoEdicion()){let a=this.usuarioService.usuarioAEditar();if(a){let o="";if(a.fechaNacimiento){let _=a.fechaNacimiento.split("T")[0];o=ie(z(_,"yyyy-MM-dd",new Date),"dd/MM/yyyy")}if(this.usuarioForm.patchValue(y(h({},a),{fechaNacimiento:o})),this.pikaday&&o){let _=z(o,"dd/MM/yyyy",new Date);this.pikaday.setDate(_,!0)}this.usuarioForm.get("email")?.removeAsyncValidators([A.validarRespuestaServidor]),this.usuarioForm.get("email")?.disable()}}}cerrarModal(t){t.close(),this.usuarioService.cerrarModal(),this.usuarioForm.get("email")?.enable(),this.usuarioForm.get("email")?.addAsyncValidators(A.validarRespuestaServidor),this.usuarioForm.reset()}enviarFormulario(){if(this.usuarioForm.invalid){this.usuarioForm.markAllAsTouched();return}let t=null,a=ie(z(this.usuarioForm.value.fechaNacimiento,"dd/MM/yyyy",new Date),"yyyy-MM-dd");this.usuarioService.modoEdicion()?t=y(h(h({},this.usuarioService.usuarioAEditar()),this.usuarioForm.value),{fechaNacimiento:a}):t=y(h({},this.usuarioForm.value),{fechaNacimiento:a}),this.usuarioService.guardarUsuario(t).then(o=>{this.usuarioService.queryUsuarios.refetch(),this.cerrarModal(this.usuariosModal()?.nativeElement),this.guardadoExitoso.emit(!0)}).catch(o=>{if(this.alertaFormUsuario()){let _=Object.values(o.errors);this.alertaService.error(`Error al ${this.usuarioService.modoEdicion()?"editar":"crear"} el usuario: ${_.join(", ")}`,3e3,this.alertaFormUsuario(),this.estilosAlerta())}})}ngOnDestroy(){this.pikaday&&this.pikaday.destroy()}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=W({type:n,selectors:[["usuarios-gestion-modal"]],viewQuery:function(a,o){a&1&&(E(o.usuariosModal,bt,5),E(o.alertaFormUsuario,vt,5,N),E(o.fechaNacimientoPicker,Ct,5),E(o.contenedorCalendario,yt,5)),a&2&&B(4)},outputs:{guardadoExitoso:"guardadoExitoso"},decls:87,vars:40,consts:[["usuariosModal",""],["fechaNacimientoPicker",""],["contenedorCalendario",""],["alertaFormUsuario",""],[1,"modal","p-0","z-50"],[1,"modal-box","p-0","max-w-[95dvw]","md:max-w-3xl","w-full","max-h-[95dvh]","md:max-h-[90dvh]","overflow-hidden","relative"],[1,"sticky","top-0","bg-base-100","z-10","border-b","border-base-300","px-2","md:px-6","py-4","flex","justify-between","items-center"],[1,"text-lg","font-bold"],["type","button","aria-label","Cerrar modal",1,"btn","btn-xs","btn-circle","btn-neutral","btn-outline",3,"click"],["nombreIcono","close-outline","estilos","h-5 w-5"],[1,"overflow-x-auto","overflow-y-auto","max-h-[calc(95vh-10rem)]"],[1,"px-2","md:px-6","md:py-4","w-full","h-full"],["id","usuarioFormId",3,"ngSubmit","formGroup"],[1,"my-4","flex","flex-col","md:flex-row","w-full","gap-2","md:gap-3"],[1,"flex","flex-col","w-full","md:w-1/2"],["for","nombre",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],[1,"text-error"],["type","text","id","nombre","formControlName","nombre","placeholder","Nombre",3,"ngClass"],[1,"text-sm","text-error"],["for","apellido",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],["type","text","id","apellido","formControlName","apellido","placeholder","Apellido",3,"ngClass"],[1,"flex","flex-col","w-full","md:w-2/6"],["for","tipoDocumento",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],["type","text","id","tipoDocumento","formControlName","tipoDocumento",3,"ngClass"],["value","","disabled","","selected",""],[3,"value"],[1,"flex","flex-col","w-full","md:w-4/6"],["for","documento",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],["type","text","id","documento","inputSoloNumeros","","inputmode","numeric","formControlName","documento","placeholder","123456789",3,"ngClass"],["for","fechaNacimiento",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],[1,"input","input-bordered","w-full","h-11","rounded-box"],["type","text","id","fechaNacimiento","placeholder","dd/mm/yyyy","formControlName","fechaNacimiento",3,"ngClass"],[3,"nombreIcono","estilos"],[1,"w-full","relative","z-20"],["for","telefono",1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],["type","tel","id","telefono","inputSoloNumeros","","formControlName","telefono","placeholder","1234567890",3,"ngClass"],[1,"my-4","flex","flex-col","w-full"],[1,"label","text-sm","font-[600]","text-base-content","mb-1","md:mb-2"],["type","email","id","email","formControlName","email","placeholder","micorreo@unab.edu.co",3,"ngClass"],["type","text","id","direccion","formControlName","direccion","placeholder","Calle X # 123A-45",3,"ngClass"],[1,"sticky","bottom-0","bg-base-100","border-t","border-base-300","px-6","py-2","z-10"],[1,"modal-action","!mt-1"],["type","button",1,"btn","btn-ghost","h-11","rounded-box",3,"click"],["type","submit","form","usuarioFormId",3,"disabled"]],template:function(a,o){if(a&1){let _=w();s(0,"dialog",4,0)(2,"div",5)(3,"div",6)(4,"h3",7),d(5),r(),s(6,"button",8),v("click",function(){return g(_),b(o.usuarioService.cerrarModal())}),f(7,"app-web-icon",9),r()(),s(8,"div",10)(9,"div",11)(10,"form",12),v("ngSubmit",function(){return g(_),b(o.enviarFormulario())}),s(11,"div",13)(12,"div",14)(13,"label",15),d(14," Nombre "),s(15,"span",16),d(16,"*"),r()(),f(17,"input",17),m(18,Ft,2,1,"div",18),r(),s(19,"div",14)(20,"label",19),d(21," Apellido "),s(22,"span",16),d(23,"*"),r()(),f(24,"input",20),m(25,Mt,2,1,"div",18),r()(),s(26,"div",13)(27,"div",21)(28,"label",22),d(29," Tipo Doc. "),s(30,"span",16),d(31,"*"),r()(),s(32,"select",23)(33,"option",24),d(34,"Seleccione"),r(),P(35,Tt,2,2,"option",25,Ut),r(),m(37,Pt,2,1,"div",18),r(),s(38,"div",26)(39,"label",27),d(40," Documento "),s(41,"span",16),d(42,"*"),r()(),f(43,"input",28),m(44,It,2,1,"div",18),r()(),s(45,"div",13)(46,"div",14)(47,"label",29),d(48," Fecha de Nacimiento "),s(49,"span",16),d(50,"*"),r()(),s(51,"label",30),f(52,"input",31,1)(54,"app-web-icon",32),r(),f(55,"div",33,2),m(57,Rt,2,1,"div",18),r(),s(58,"div",14)(59,"label",34),d(60," Tel\xE9fono "),s(61,"span",16),d(62,"*"),r()(),f(63,"input",35),m(64,Dt,2,1,"div",18),r()(),s(65,"div",36)(66,"label",37),d(67,"Email "),s(68,"span",16),d(69,"*"),r()(),f(70,"input",38),m(71,Vt,2,1,"div",18),r(),s(72,"div",36)(73,"label",37),d(74,"Direcci\xF3n "),s(75,"span",16),d(76,"*"),r()(),f(77,"input",39),m(78,At,2,1,"div",18),r(),R(79,Nt,0,0,"ng-template",null,3,D),r()()(),s(81,"div",40)(82,"div",41)(83,"button",42),v("click",function(){return g(_),b(o.usuarioService.cerrarModal())}),d(84," Cerrar "),r(),s(85,"button",43),d(86),r()()()()()}a&2&&(l(5),q(o.usuarioService.tituloModal()),l(5),u("formGroup",o.usuarioForm),l(7),u("ngClass",M(24,Q,o.formUtils.esCampoInvalido(o.usuarioForm,"nombre"))),l(),p(o.formUtils.esCampoInvalido(o.usuarioForm,"nombre")?18:-1),l(6),u("ngClass",M(26,Q,o.formUtils.esCampoInvalido(o.usuarioForm,"apellido"))),l(),p(o.formUtils.esCampoInvalido(o.usuarioForm,"apellido")?25:-1),l(7),u("ngClass",M(28,St,o.formUtils.esCampoInvalido(o.usuarioForm,"tipoDocumento"))),l(3),I(o.appService.tipoDocQuery.data()),l(2),p(o.formUtils.esCampoInvalido(o.usuarioForm,"tipoDocumento")?37:-1),l(6),u("ngClass",M(30,Q,o.formUtils.esCampoInvalido(o.usuarioForm,"documento"))),l(),p(o.formUtils.esCampoInvalido(o.usuarioForm,"documento")?44:-1),l(8),u("ngClass",M(32,wt,o.formUtils.esCampoInvalido(o.usuarioForm,"fechaNacimiento"))),l(2),u("nombreIcono","calendar-outline")("estilos","h-5 w-5"),l(3),p(o.formUtils.esCampoInvalido(o.usuarioForm,"fechaNacimiento")?57:-1),l(6),u("ngClass",M(34,Q,o.formUtils.esCampoInvalido(o.usuarioForm,"telefono"))),l(),p(o.formUtils.esCampoInvalido(o.usuarioForm,"telefono")?64:-1),l(6),u("ngClass",M(36,Q,o.formUtils.esCampoInvalido(o.usuarioForm,"email"))),l(),p(o.formUtils.esCampoInvalido(o.usuarioForm,"email")?71:-1),l(6),u("ngClass",M(38,Et,o.formUtils.esCampoInvalido(o.usuarioForm,"direccion"))),l(),p(o.formUtils.esCampoInvalido(o.usuarioForm,"direccion")?78:-1),l(7),Y(`btn btn-${o.usuarioService.colorModal()}  btn-soft h-11 rounded-box`),u("disabled",o.usuarioForm.invalid||!1),l(),x(" ",o.usuarioService.modoEdicion()?"Actualizar":"Guardar"," "))},dependencies:[J,X,Z,Ee,Te,Pe,ye,Me,Se,we,Ue,Fe,et,te],styles:["[_ngcontent-%COMP%]:where(.modal[open],.modal-open,.modal-toggle:checked+.modal):not(.modal-start,.modal-end){scrollbar-gutter:unset}"],changeDetection:0});let e=n;return e})();var kt=["alertaUsuarios"],$t=["ionChip"],qt=["chipWeb"],zt=["celdaNombre"],Qt=["celdaRol"],Ot=["celdaTipo"],jt=(e,n,i,t,a)=>({"badge font-semibold min-w-20  transition-all tooltip align-middle":!0,"tooltip-right":e,"tooltip-left":n,"badge-success":i,"badge-error":t,"tooltip hover:cursor-pointer hover:scale-105":a}),Wt=(e,n,i,t)=>({"badge-secondary":e,"badge-warning":n,"badge-accent":i,"badge-info":t}),_t=(e,n)=>({"tooltip-right":e,"tooltip-left":n}),Gt=e=>({"hover:bg-base-200":!0,"last:rounded-b-none":!0,"bg-base-200":e}),ae=(e,n)=>n.id;function Lt(e,n){if(e&1){let i=w();s(0,"div",15),v("click",function(){let a=g(i).$implicit,o=c();return b(o.authService.tienePermisos(o.permisos.DESACTIVAR_USUARIOS)?o.cambiarEstadoUsuario(a.row.original):null)}),d(1),r()}if(e&2){let i=n.$implicit,t=c();u("ngClass",xe(3,jt,!i.column.getIsVisible(),i.column.getIsVisible(),i.getValue()==="Activo",i.getValue()==="Inactivo",t.authService.tienePermisos(t.permisos.DESACTIVAR_USUARIOS))),G("data-tip",i.getValue()==="Activo"?"Desactivar":"Activar"),l(),x(" ",i.getValue()," ")}}function Ht(e,n){if(e&1&&(s(0,"div",16),d(1),he(2,"upperFirst"),r()),e&2){let i=n.$implicit;u("ngClass",fe(4,Wt,i==="administrativo",i==="estudiante",i==="egresado",i==="externo")),l(),x(" ",ge(2,2,i)," ")}}function Kt(e,n){if(e&1&&P(0,Ht,3,9,"div",16,L),e&2){let i=n.$implicit;I(i.getValue())}}function Bt(e,n){if(e&1){let i=w();s(0,"button",20),v("click",function(){g(i);let a=c().$implicit,o=c();return b(o.editarUsuario(a.row.original))}),f(1,"app-web-icon",21),r()}if(e&2){let i=c().$implicit;u("ngClass",re(1,_t,!i.column.getIsVisible(),i.column.getIsVisible()))}}function Yt(e,n){if(e&1&&(s(0,"div",17)(1,"span",18),d(2),r(),m(3,Bt,2,4,"button",19),r()),e&2){let i=n.$implicit,t=c();l(2),q(i.getValue()),l(),p(t.authService.tienePermisos(t.permisos.EDITAR_USUARIOS)?3:-1)}}function Xt(e,n){if(e&1){let i=w();s(0,"li")(1,"button",27),v("click",function(){let a=g(i).$implicit,o=c(2).$implicit,_=c();return b(_.cambiarRolUsuario(o.row.original,a))}),d(2),r()()}if(e&2){let i=n.$implicit;l(2),x(" ",i.nombre," ")}}function Jt(e,n){if(e&1&&(s(0,"div",23)(1,"button",24),f(2,"app-web-icon",25),r(),s(3,"ul",26),P(4,Xt,3,1,"li",null,L),r()()),e&2){let i=c().$implicit,t=c();l(),u("ngClass",re(1,_t,!i.column.getIsVisible(),i.column.getIsVisible())),l(3),I(t.rolesQuery)}}function Zt(e,n){if(e&1&&(s(0,"div",17)(1,"span",22),d(2),r(),m(3,Jt,6,4,"div",23),r()),e&2){let i=n.$implicit,t=c();l(2),q(i.getValue()),l(),p(t.authService.tienePermisos(t.permisos.CAMBIAR_ROL_USUARIOS)?3:-1)}}function ei(e,n){if(e&1){let i=w();s(0,"div",9),d(1," Filtrando: "),s(2,"span",28),d(3),r(),s(4,"button",29),v("click",function(){g(i);let a=c();return b(a.limpiarFiltro())}),f(5,"app-web-icon",30),r()()}if(e&2){let i=c();l(3),x('"',i.usuariosService.filtroTexto(),'"')}}function ti(e,n){if(e&1){let i=w();s(0,"button",31),v("click",function(){g(i);let a=c();return b(a.crearUsuario())}),f(1,"app-web-icon",32),d(2," Nuevo Egresado "),r()}}function ii(e,n){e&1&&(s(0,"div",13),f(1,"span",33),s(2,"span",34),d(3,"Cargando usuarios..."),r()())}function oi(e,n){if(e&1){let i=w();s(0,"div",14),f(1,"app-web-icon",35),s(2,"span"),d(3,"Error al cargar los usuarios. "),r(),s(4,"button",36),v("click",function(){g(i);let a=c();return b(a.refrescarDatos())}),d(5," Reintentar "),r()()}}function ai(e,n){e&1&&f(0,"th",43)}function ni(e,n){if(e&1&&(H(0),f(1,"div",46),K()),e&2){let i=n.$implicit;l(),u("innerHTML",i,j)}}function ri(e,n){if(e&1&&(s(0,"th",43),R(1,ni,2,1,"ng-container",45),r()),e&2){let i=c().$implicit;Y((i.column.columnDef.meta==null?null:i.column.columnDef.meta.className)||""),pe("width",i.getSize()),l(),u("flexRender",i.column.columnDef.header)("flexRenderProps",i.getContext())}}function li(e,n){if(e&1&&m(0,ri,2,6,"th",44),e&2){let i=n.$implicit;p(i.isPlaceholder?-1:0)}}function si(e,n){if(e&1&&(s(0,"tr",40),m(1,ai,1,0,"th",43),P(2,li,1,1,null,null,ae),r()),e&2){let i=n.$implicit;c();let t=k(2);l(),p(t.hiddenColumnIds().size!==0?1:-1),l(),I(i.headers)}}function ci(e,n){if(e&1&&(s(0,"tr")(1,"td",47),d(2," No se encontraron resultados. "),r()()),e&2){let i=c(2);l(),G("colspan",i.columnas().length)}}function di(e,n){if(e&1){let i=w();s(0,"td",49)(1,"app-table-expansor",51),v("toggleExpand",function(){g(i);let a=c().$implicit;return b(a.toggleExpanded())}),r()()}if(e&2){let i=c().$implicit,t=c(3);l(),u("isExpanded",t.isRowExpanded(+i.id))}}function ui(e,n){if(e&1&&(H(0),f(1,"span",46),K()),e&2){let i=n.$implicit;l(),u("innerHTML",i,j)}}function mi(e,n){if(e&1&&(s(0,"td"),R(1,ui,2,1,"ng-container",45),r()),e&2){let i=n.$implicit;l(),u("flexRender",i.column.columnDef.cell)("flexRenderProps",i.getContext())}}function pi(e,n){if(e&1&&(H(0),f(1,"div",46),K()),e&2){let i=n.$implicit;l(),u("innerHTML",i,j)}}function _i(e,n){if(e&1&&(s(0,"li",53)(1,"span",54),d(2),r(),s(3,"span"),R(4,pi,2,1,"ng-container",45),r()()),e&2){let i=c().$implicit,t=c(3).$implicit;c(2);let a=k(2);l(2),x(" ",i.columnDef.header,": "),l(2),u("flexRender",a.getCell(i,t).column.columnDef.cell)("flexRenderProps",a.getCell(i,t).getContext())}}function fi(e,n){if(e&1&&m(0,_i,5,3,"li",53),e&2){let i=n.$implicit;c(5);let t=k(2);p(t.hiddenColumnIds().has(i.id)?0:-1)}}function xi(e,n){if(e&1&&(s(0,"ul",52),P(1,fi,1,1,null,null,L),r()),e&2){let i=c(5);l(),I(i.table.getAllLeafColumns())}}function hi(e,n){if(e&1&&(s(0,"tr",50)(1,"td"),m(2,xi,3,0,"ul",52),r()()),e&2){let i=c().$implicit;c(2);let t=k(2);l(),G("colspan",i.getVisibleCells().length+1),l(),p(t.hiddenColumnIds().size!==0?2:-1)}}function gi(e,n){if(e&1&&(s(0,"tr",48),m(1,di,2,1,"td",49),P(2,mi,2,2,"td",null,ae),r(),m(4,hi,3,2,"tr",50)),e&2){let i=n.$implicit;c(2);let t=k(2),a=c();_e("expanded",a.isRowExpanded(+i.id)),u("ngClass",M(5,Gt,a.isRowExpanded(+i.id))),l(),p(t.hiddenColumnIds().size!==0?1:-1),l(),I(i.getVisibleCells()),l(2),p(a.isRowExpanded(+i.id)&&t.hiddenColumnIds().size!==0?4:-1)}}function bi(e,n){if(e&1&&P(0,gi,5,7,null,null,ae),e&2){let i=c(2);I(i.table().getCoreRowModel().rows)}}function vi(e,n){}function Ci(e,n){if(e&1){let i=w();s(0,"div",37)(1,"table",38,4)(3,"thead",39),P(4,si,4,1,"tr",40,ae),r(),s(6,"tbody"),m(7,ci,3,1,"tr")(8,bi,2,0),r()()(),s(9,"app-paginador",41),v("cambioPaginacion",function(a){g(i);let o=c();return b(o.onPageChange(a))})("prefetchFunction",function(a){g(i);let o=c();return b(o.usuariosService.prefetchUsuarios(a))}),r(),R(10,vi,0,0,"ng-template",null,5,D),s(12,"usuarios-gestion-modal",42),v("guardadoExitoso",function(a){g(i);let o=c();return b(o.usuarioGuardadoExitoso(a))}),r()}if(e&2){let i=c();l(),u("table",i.table()),l(3),I(i.table.getHeaderGroups()),l(3),p(i.usuariosQuery.data()?8:7),l(2),u("ngClass","flex flex-col sm:flex-row items-center justify-between max-sm:gap-2 gap-4 max-sm:p-2 p-4 bg-base-100 sticky bottom-0 z-10 rounded-b-box")("estado",i.usuariosService.paginacion())("paginacion",i.usuariosService.datosPaginador()??null)("mostrarInfo",!0)("mostrarSelectorTamano",!0)("mostrarExtremos",!0)("deshabilitado",i.usuariosQuery.isFetching())}}var fo=(()=>{let n=class n{constructor(){this.alertaService=C($),this.authService=C(Ae),this.usuariosService=C(oe),this.appService=C(ee),this.destroy$=new ne,this.searchSubject=new ne,this.permisos=$e,this.alertaUsuarios=U.required("alertaUsuarios",{read:N}),this.ionChip=U.required("ionChip"),this.chipWeb=U.required("chipWeb"),this.celdaNombre=U.required("celdaNombre"),this.celdaRol=U.required("celdaRol"),this.celdaTipo=U.required("celdaTipo"),this.columnas=S([{id:"documento",header:"Documento",accessorKey:"documento",cell:t=>`<span class="font-bold">${t.getValue()}</span>`,size:200,meta:{priority:1/0}},{id:"nombreCompleto",accessorKey:"nombreCompleto",header:"Nombre",accessorFn:t=>`${t.nombre} ${t.apellido}`,cell:()=>this.celdaNombre(),meta:{className:"nombre-column",priority:1/0}},{id:"email",header:"Email",accessorKey:"email",cell:t=>t.getValue(),meta:{className:"email-column",priority:3}},{id:"rol",header:"Rol",accessorKey:"rol",size:300,cell:()=>this.celdaRol(),meta:{className:"rol-column",priority:3}},{id:"fechaCreacion",header:"Fecha Creaci\xF3n",cell:t=>{let a=t.getValue();return new Date(a).toLocaleString()},accessorFn:t=>t.fechaCreacion.split(" ")[0],accessorKey:"fechaCreacion",meta:{className:"fecha-column",priority:1}},{id:"estado",header:"Estado",accessorKey:"estado",size:300,cell:()=>this.chipWeb(),meta:{className:"estado-column",priority:1}},{id:"tiposUsuario",header:"Tipo de Usuario",accessorKey:"tipoUsuario",cell:()=>this.celdaTipo(),meta:{className:"tipos-column",priority:2}}]),this.tableState=S({expanded:{},globalFilter:""}),this.table=lt(()=>({data:this.usuariosQuery.data(),columns:this.columnas(),state:y(h({},this.tableState()),{pagination:this.usuariosService.paginacion()}),enableRowExpanding:!0,getRowId:t=>String(t.id),getSubRows:()=>[],onExpandedChange:t=>{let a=this.tableState().expanded,o=typeof t=="function"?t(a):t,_=Object.keys(o).find(T=>o[T]!==a[T]);this.tableState.update(T=>y(h({},T),{expanded:o}))},onPaginationChange:t=>{let a=typeof t=="function"?t(this.usuariosService.paginacion()):t;this.usuariosService.setPaginacion({pageIndex:a.pageIndex,pageSize:a.pageSize})},manualPagination:!0,getCoreRowModel:tt(),getPaginationRowModel:at(),getExpandedRowModel:it(),getFilteredRowModel:ot(),getSortedRowModel:nt(),getRowCanExpand:()=>!0,autoResetPageIndex:!1,debugAll:!1})),this.columns=V(()=>this.table.getAllColumns()),this.headerGroups=V(()=>this.table.getHeaderGroups())}ngOnInit(){qe({trashOutline:Ye,createOutline:Le,addOutline:ze,chevronDownOutline:je,chevronForwardOutline:We,chevronUpOutline:Ge,personCircle:Ke,caretDownOutline:Oe,openOutline:He,cameraOutline:Qe,refreshOutline:Be}),this.searchSubject.pipe(ce(300),de(),ue(this.destroy$)).subscribe(t=>{this.usuariosService.setFiltroTexto(t)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}get usuariosQuery(){return this.usuariosService.queryUsuarios}get rolesQuery(){return this.appService.rolesQuery.data()?.sort((t,a)=>(t.nombre||"").localeCompare(a.nombre||""))||[]}aplicarFiltro(t){this.searchSubject.next(t)}limpiarFiltro(){this.usuariosService.limpiarFiltro()}toggleRowExpanded(t){let a=String(t),o=this.tableState().expanded[a]||!1;this.tableState.update(_=>y(h({},_),{expanded:y(h({},_.expanded),{[a]:!o})}))}isRowExpanded(t){return!!this.tableState().expanded[String(t)]}crearUsuario(){this.usuariosService.abrirModal()}editarUsuario(t){this.usuariosService.setUsuarioAEditar(t),this.usuariosService.setModoEdicion(!0),this.usuariosService.abrirModal()}cambiarRolUsuario(t,a){this.alertaService.confirmarAccion(`\xBFEst\xE1s seguro de que quieres cambiar el rol de <strong>${t.nombre} ${t.apellido}</strong> a <strong>${a.nombre}</strong>?`,this.alertaUsuarios(),"Cambiar rol de usuario","info").then(o=>{o&&this.usuariosService.cambiarRolUsuario(t.id,a.id||0).then(()=>{this.alertaService.success("Rol de usuario actualizado exitosamente.",5e3,this.alertaUsuarios(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.usuariosService.queryUsuarios.refetch()}).catch(_=>{console.error("Error al cambiar el rol del usuario:",_),this.alertaService.error("Error al cambiar el rol del usuario. Por favor, int\xE9ntalo de nuevo.",5e3,this.alertaUsuarios(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")})})}cambiarEstadoUsuario(t){let a=t.estado.toLowerCase()==="activo"?"inactivo":"activo",o=a==="activo"?"activar":"desactivar";this.alertaService.confirmarAccion(`\xBFEst\xE1s seguro de que quieres ${o} a ${t.nombre} ${t.apellido}?`,this.alertaUsuarios(),`${o.charAt(0).toUpperCase()+o.slice(1)} usuario`,a==="activo"?"success":"warning").then(_=>{_&&this.usuariosService.cambiarEstadoUsuario(t.id,a).then(()=>{this.alertaService.success(`Usuario ${o==="activar"?"activado":"desactivado"} exitosamente.`,5e3,this.alertaUsuarios(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4"),this.usuariosService.queryUsuarios.refetch()}).catch(T=>{console.error(`Error al ${o} el usuario:`,T),this.alertaService.error(`Error al ${o} el usuario. Por favor, int\xE9ntalo de nuevo.`,5e3,this.alertaUsuarios(),"fixed flex p-4 transition-all ease-in-out bottom-4 right-4")})})}refrescarDatos(){this.usuariosService.queryUsuarios.refetch()}onPageChange(t){this.usuariosService.setPaginacion(t)}usuarioGuardadoExitoso(t){let a="fixed flex p-4 transition-all ease-in-out bottom-4 right-4";t?this.alertaService.success("Usuario guardado exitosamente.",5e3,this.alertaUsuarios(),a):this.alertaService.error("Error al guardar el usuario. Por favor, int\xE9ntalo de nuevo.",5e3,this.alertaUsuarios(),a)}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=W({type:n,selectors:[["app-usuarios-main"]],viewQuery:function(a,o){a&1&&(E(o.alertaUsuarios,kt,5,N),E(o.ionChip,$t,5),E(o.chipWeb,qt,5),E(o.celdaNombre,zt,5),E(o.celdaRol,Qt,5),E(o.celdaTipo,Ot,5)),a&2&&B(6)},hostAttrs:[1,"flex","flex-col","h-full","w-full","sm:pl-3"],decls:19,vars:4,consts:[["chipWeb",""],["celdaTipo",""],["celdaNombre",""],["celdaRol",""],["responsiveWeb","responsiveTable"],["alertaUsuarios",""],[1,"flex","flex-col","md:flex-row","md:mt-2","md:pr-2","w-full","pb-2","md:pb-4","items-stretch","justify-center","md:justify-between"],[1,"flex","items-center","max-sm:gap-1","gap-2","justify-center","mb-1","sm:justify-start"],[1,"md:mb-0","font-bold","text-2xl","sm:text-3xl","lg:text-4xl"],[1,"badge","badge-secondary","h-6","badge-sm","my-auto","max-sm:text-xs","text-base"],[1,"flex","flex-col","md:flex-row","max-md:gap-1","gap-2"],["type","text","placeholder","Buscar por nombre, email o rol...",1,"input","input-bordered","max-sm:input-sm","input-primary","w-full","sm:h-11","rounded-box","md:max-w-xs","placeholder:text-gray-500","placeholder:text-sm",3,"input","value"],[1,"btn","max-sm:btn-sm","btn-primary","sm:h-11","rounded-box"],[1,"flex","justify-center","items-center","py-8"],[1,"alert","alert-error","mb-4"],[3,"click","ngClass"],[1,"max-sm:text-xs","m-0.5","md:text-sm","font-semibold","badge","min-w-20","transition-all","align-middle",3,"ngClass"],[1,"flex","w-full","h-full","items-center","justify-between"],[1,"min-w-20"],["data-tip","Editar usuario",1,"btn","btn-soft","btn-accent","w-8","h-8","rounded-box","btn-sm","tooltip","p-0",3,"ngClass"],["data-tip","Editar usuario",1,"btn","btn-soft","btn-accent","w-8","h-8","rounded-box","btn-sm","tooltip","p-0",3,"click","ngClass"],["estilos","h-4 w-4","nombreIcono","open-outline"],[1,"capitalize"],[1,"dropdown","lg:dropdown-left"],["role","button","tabindex","0","data-tip","Cambiar rol",1,"btn","btn-soft","btn-secondary","w-8","h-8","rounded-box","btn-sm","tooltip","p-0",3,"ngClass"],["estilos","h-4 w-4","nombreIcono","caret-down-outline"],["tabindex","0",1,"dropdown-content","menu","bg-base-100","rounded-box","z-1","w-52","p-2","shadow-sm",2,"position-anchor","--anchor-1"],["type","button",1,"w-full","text-left",3,"click"],[1,"truncate","text-ellipsis","max-sm:max-w-28"],["title","Limpiar filtro",1,"btn","h-5","w-5","btn-circle","btn-secondary","ml-1",3,"click"],["estilos","h-4 w-4","nombreIcono","close-circle-outline"],[1,"btn","max-sm:btn-sm","btn-primary","sm:h-11","rounded-box",3,"click"],["estilos","h-6 w-6","nombreIcono","add-outline"],[1,"loading","loading-spinner","loading-lg","text-primary"],[1,"ml-2","text-base-content"],["estilos","h-6 w-6","nombreIcono","alert-circle-outline"],[1,"btn","btn-sm","btn-outline",3,"click"],[1,"overflow-y-auto"],["responsiveTable","",1,"table","rounded-none","table-sm","sm:table-md","rounded-t-box","bg-base-100","w-full","overflow-y-auto",3,"table"],[1,"sticky","top-0","z-20","bg-base-300"],[1,"bg-base-300","z-20","rounded-t-box"],[3,"cambioPaginacion","prefetchFunction","ngClass","estado","paginacion","mostrarInfo","mostrarSelectorTamano","mostrarExtremos","deshabilitado"],[3,"guardadoExitoso"],[1,"p-2","text-left","first:rounded-tl-box","last:rounded-tr-box","bg-base-100","z-20"],[1,"p-2","text-left","first:rounded-tl-box","last:rounded-tr-box","bg-base-100","z-20",3,"class","width"],[4,"flexRender","flexRenderProps"],[3,"innerHTML"],[1,"text-center"],[3,"ngClass"],[1,"!pe-0"],[1,"bg-base-300","border-none"],[3,"toggleExpand","isExpanded"],[1,"bg-base-100","rounded-box","px-4","py-1","shadow-sm"],[1,"flex","my-2","flex-row","gap-2","items-center"],[1,"font-bold","text-base-content"]],template:function(a,o){if(a&1){let _=w();R(0,Lt,2,9,"ng-template",null,0,D)(2,Kt,2,0,"ng-template",null,1,D)(4,Yt,4,2,"ng-template",null,2,D)(6,Zt,4,2,"ng-template",null,3,D),s(8,"div",6)(9,"div",7)(10,"h2",8),d(11,"Usuarios"),r(),m(12,ei,6,1,"div",9),r(),s(13,"div",10)(14,"input",11),v("input",function(ft){return g(_),b(o.aplicarFiltro(ft.target.value))}),r(),m(15,ti,3,0,"button",12),r()(),m(16,ii,4,0,"div",13)(17,oi,6,0,"div",14)(18,Ci,13,9)}a&2&&(l(12),p(o.usuariosService.filtroTexto()?12:-1),l(2),u("value",o.usuariosService.filtroTexto()),l(),p(o.authService.tienePermisos(o.permisos.CREAR_USUARIOS)?15:-1),l(),p(o.usuariosQuery.isPending()?16:o.usuariosQuery.isError()?17:18))},dependencies:[Ne,J,X,Re,Z,rt,ct,st,te,pt,dt,Xe],encapsulation:2,changeDetection:0});let e=n;return e})();export{fo as UsuariosMainPage};
