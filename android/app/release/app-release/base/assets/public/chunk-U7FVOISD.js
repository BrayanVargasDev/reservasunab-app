import{a as P}from"./chunk-47ROEAUL.js";import{b as y}from"./chunk-VT372YOS.js";import"./chunk-AV73RGVI.js";import{f as A}from"./chunk-N4CCYIXR.js";import{v as b}from"./chunk-UAEYNMJW.js";import"./chunk-YPFPCNBD.js";import{Ca as h,Da as d,Ea as g,H as t,Lb as v,Xa as p,_b as f,bc as S,ia as m}from"./chunk-U6U25BWF.js";import"./chunk-B3LSNZRN.js";import"./chunk-WUBXWBRT.js";import"./chunk-AUJJZC6I.js";import"./chunk-B52GHH4C.js";import"./chunk-KZ3CI6ZI.js";import"./chunk-HC6MZPB3.js";import"./chunk-SV2ZKNWA.js";import"./chunk-IA5KSSRM.js";import"./chunk-RS5W3JWO.js";import"./chunk-XENCGOZ2.js";import"./chunk-XZRAAXKF.js";import"./chunk-7D6K5XYM.js";import"./chunk-OBXDPQ3V.js";import"./chunk-QY5CJPR3.js";import"./chunk-MCRJI3T3.js";import"./chunk-ZD4SBDZ6.js";import"./chunk-NCLOD2DI.js";import"./chunk-UYQ7EZNZ.js";import"./chunk-BAKMWPBW.js";import"./chunk-AESNPOCP.js";import"./chunk-H3ZVKW6B.js";import"./chunk-HMK4XMX7.js";import"./chunk-E7UUDSES.js";import"./chunk-JQ3FRJ6A.js";import"./chunk-3IVKBF6N.js";import"./chunk-NMYJD6OP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-SV7S5NYR.js";import{j as l}from"./chunk-LVXXLD6S.js";var U=(()=>{let i=class i{constructor(){this.route=t(f),this.router=t(S),this.authService=t(A),this.navigationService=t(y),this.movbileAuthService=t(P),this.platform=t(b)}ngOnInit(){return l(this,null,function*(){let r=this.route.snapshot.queryParamMap,e=r.get("code")??"",o=r.get("returnUrl")??"",a=r.get("error"),u=r.get("error_description");if(this.platform.is("android")||this.platform.is("mobile")||this.platform.is("ios"))return yield new Promise(n=>setTimeout(n,300)),yield this.movbileAuthService.closeBrowser(),this.router.navigate(["/auth/callback-movil"],{queryParams:{code:e,returnUrl:o,error:a,errorDescription:u},replaceUrl:!0});try{if(a)return console.error("OAuth error:",a,u),this.handleOAuthError(a,u||"Error en autenticaci\xF3n SSO");if(!e||e.trim()==="")return console.error("No authorization code received"),this.handleOAuthError("no_code","No se recibi\xF3 c\xF3digo de autorizaci\xF3n");if(!(yield this.authService.intercambiarToken(e)))return console.error("Token exchange failed"),this.handleOAuthError("token_exchange_failed","Error al intercambiar tokens");console.debug("Token intercambiado correctamente, redirigiendo...");let s=yield this.authService.validarTerminosYPerfil();return s&&s!=="/"?(console.debug("Redirecting to post-login destination:",s),this.router.navigate([s])):o&&o!=="/"?(console.debug("Redirecting to return URL:",o),this.router.navigate([o],{replaceUrl:!0})):(console.debug("Redirecting to first available page"),this.navigationService.navegarAPrimeraPaginaDisponible())}catch(n){return console.error("Error en callback OAuth:",n),this.handleOAuthError("unexpected_error",n.message||"Error inesperado en autenticaci\xF3n SSO")}})}handleOAuthError(r,e){return l(this,null,function*(){return this.authService.clearSession(),this.authService.setLoading(!1),this.router.navigate(["/auth/login"],{queryParams:{sso_error:r,sso_error_description:e}})})}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=m({type:i,selectors:[["app-auth-callback"]],decls:5,vars:0,consts:[[1,"flex","items-center","justify-center","min-h-screen"],[1,"text-center"],[1,"loading","loading-spinner","loading-lg"],[1,"mt-4","text-gray-600"]],template:function(e,o){e&1&&(h(0,"div",0)(1,"div",1),g(2,"div",2),h(3,"p",3),p(4,"Procesando autenticaci\xF3n..."),d()()())},dependencies:[v],encapsulation:2,changeDetection:0});let c=i;return c})();export{U as AuthCallbackPage};
