import{a as ee}from"./chunk-AWJWBZOU.js";import{a as ie}from"./chunk-ZU7Q4APP.js";import{a as te}from"./chunk-47ROEAUL.js";import{h as X}from"./chunk-4HN4PAFJ.js";import{b as K}from"./chunk-VT372YOS.js";import{i as J}from"./chunk-AV73RGVI.js";import{f as Y}from"./chunk-N4CCYIXR.js";import"./chunk-UAEYNMJW.js";import{c as N,e as h,g as q,h as j,j as S,k as G,n as R,p as H,x as Q,y as $,z as W}from"./chunk-YPFPCNBD.js";import{Ba as d,Ca as a,Da as r,Db as T,Ea as s,H as m,Ia as E,Ja as x,Ka as P,Lb as V,N as v,O as b,P as O,Ra as U,Sa as I,U as F,Xa as c,Za as _,_b as B,bc as D,da as l,db as C,ha as y,ia as L,lb as z,na as k,tb as A,va as u,wa as p}from"./chunk-U6U25BWF.js";import"./chunk-B3LSNZRN.js";import"./chunk-WUBXWBRT.js";import{a as Z}from"./chunk-AUJJZC6I.js";import"./chunk-B52GHH4C.js";import"./chunk-KZ3CI6ZI.js";import"./chunk-HC6MZPB3.js";import"./chunk-SV2ZKNWA.js";import"./chunk-IA5KSSRM.js";import"./chunk-RS5W3JWO.js";import"./chunk-XENCGOZ2.js";import"./chunk-XZRAAXKF.js";import"./chunk-7D6K5XYM.js";import"./chunk-OBXDPQ3V.js";import"./chunk-QY5CJPR3.js";import"./chunk-MCRJI3T3.js";import"./chunk-ZD4SBDZ6.js";import"./chunk-NCLOD2DI.js";import"./chunk-UYQ7EZNZ.js";import"./chunk-BAKMWPBW.js";import"./chunk-AESNPOCP.js";import"./chunk-H3ZVKW6B.js";import"./chunk-HMK4XMX7.js";import"./chunk-E7UUDSES.js";import"./chunk-JQ3FRJ6A.js";import"./chunk-3IVKBF6N.js";import"./chunk-NMYJD6OP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-SV7S5NYR.js";import{j as f}from"./chunk-LVXXLD6S.js";var ne=["alertaLogin"],oe=(t,n)=>({"w-full pl-10 pr-3 py-3 border rounded-lg focus:outline-none focus:ring-2 transition-colors placeholder:text-gray-400":!0,"border-error focus:ring-error focus:border-error":t,"border-gray-300 focus:ring-primary focus:border-primary":n}),re=(t,n)=>({"w-full pl-10 pr-12 py-3 border rounded-lg focus:outline-none focus:ring-2 transition-colors placeholder:text-gray-400":!0,"border-error focus:ring-error focus:border-error":t,"border-gray-300 focus:ring-primary focus:border-primary":n}),ae=(t,n)=>({"w-full py-3 px-4 rounded-lg font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2":!0,"disabled:btn disabled:btn-soft disabled:btn-outline":t,"btn btn-primary":n});function le(t,n){t&1&&s(0,"span",8)}function se(t,n){t&1&&(O(),a(0,"svg",28),s(1,"path",29)(2,"path",30)(3,"path",31)(4,"path",32),r(),c(5)),t&2&&(l(5),_(" ","Continuar con Google @unab.edu.co"," "))}function ce(t,n){if(t&1&&(a(0,"div",21),c(1),r()),t&2){let g=P();l(),_(" ",g.formUtils.obtenerErrorDelCampo(g.loginForm,"email")," ")}}function me(t,n){t&1&&s(0,"app-web-icon",25)}function de(t,n){t&1&&s(0,"app-web-icon",26)}function ge(t,n){if(t&1&&(a(0,"div",21),c(1),r()),t&2){let g=P();l(),_(" ",g.formUtils.obtenerErrorDelCampo(g.loginForm,"password")," ")}}function ue(t,n){}var Ee=(()=>{let n=class n{constructor(){this.router=m(D),this.route=m(B),this.formBuilder=m(Q),this.alertaService=m(ie),this.navigationService=m(K),this.appService=m(J),this.authService=m(Y),this.mobileAuthService=m(te),this.formUtils=ee,this.loginForm=this.formBuilder.group({email:new S("",[h.required,h.email]),password:new S("",[h.required,h.minLength(6)])}),this.alertaLogin=A.required("alertaLogin",{read:y}),this.showPassword=F(!1)}ngOnInit(){return f(this,null,function*(){let i=this.route.snapshot.queryParams.sso_error;if(i){let o=this.route.snapshot.queryParams.sso_error_description||"Error en autenticaci\xF3n SSO",e="Error en la autenticaci\xF3n con Google. ";switch(i){case"access_denied":e+="Acceso denegado por el usuario.";break;case"no_code":e+="No se recibi\xF3 la autorizaci\xF3n necesaria.";break;case"token_exchange_failed":e+="Error al intercambiar el token.";break;case"unexpected_error":e+="Error inesperado. Int\xE9ntelo de nuevo.";break;default:e+=o}this.alertaService.error(e,8e3,this.alertaLogin(),"w-full block my-2"),this.authService.setLoading(!1),this.router.navigate([],{queryParams:{sso_error:null,sso_error_description:null},queryParamsHandling:"merge"})}})}togglePasswordVisibility(){this.showPassword.set(!this.showPassword())}obtenerColorIcono(i){return this.formUtils.esCampoInvalido(this.loginForm,i)?"danger":"dark"}loginSaml(){try{this.disableForm(),this.authService.setLoading(!0);let i=`${this.appService.samlUrl}/api/saml/${this.appService.tenantId}/login`;if(!i||!this.appService.samlUrl||!this.appService.tenantId){this.alertaService.error("Configuraci\xF3n de SSO incompleta. Contacte al administrador.",5e3,this.alertaLogin(),"w-full block my-2"),this.authService.setLoading(!1),this.loginForm.enable();return}console.debug("Redirecting to SAML SSO:",i),this.authService.clearSession(),Z.isNativePlatform()?this.mobileAuthService.loginWithSaml():setTimeout(()=>{window.location.href=i},100)}catch(i){console.error("Error initiating SAML login:",i),this.alertaService.error("Error al iniciar sesi\xF3n con SSO. Int\xE9ntelo de nuevo.",5e3,this.alertaLogin(),"w-full block my-2"),this.authService.setLoading(!1),this.loginForm.enable()}}disableForm(){this.loginForm.disable()}onLogin(){return f(this,null,function*(){if(this.loginForm.markAllAsTouched(),this.loginForm.invalid){this.loginForm.enable();return}let{email:i,password:o}=this.loginForm.value;this.authService.setLoading(!0),this.disableForm();try{if(!(yield this.authService.login(i,o)))throw new Error("No se pudo iniciar sesi\xF3n. Int\xE9ntalo de nuevo.");yield this.navegarDespesDeLogin()}catch(e){this.handleLoginError(e)}finally{this.authService.setLoading(!1),this.loginForm.enable()}})}navegarDespesDeLogin(){return f(this,null,function*(){let i=this.route.snapshot.queryParams.returnUrl;try{let o=yield this.authService.validarTerminosYPerfil();return o&&o!=="/"?this.router.navigateByUrl(o,{replaceUrl:!0}):i&&i!=="/"?this.router.navigateByUrl(i,{replaceUrl:!0}):this.router.navigateByUrl("/",{replaceUrl:!0})}catch{return this.router.navigateByUrl("/reservas")}})}handleLoginError(i){let o=i?.error?.message||"Por favor, int\xE9ntalo de nuevo.";this.alertaService.error(`Error al iniciar sesi\xF3n. ${o}`,5e5,this.alertaLogin(),"w-full block my-2"),this.authService.setLoading(!1)}delay(i){return new Promise(o=>setTimeout(o,i))}};n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=L({type:n,selectors:[["app-login"]],viewQuery:function(o,e){o&1&&U(e.alertaLogin,ne,5,y),o&2&&I()},decls:41,vars:21,consts:[["alertaLogin",""],[1,"min-h-screen","flex","items-center","justify-center","bg-gradient-to-br","from-primary","to-amber-50","p-4"],[1,"max-w-md","w-full","bg-white","rounded-2xl","shadow-2xl","p-4","md:p-8"],[1,"text-center","mb-4"],["src","assets/icon/logo-universidad-unab.png","alt","Logo de la Universidad Aut\xF3noma de Bucaramanga",1,"mx-auto","h-16","w-auto"],[1,"text-lg","text-center","font-semibold"],[1,"inline-block","w-full","text-sm","mb-2","text-center"],["type","button",1,"w-full","mb-4","py-3","px-4","cursor-pointer","hover:scale-105","transition-all","ease-in-out","duration-200","border","border-gray-300","rounded-lg","font-medium","text-gray-700","bg-white","hover:bg-gray-50","hover:font-semibold","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary","flex","items-center","justify-center","gap-3",3,"click","disabled"],[1,"loading","loading-spinner","loading-lg"],[1,"relative","mb-4"],[1,"absolute","inset-0","flex","items-center"],[1,"w-full","border-t","border-gray-300"],[1,"relative","flex","justify-center","text-sm"],[1,"px-2","bg-white","text-gray-500"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"space-y-2"],[1,"block","text-sm","font-medium","text-gray-700"],[1,"relative"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],["nombreIcono","at-outline","estilos","h-5 w-5 text-gray-400"],["type","email","autocomplete","email","formControlName","email","placeholder","tu@unab.edu.co",3,"ngClass"],[1,"text-sm","text-error"],["nombreIcono","lock-closed-outline","estilos","flex h-5 items-center pointer-events-none text-gray-400 w-5"],["formControlName","password","autocomplete","current-password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",3,"type","ngClass"],["type","button",1,"absolute","inset-y-0","right-0","pr-3","flex","items-center","text-gray-400","hover:text-base-content","cursor-pointer",3,"click","disabled"],["nombreIcono","eye-off-outline","estilos","h-5 w-5 items-center text-gray-400 hover:text-gray-600 cursor-pointer"],["nombreIcono","eye-outline","estilos","h-5 w-5 items-center text-gray-400 hover:text-gray-600 cursor-pointer"],["type","submit",3,"disabled","ngClass"],["viewBox","0 0 24 24",1,"w-5","h-5"],["fill","#4285F4","d","M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"],["fill","#34A853","d","M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"],["fill","#FBBC05","d","M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"],["fill","#EA4335","d","M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"]],template:function(o,e){if(o&1){let w=E();a(0,"div",1)(1,"div",2)(2,"div",3),s(3,"img",4),r(),a(4,"h2",5),c(5," Bienvenido a nuestro portal de reservas "),r(),a(6,"span",6),c(7," Solo puedes acceder con tu correo UNAB "),r(),a(8,"button",7),x("click",function(){return v(w),b(e.loginSaml())}),u(9,le,1,0,"span",8)(10,se,6,1),r(),a(11,"div",9)(12,"div",10),s(13,"div",11),r(),a(14,"div",12)(15,"span",13),c(16,"o"),r()()(),a(17,"form",14),x("ngSubmit",function(){return v(w),b(e.onLogin())}),a(18,"div",15)(19,"label",16),c(20,"Correo electr\xF3nico"),r(),a(21,"div",17)(22,"div",18),s(23,"app-web-icon",19),r(),s(24,"input",20),r(),u(25,ce,2,1,"div",21),r(),a(26,"div",15)(27,"label",16),c(28,"Contrase\xF1a"),r(),a(29,"div",17)(30,"div",18),s(31,"app-web-icon",22),r(),s(32,"input",23),a(33,"button",24),x("click",function(){return v(w),b(e.togglePasswordVisibility())}),u(34,me,1,0,"app-web-icon",25)(35,de,1,0,"app-web-icon",26),r()(),u(36,ge,2,1,"div",21),r(),k(37,ue,0,0,"ng-template",null,0,z),a(39,"button",27),c(40," Iniciar Sesi\xF3n "),r()()()()}o&2&&(l(8),d("disabled",e.authService.isLoading),l(),p(e.authService.isLoading?9:10),l(8),d("formGroup",e.loginForm),l(7),d("ngClass",C(12,oe,e.formUtils.esCampoInvalido(e.loginForm,"email"),!e.formUtils.esCampoInvalido(e.loginForm,"email"))),l(),p(e.formUtils.esCampoInvalido(e.loginForm,"email")?25:-1),l(7),d("type",e.showPassword()?"text":"password")("ngClass",C(15,re,e.formUtils.esCampoInvalido(e.loginForm,"password"),!e.formUtils.esCampoInvalido(e.loginForm,"password"))),l(),d("disabled",e.authService.isLoading),l(),p(e.showPassword()?35:34),l(2),p(e.formUtils.esCampoInvalido(e.loginForm,"password")?36:-1),l(3),d("disabled",e.loginForm.invalid||e.authService.isLoading)("ngClass",C(18,ae,e.loginForm.invalid,!e.loginForm.invalid)))},dependencies:[V,T,$,G,N,q,j,W,R,H,X],styles:["ion-content[_ngcontent-%COMP%]{--background: var(--ion-color-light)}.auth-full-height[_ngcontent-%COMP%]{height:100%}.auth-content-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;height:100%}.auth-title[_ngcontent-%COMP%]{font-weight:600;font-size:2.25rem;text-align:center}.auth-subtitle[_ngcontent-%COMP%]{font-weight:700;font-size:1.125rem}.auth-text[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.75rem}.auth-icon[_ngcontent-%COMP%]{margin-right:.75rem;margin-top:.125rem;margin-bottom:0}ion-item.auth-item[_ngcontent-%COMP%]{--background: var(--ion-color-medium-variant);--highlight-color-focused: var(--ion-color-dark);--highlight-color-error: var(--ion-color-danger);border-radius:24px}ion-item.auth-item--invalid[_ngcontent-%COMP%]{border:1px solid var(--ion-color-danger)}ion-item.auth-item--valid[_ngcontent-%COMP%]{border:1px solid var(--ion-color-success)}ion-item.auth-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--label-color: var(--ion-color-dark)}ion-item.auth-item.item-has-focus[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--label-color: var(--ion-color-dark);border:1px solid var(--ion-color-primary)}.auth-link-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:1rem;text-align:center}.auth-text-button[_ngcontent-%COMP%]{font-weight:700;font-size:1rem}.btn-login[_ngcontent-%COMP%]{height:50px}ion-card.auth-card[_ngcontent-%COMP%]{--background: var(--ion-color-white);--box-shadow: 0 4px 12px rgba(0, 0, 0, .1);--border-radius: 10px}.auth-grid[_ngcontent-%COMP%]{height:100%}.full-height[_ngcontent-%COMP%]{min-height:100%}.login-icon[_ngcontent-%COMP%]{margin-top:.125rem;margin-left:.75rem;margin-bottom:0}.eye-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.error-container[_ngcontent-%COMP%]{min-height:18px}.error-text[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-size:.8rem;margin:-8px 0 12px 12px;margin-bottom:30px!important;padding-left:32px;transition:all .5s cubic-bezier(1,0,0,1)}.login-container[_ngcontent-%COMP%]{background-color:var(--ion-color-light-tint);border-radius:16px;box-shadow:0 4px 12px #00000014}.auth-item[_ngcontent-%COMP%]{--border-radius: 24px;margin-top:10px;transition:all .3s ease}@media (max-width: 576px){.auth-item[_ngcontent-%COMP%]{--padding-start: 8px;--inner-padding-end: 8px}}.auth-item[_ngcontent-%COMP%]   .auth-input[_ngcontent-%COMP%]{width:100%}.welcome-text[_ngcontent-%COMP%]{margin-top:0;margin-bottom:16px}.w-100[_ngcontent-%COMP%]{width:100%}.input-valid[_ngcontent-%COMP%]{--background: rgba(var(--ion-color-success-rgb), .1);--border-color: var(--ion-color-success);box-shadow:0 0 0 1px var(--ion-color-success)}.input-invalid[_ngcontent-%COMP%]{--background: rgba(var(--ion-color-danger-rgb), .1);--border-color: var(--ion-color-danger);box-shadow:0 0 0 1px var(--ion-color-danger)}.validation-message[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-size:.8rem;margin:-8px 0 12px 12px;padding-left:32px}.responsive-link[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:center}@media (max-width: 340px){.responsive-link[_ngcontent-%COMP%]{flex-direction:column;gap:0}.responsive-link[_ngcontent-%COMP%]   ion-button.auth-text-button[_ngcontent-%COMP%]{margin-top:-12px}}@media (max-width: 576px){.auth-title[_ngcontent-%COMP%]{font-size:1.75rem;margin-top:1rem}.auth-subtitle[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.1rem;margin-bottom:12px}ion-item.auth-item[_ngcontent-%COMP%]{margin-bottom:12px}.auth-icon[_ngcontent-%COMP%]{font-size:18px}.validation-message[_ngcontent-%COMP%]{margin-bottom:8px;font-size:.7rem}.login-container[_ngcontent-%COMP%]{padding:1rem!important}}@media (min-width: 577px) and (max-width: 991px){.auth-title[_ngcontent-%COMP%]{font-size:2rem}.login-container[_ngcontent-%COMP%]{max-width:95%;margin:0 auto}}@media (min-width: 992px){.login-container[_ngcontent-%COMP%]{max-width:90%;margin:0 auto}}@media (max-height: 480px) and (orientation: landscape){.auth-title[_ngcontent-%COMP%]{font-size:1.5rem;margin-top:0;padding-bottom:8px!important}.welcome-text[_ngcontent-%COMP%]{font-size:1rem!important;margin-top:-8px;margin-bottom:8px!important}ion-item.auth-item[_ngcontent-%COMP%]{margin-bottom:8px}.validation-message[_ngcontent-%COMP%]{margin-bottom:4px}.ion-padding-top[_ngcontent-%COMP%], .ion-padding-bottom[_ngcontent-%COMP%]{padding-top:8px!important;padding-bottom:8px!important}}"],changeDetection:0});let t=n;return t})();export{Ee as LoginPage};
