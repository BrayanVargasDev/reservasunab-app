import{i as c}from"./chunk-AV73RGVI.js";import{f as u}from"./chunk-N4CCYIXR.js";import{D as l,H as n,bc as b,pb as d}from"./chunk-U6U25BWF.js";import{j as v}from"./chunk-LVXXLD6S.js";var P=(()=>{let e=class e{constructor(){this.authService=n(u),this.appService=n(c)}puedeAccederARuta(r){let t=this.authService.usuario();if(!t)return!1;if(t.rol?.nombre?.toLowerCase()==="administrador"||r.startsWith("/reservas"))return!0;let s=this.appService.pantallasQuery.data();if(!s)return!1;let i=this.buscarPantallaPorRuta(r,s);return i?(t.permisos||[]).some(p=>p.id_pantalla===i.id_pantalla):!0}tienePermiso(r){return this.authService.tienePermisos(r)}buscarPantallaPorRuta(r,t){let s=t.find(i=>i.ruta===r);return s||(s=t.find(i=>r.startsWith(i.ruta)&&i.ruta!=="/")),s||null}obtenerPantallasAccesibles(){let r=this.authService.usuario();if(!r)return[];let t=this.appService.pantallasQuery.data();if(!t)return[];let s=t.filter(a=>a.visible);if(r.rol?.nombre?.toLowerCase()==="administrador")return s.sort((a,h)=>a.orden-h.orden);let i=r.permisos||[],f=new Set(i.map(a=>a.id_pantalla)),p=s.filter(a=>a.ruta?.startsWith("/reservas")),S=s.filter(a=>f.has(a.id_pantalla)),m=new Map;return[...S,...p].forEach(a=>{m.set(a.id_pantalla,a)}),Array.from(m.values()).sort((a,h)=>a.orden-h.orden)}};e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=l({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var W=(()=>{let e=class e{constructor(){this.router=n(b),this.permissionService=n(P),this.appService=n(c),this.authService=n(u),this.obtenerPantallasDisponibles=d(()=>{try{return this.permissionService.obtenerPantallasAccesibles()||[]}catch{return[]}})}navegarAPrimeraPaginaDisponible(){return v(this,null,function*(){try{let r=this.authService.usuario(),t=this.appService.pantallasQuery.data();r||this.router.navigate(["/auth/login"],{replaceUrl:!0}),(!t||t.length===0)&&this.router.navigate(["/reservas"],{replaceUrl:!0});let s=this.obtenerPantallasDisponibles();if(s.length>0){let i=s[0];this.router.navigate([i.ruta])}else this.router.navigate(["/reservas"],{replaceUrl:!0})}catch{this.router.navigate(["/reservas"],{replaceUrl:!0})}})}obtenerPrimeraRutaDisponible(){let r=this.obtenerPantallasDisponibles();return r.length>0?r[0].ruta:"/reservas"}};e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=l({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();export{P as a,W as b};
