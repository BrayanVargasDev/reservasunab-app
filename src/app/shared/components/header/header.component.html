<div class="flex w-screen">
  <div class="navbar m-2 mb-0 md:mb-2 shadow-md bg-secondary rounded-box px-4 z-50">
    <div class="navbar-start">
      @if (shouldShowMenu()) {
      <button
        class="btn btn-secondary font-bold w-10 h-10 px-1 text-white md:hidden"
        (click)="toggleMobileDrawer()"
        title="Abrir menú"
      >
        <app-web-icon
          nombreIcono="menu-outline"
          estilos="w-full h-full stroke-3"
        ></app-web-icon>
      </button>
      }

      <!-- Logo unificado con lógica condicional -->
      <div 
        class="text-xl text-secondary-content font-bold ml-3 lg:ml-0"
        [class.cursor-pointer]="!isCompleteProfileMode()"
        (click)="isCompleteProfileMode() ? null : navegarAlInicio()"
      >
        <img
          src="assets/icon/logo-universidad-unab.png"
          class="inline-block w-32 brightness-0 invert"
          alt="Logo"
        />
      </div>
    </div>

    <div class="navbar-end gap-2">
      <!-- Créditos/saldo del usuario -->
      <div class="hidden md:flex items-center mr-2">
        @if (appService.creditosQuery.isLoading()) {
        <span
          class="loading loading-spinner loading-sm text-secondary-content"
        ></span>
        } @else if ((appService.creditosQuery.data() ?? 0) > 0) {
        <div
          [attr.data-tip]="'Solo podrá hacer uso de los créditos en reservas'"
          class="badge bg-secondary-content h-auto !p-1 text-secondary gap-2 px-3 py-3 tooltip-left tooltip"
        >
          <app-web-icon
            nombreIcono="wallet-outline"
            estilos="w-4 lg:w-5 w-4 lg:h-5 font-bold"
          ></app-web-icon>
          <span class="text-sm lg:text-base font-bold">
            Créditos: {{ appService.creditosQuery.data() | number }}
          </span>
        </div>
        }
      </div>
      <button
        class="btn btn-secondary font-bold w-10 h-10 btn-circle px-1 text-white md:hidden ml-1"
        (click)="recargarAplicacion()"
        [disabled]="isRefreshing()"
        title="Recargar aplicación"
      >
        <app-web-icon
          [nombreIcono]="isRefreshing() ? 'refresh-outline' : 'refresh-outline'"
          [estilos]="
            'w-full h-full stroke-3 font-bold' +
            (isRefreshing() ? ' animate-spin' : '')
          "
        ></app-web-icon>
      </button>
      <div class="flex-col hidden md:inline-flex">
        <span class="font-semibold text-secondary-content">
          {{ `${usuario()?.nombre} ${usuario()?.apellido}` }}
        </span>
        <span class="text-xs text-secondary-content">
          {{ obtenerLeyenda(usuario()) | upperFirst }}
        </span>
      </div>
      <div class="relative ml-3 hidden md:inline-flex">
        <div class="dropdown dropdown-end">
          <div tabindex="0" role="button" class="btn btn-sm btn-circle">
            <div class="w-10 rounded-full">
              <app-web-icon
                nombreIcono="person-circle-outline"
                estilos="w-full h-full !fill-base-content"
              ></app-web-icon>
            </div>
          </div>
          <ul
            tabindex="0"
            class="menu dropdown-content bg-base-100 rounded-box z-20 w-52 p-2 shadow-sm"
          >
            <li class="md:hidden">
              @if (appService.creditosQuery.isLoading()) {
              <div class="flex items-center py-1">
                <span class="loading loading-spinner loading-xs"></span>
                <span class="ml-2 text-sm">Cargando</span>
              </div>
              } @else if ((appService.creditosQuery.data() ?? 0) > 0) {
              <div class="badge badge-accent w-full gap-2 py-3">
                <app-web-icon
                  nombreIcono="wallet-outline"
                  estilos="h-5 w-5"
                ></app-web-icon>
                <span class="text-base font-semibold"
                  >Créditos:
                  {{ appService.creditosQuery.data() | number }}</span
                >
              </div>
              }
            </li>
            <li class="z-50">
              <a routerLink="/perfil" tabindex="-1">
                <app-web-icon
                  nombreIcono="person-outline"
                  estilos="h-4 w-4"
                ></app-web-icon>
                Perfil
              </a>
            </li>
            <li>
              <a (click)="cerrarSesion()" tabindex="-1" [class.pointer-events-none]="appService.editando()" [class.opacity-50]="appService.editando()">
                <app-web-icon
                  nombreIcono="log-out-outline"
                  estilos="h-4 w-4"
                ></app-web-icon>
                Cerrar Sesión
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
