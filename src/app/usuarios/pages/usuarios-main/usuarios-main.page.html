@if (!appService.esMovil()) {
<ng-template
  #chipWeb
  let-context>
  <div
    [attr.data-tip]="context.getValue() === 'Activo' ? 'Desactivar' : 'Activar'"
    [ngClass]="{
        'badge badge-outline min-w-20 hover:cursor-pointer hover:scale-105 transition-all tooltip align-middle': true,
        'badge-success': context.getValue() === 'Activo',
        'badge-error': context.getValue() === 'Inactivo',
    }">
    {{ context.getValue() }}
  </div>
</ng-template>

<ng-template
  #celdaNombre
  let-context>
  <div class="flex w-full h-full items-center justify-between">
    <span>{{ context.getValue() }}</span>
    <button
      class="btn btn-soft btn-accent w-8 h-8 rounded-box btn-sm lg:tooltip p-0"
      (click)="editarUsuario(context.row.original)"
      data-tip="Editar usuario">
      <app-web-icon
        estilos="h-4 w-4"
        nombreIcono="open-outline"></app-web-icon>
    </button>
  </div>
</ng-template>

<ng-template
  #celdaRol
  let-context>
  <div class="flex w-full h-full items-center justify-between">
    <span>{{ context.getValue() }}</span>
    <div class="dropdown dropdown-left">
      <button
        role="button"
        tabindex="0"
        class="btn btn-soft btn-secondary w-8 h-8 rounded-box btn-sm lg:tooltip p-0"
        data-tip="Cambiar rol">
        <app-web-icon
          estilos="h-4 w-4"
          nombreIcono="caret-down-outline"></app-web-icon>
      </button>
      <ul
        tabindex="0"
        class="dropdown-content menu bg-base-100 rounded-box z-1 w-52 p-2 shadow-sm"
        style="position-anchor: --anchor-1">
        <li>
          <button>Item 1</button>
        </li>
        <li><a>Item 2</a></li>
        <li class="flex justify-between items-center w-rull">
          <button
            class="btn btn-soft btn-accent w-full h-8 btn-sm flex justify-center items-center">
            <span>Crear un rol</span>
            <app-web-icon
              estilos="h-4 w-4"
              nombreIcono="open-outline"></app-web-icon>
          </button>
        </li>
      </ul>
    </div>
  </div>
</ng-template>

<div
  class="flex flex-col md:flex-row mt-2 pr-2 w-full pb-2 md:pb-4 items-stretch justify-center md:justify-between sticky top-0 z-10 bg-base-300">
  <div class="flex items-center">
    <h2 class="font-bold text-4xl">Usuarios</h2>
  </div>
  <div class="flex flex-col md:flex-row gap-2">
    <input
      type="text"
      placeholder="Buscar por nombre, email o rol..."
      class="input input-bordered input-primary w-full h-11 rounded-box md:max-w-xs placeholder:text-gray-500 placeholder:text-sm"
      [(ngModel)]="filtroTexto"
      (input)="aplicarFiltro()" />
    <button
      class="btn btn-primary h-11 rounded-box"
      (click)="agregarUsuario()">
      <app-web-icon
        estilos="h-6 w-6"
        nombreIcono="add-outline"></app-web-icon>
      Nuevo Usuario
    </button>
  </div>
</div>

<table
  responsiveTable
  #responsiveWeb="responsiveTable"
  [table]="table()"
  class="table table-sm sm:table-md rounded-box bg-base-100 w-full overflow-y-auto">
  <thead>
    @for (headerGroup of table.getHeaderGroups(); track headerGroup.id) {
    <tr>
      @if (responsiveWeb.hiddenColumnIds().size !== 0) {
      <th></th>
      } @for (header of headerGroup.headers; track header.id) { @if
      (!header.isPlaceholder) {
      <th
        [class]="header.column.columnDef.meta?.className || ''"
        [style.width]="header.getSize()">
        <ng-container
          *flexRender="
                    header.column.columnDef.header;
                    props: header.getContext();
                    let header
                  ">
          <div [innerHTML]="header"></div>
        </ng-container>
      </th>
      } }
    </tr>
    }
  </thead>
  <tbody>
    @if (!rows().length) {
    <tr>
      <td
        [attr.colspan]="columnas().length"
        class="text-center">
        No se encontraron resultados. Intenta con otro filtro.
      </td>
    </tr>
    } @else { @for (row of rows(); track row.id) {
    <tr
      [ngClass]="{ 'hover:bg-base-200': true, 'bg-base-200': isRowExpanded(+row.id) }"
      [class.expanded]="isRowExpanded(+row.id)">
      @if (responsiveWeb.hiddenColumnIds().size !== 0) {
      <td class="!pe-0">
        <app-table-expansor
          [isExpanded]="isRowExpanded(+row.id)"
          (toggleExpand)="row.toggleExpanded()"></app-table-expansor>
      </td>
      }
      <td *ngFor="let cell of row.getVisibleCells()">
        <ng-container
          *flexRender="
              cell.column.columnDef.cell;
              props: cell.getContext();
              let cell
            ">
          <div [innerHTML]="cell"></div>
        </ng-container>
      </td>
    </tr>

    @if (isRowExpanded(+row.id) && responsiveWeb.hiddenColumnIds().size !== 0) {
    <tr class="bg-base-300 border-none">
      <td [attr.colspan]="row.getVisibleCells().length + 1">
        @if (responsiveWeb.hiddenColumnIds().size !== 0) {
        <ul class="bg-base-100 rounded-box px-4 py-1 shadow-sm">
          @for (col of table.getAllLeafColumns(); track $index) { @if
          (responsiveWeb.hiddenColumnIds().has(col.id)) {
          <li class="flex my-2 flex-row gap-2 items-center">
            <span class="font-bold text-base-content">
              {{ col.columnDef.header }}:
            </span>
            <span>
              <ng-container
                *flexRender="
                        responsiveWeb.getCell(col, row).column.columnDef.cell;
                        props: responsiveWeb.getCell(col, row).getContext();
                        let cell
                      ">
                <div [innerHTML]="cell"></div>
              </ng-container>
            </span>
          </li>
          } }
        </ul>
        }
      </td>
    </tr>
    } } }
  </tbody>
</table>

<dialog
  #usuariosModal
  class="modal">
  <div class="modal-box">
    <h3 class="text-lg font-bold mb-4">{{ tituloModal() }}</h3>
    <form action="">
      <div
        class="flex w-full flex-col md:flex-row gap-2 md:gap-4 justify-center items-center">
        <div class="avatar">
          <div class="w-14 rounded-full">
            <img
              src="https://img.daisyui.com/images/profile/demo/yellingcat@192.webp" />
          </div>
        </div>

        <button
          [class]="`btn btn-outline btn-${ colorModal() ? colorModal() : 'secondary'} rounded-box h-11`">
          <app-web-icon
            estilos="h-6 w-6"
            nombreIcono="camera-outline"></app-web-icon>
          <label>Subir imagen</label>
        </button>
      </div>
      <div class="divider"></div>

      <div class="my-4 flex flex-col md:flex-row w-full gap-2 md:gap-3">
        <div class="flex flex-col w-full md:w-1/2">
          <label
            class="label text-sm font-[600] text-base-content mb-1 md:mb-2"
            for="nombre">
            Nombre
          </label>
          <input
            type="text"
            id="nombre"
            placeholder="Nombre"
            class="input input-bordered w-full h-11 rounded-box placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm" />
        </div>
        <div class="flex flex-col w-full md:w-1/2">
          <label
            class="label text-sm font-[600] text-base-content mb-1 md:mb-2"
            for="apellido">
            Apellido
          </label>
          <input
            type="text"
            id="apellido"
            placeholder="Apellido"
            class="input input-bordered w-full h-11 rounded-box placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm" />
        </div>
      </div>
      <div class="my-4 flex flex-col md:flex-row w-full gap-2 md:gap-3">
        <div class="flex flex-col w-full md:w-1/2">
          <label
            class="label text-sm font-[600] text-base-content mb-1 md:mb-2"
            for="telefono">
            Teléfono
          </label>
          <input
            type="tel"
            id="telefono"
            placeholder="1234567890"
            class="input input-bordered w-full h-11 rounded-box placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm" />
        </div>
        <div class="flex flex-col w-full md:w-1/2">
          <label
            class="label text-sm font-[600] text-base-content mb-1 md:mb-2"
            for="fechaNacimiento">
            Fecha de Nacimiento
          </label>
          <input
            type="date"
            id="fechaNacimiento"
            placeholder="Apellido"
            class="input input-bordered w-full h-11 rounded-box placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm" />
        </div>
      </div>
      <div class="my-4 flex flex-col w-full">
        <label class="label text-sm font-[600] text-base-content mb-1 md:mb-2"
          >Email</label
        >
        <input
          type="email"
          id="email"
          placeholder="micorreo@unab.edu.co"
          class="input input-bordered w-full h-11 rounded-box placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm" />
      </div>
      <div class="my-4 flex flex-col w-full">
        <label class="label text-sm font-[600] text-base-content mb-1 md:mb-2"
          >Dirección</label
        >
        <input
          type="text"
          id="direccion"
          placeholder="Calle X # 123A-45"
          class="input input-bordered w-full h-11 rounded-box placeholder:text-gray-400 placeholder:accent-base-300 placeholder:text-sm" />
      </div>
    </form>
    <div class="modal-action">
      <button
        type="button"
        class="btn btn-ghost h-11 rounded-box"
        (click)="cerrarModal()">
        Cerrar
      </button>
      <button
        type="button"
        [class]="`btn btn-${ colorModal() ? colorModal() : 'secondary'}  btn-soft h-11 rounded-box`"
        (click)="cerrarModal()">
        Guardar
      </button>
    </div>
  </div>
</dialog>
}
