@if (!imagen) {
<imagen-drop (fileDropped)="onImagenDrop($event)"></imagen-drop>
} @else {
<div class="flex border border-base-content rounded-lg p-4 mb-4">
  <img
    #espacioImagenRef
    [src]="imagen"
    alt="Imagen del espacio"
    class="w-full max-w-36 max-h-36 object-cover rounded-lg"
  />
  <div class="flex w-full flex-row justify-between items-center ml-4">
    <div class="flex flex-col gap-2">
      <span class="text-base font-semibold">{{ tiltuloImagen()?.nombre }}</span>
      <span class="text-sm italic text-gray-500">{{
        tiltuloImagen()?.peso
      }}</span>
    </div>
    @if (appService.editando()) {
    <button
      type="button"
      class="btn btn-error btn-soft h-8"
      (click)="borrarImagen()"
    >
      Borrar
    </button>
    }
  </div>
</div>
}

<form [formGroup]="espacioForm" (ngSubmit)="enviarFormulario()">
  <div class="my-4 flex flex-col md:flex-row w-full gap-2 md:gap-3">
    <div class="flex flex-col w-full md:w-1/3">
      <label
        class="label text-sm font-[600] text-base-content mb-1 md:mb-2"
        for="nombre"
      >
        Nombre <span class="text-error">*</span>
      </label>
      <input
        type="text"
        id="nombre"
        formControlName="nombre"
        placeholder="Nombre"
        [ngClass]="{
          'input input-bordered w-full h-11 rounded-md placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm': true,
          'input-error': formUtils.esCampoInvalido(espacioForm, 'nombre')
        }"
      />
      @if (formUtils.esCampoInvalido(espacioForm, 'nombre')) {
      <div class="text-sm text-error">
        {{ formUtils.obtenerErrorDelCampo(espacioForm, 'nombre') }}
      </div>
      }
    </div>
    <div class="flex flex-col w-full md:w-1/3">
      <label
        class="label text-sm font-[600] text-base-content mb-1 md:mb-2"
        for="tipoDocumento"
      >
        Sede <span class="text-error">*</span>
      </label>
      <select
        type="text"
        id="sede"
        formControlName="sede"
        [ngClass]="{
          'select input-bordered w-full h-11 rounded-md placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm': true,
          'input-error': formUtils.esCampoInvalido(espacioForm, 'sede')
        }"
      >
        <option value="" disabled selected>Seleccione</option>
        @for (sede of appService.sedesQuery.data(); track sede.id) {
        <option [value]="sede.id">
          {{ `${sede.nombre}` | titlecase }}
        </option>
        }
      </select>
      @if (formUtils.esCampoInvalido(espacioForm, 'sede')) {
      <div class="text-sm text-error">
        {{ formUtils.obtenerErrorDelCampo(espacioForm, 'sede') }}
      </div>
      }
    </div>
    <div class="flex flex-col w-full md:w-1/3">
      <label
        class="label text-sm font-[600] text-base-content mb-1 md:mb-2"
        for="tipoDocumento"
      >
        Tipo de espacio: <span class="text-error">*</span>
      </label>
      <select
        type="text"
        id="categoria"
        formControlName="categoria"
        [ngClass]="{
          'select input-bordered w-full h-11 rounded-md placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm': true,
          'input-error': formUtils.esCampoInvalido(espacioForm, 'categoria')
        }"
      >
        <option value="" disabled selected>Seleccione</option>
        @for (categoria of appService.categoriasQuery.data(); track
        categoria.id) {
        <option [value]="categoria.id">
          {{ `${categoria.nombre}` | titlecase }}
        </option>
        }
      </select>
      @if (formUtils.esCampoInvalido(espacioForm, 'categoria')) {
      <div class="text-sm text-error">
        {{ formUtils.obtenerErrorDelCampo(espacioForm, 'categoria') }}
      </div>
      }
    </div>
  </div>
  <div class="my-4 flex flex-col md:flex-row w-full gap-2 md:gap-3">
    <div class="flex flex-col w-full">
      <label
        class="label text-sm font-[600] text-base-content mb-1 md:mb-2"
        for="descripcion"
      >
        Descripción:
      </label>
      <textarea
        id="descripcion"
        formControlName="descripcion"
        class="textarea w-full placeholder:text-gray-400"
        placeholder="Escribe los detalles de este espacio"
      ></textarea>
    </div>
  </div>
  <div class="my-4 flex flex-col md:flex-row w-full gap-2 md:gap-3">
    <div class="flex flex-col w-full">
      <label class="label text-sm text-base-content" for="permitirJugadores">
        <input
          #permitirJugadores
          id="permitirJugadores"
          formControlName="permitirJugadores"
          type="checkbox"
          class="checkbox checkbox-bordered mr-2"
          (change)="onPermitirJugadoresChange($event)"
        />
        Se puede agregar jugadores
      </label>
    </div>
  </div>
  @if (permitirJugadores.checked) {
  <div class="my-4 flex flex-col md:flex-row w-full gap-2 md:gap-3">
    <div class="flex flex-col w-full md:w-1/3">
      <label
        class="label text-sm font-[600] text-base-content mb-1 md:mb-2"
        for="minimoJugadores"
      >
        Mínimo de jugadores: <span class="text-error">*</span>
      </label>
      <input
        type="text"
        id="minimoJugadores"
        formControlName="minimoJugadores"
        placeholder="3"
        [ngClass]="{
          'input input-bordered w-full h-11 rounded-md placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm': true,
          'input-error': formUtils.esCampoInvalido(
            espacioForm,
            'minimoJugadores'
          )
        }"
      />
      @if (formUtils.esCampoInvalido(espacioForm, 'minimoJugadores')) {
      <div class="text-sm text-error">
        {{ formUtils.obtenerErrorDelCampo(espacioForm, 'minimoJugadores') }}
      </div>
      }
    </div>
    <div class="flex flex-col w-full md:w-1/3">
      <label
        class="label text-sm font-[600] text-base-content mb-1 md:mb-2"
        for="maximoJugadores"
      >
        Máximo de Jugadores: <span class="text-error">*</span>
      </label>
      <input
        type="text"
        id="maximoJugadores"
        formControlName="maximoJugadores"
        placeholder="10"
        [ngClass]="{
          'input input-bordered w-full h-11 rounded-md placeholder:text-gray-400 placeholder:text-xs md:placeholder:text-sm': true,
          'input-error': formUtils.esCampoInvalido(
            espacioForm,
            'maximoJugadores'
          )
        }"
      />
      @if (formUtils.esCampoInvalido(espacioForm, 'maximoJugadores')) {
      <div class="text-sm text-error">
        {{ formUtils.obtenerErrorDelCampo(espacioForm, 'maximoJugadores') }}
      </div>
      }
    </div>
    <div class="flex flex-col w-full md:w-1/3 justify-center md:items-center">
      <label class="label text-sm text-base-content" for="permitirExternos">
        <input
          id="permitirExternos"
          formControlName="permitirExternos"
          type="checkbox"
          class="checkbox checkbox-bordered"
        />
        <span class="text-wrap">Se puede agregar usuarios externos</span>
      </label>
    </div>
  </div>
  }

  <ng-template #alertaFormEspacio></ng-template>

  <div class="modal-action">
    @if (espacioConfigService.modoEdicionGeneral()) {
    <button
      type="button"
      class="btn btn-ghost h-11 rounded-md"
      (click)="cancelarEditar()"
    >
      Cancelar
    </button>
    <button
      type="submit"
      [disabled]="espacioForm.invalid || false"
      [class]="`btn btn-accent  btn-soft h-11 rounded-md`"
    >
      Actualizar
    </button>
    } @else {
    <button
      type="button"
      [class]="`btn btn-secondary btn-soft h-11 rounded-md`"
      (click)="editarGeneral()"
    >
      Editar
    </button>
    }
  </div>
</form>
