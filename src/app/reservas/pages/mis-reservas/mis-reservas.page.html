<div
  class="flex flex-col md:flex-row lg:px-4 w-full pb-2 justify-center lg:justify-between sticky top-0 z-10 bg-base-300 sm:gap-3 lg:gap-0"
>
  <div
    class="flex max-md:pt-2 max-md:flex-row max-md:items-center max-md:justify-between flex-col w-full lg:w-auto gap-1 lg:gap-2"
  >
    <h2 class="mb-2 md:mb-0 font-bold text-2xl sm:text-3xl lg:text-4xl">
      Mis reservas
    </h2>
    <app-breadcrumbs estilos="py-0"></app-breadcrumbs>
  </div>
  <div
    class="flex flex-col sm:flex-row gap-2 py-1 sm:gap-3 w-full lg:w-auto max-sm:px-1"
  >
    <input
      type="text"
      placeholder="Buscar..."
      class="input max-sm:input-sm input-bordered input-primary w-full md:h-11 rounded-box lg:max-w-xs placeholder:text-gray-500 placeholder:text-sm disabled:placeholder:text-gray-400"
      [value]="misReservasService.filtroTexto()"
      (input)="aplicarFiltro($any($event.target).value)"
    />
    <button
      (click)="navegarReservas()"
      class="btn btn-primary max-sm:btn-sm md:h-11 rounded-box w-full sm:w-auto"
    >
      <app-web-icon
        estilos="h-5 w-5 sm:h-6 sm:w-6"
        nombreIcono="calendar-outline"
      ></app-web-icon>
      <span class="inline max-sm:text-sm text-base">Reservar</span>
    </button>
  </div>
</div>

<div
  class="lg:pl-4 grid w-full grow auto-rows-1 grid-cols-1 overflow-y-auto max-md:gap-1 gap-2 place-items-center"
>
  @for(reserva of misReservas; track $index) {
  <div class="bg-base-100 rounded-box p-3 sm:p-4 shadow-sm w-full">
    <div class="flex flex-wrap w-full gap-4 md:gap-6">
      <!-- Imagen -->
      <div class="flex-shrink-0 w-full md:w-auto">
        <img
          class="max-md:w-full w-38 h-full max-h-[6.75rem] object-cover rounded-md mx-auto md:mx-0"
          [src]="
            getImagenUrl(
              reserva.espacio.imagen?.ubicacion
                ? reserva.espacio.imagen?.ubicacion
                : 'assets/images/placeholder.png'
            )
          "
          [alt]="
            reserva.espacio.imagen?.ubicacion
              ? 'Imagen de ' + reserva.espacio.nombre
              : 'Imagen no disponible'
          "
        />
      </div>

      <!-- Información principal -->
      <div class="flex flex-col flex-grow">
        <h3 class="max-sm:text-sm text-base font-semibold text-base-content">
          Reserva {{ reserva.codigo.slice(10) }}
        </h3>
        <span class="text-gray-400 max-sm:text-xs text-sm">
          Espacio: {{ reserva.espacio.nombre }}
        </span>
        <span class="text-gray-400 max-sm:text-xs text-sm">
          Sede: {{ reserva.espacio.sede.nombre }}
        </span>
        <span class="text-gray-400 max-sm:text-xs text-sm">
          Categoría: {{ reserva.espacio.categoria.nombre }}
        </span>
      </div>

      <!-- Información de fecha y estado (móvil: columna, desktop: columna) -->
      <div class="flex flex-col md:flex-col w-full max-w-44">
        <div class="flex flex-col sm:flex-row md:flex-col">
          <span
            class="text-base-content font-semibold max-sm:text-sm text-base"
          >
            Fecha: {{ formatearFechaReserva(reserva.fecha) }}
          </span>
          <span class="text-gray-400 max-sm:text-xs text-sm">
            Hora: {{ reserva.hora_inicio | date : 'shortTime' }}
          </span>
        </div>
        <div
          class="flex w-full flex-wrap lg:items-center lg:justify-between gap-2"
        >
          <span class="text-gray-400 max-sm:text-xs text-sm">Estado:</span>
          <span
            class="badge font-semibold max-sm:text-xs text-sm"
            [ngClass]="`badge-${pagosService.obtenerColorEstado(reserva.estado)}`"
          >
            {{ reserva.estado | upperFirst }}
          </span>
        </div>

        <!-- Botones de acción -->
        <div class="flex gap-2 mt-1">
          <button
            (click)="verDetalleReserva(reserva.id)"
            class="btn btn-secondary btn-sm rounded-lg max-sm:h-9 flex-1"
          >
            <app-web-icon
              estilos="max-sm:h-4 h-5 max-sm:w-4 h-5"
              nombreIcono="eye-outline"
            ></app-web-icon>
            <span class="hidden sm:inline max-sm:text-sm text-base"
              >Ver detalles</span
            >
            <span class="sm:hidden max-sm:text-sm text-base">Ver</span>
          </button>
          @if (sePuedeCancelar(reserva)) {
          <button
            (click)="cancelarReserva(reserva)"
            class="btn btn-error btn-sm"
            title="Cancelar reserva"
          >
            <app-web-icon
              estilos="h-4 w-4"
              nombreIcono="close-outline"
            ></app-web-icon>
            <span class="hidden lg:inline">Cancelar</span>
          </button>
          }
        </div>
      </div>
    </div>
  </div>
  } @empty {
  <div
    class="alert text-base xl:text-lg max-sm:gap-1 gap-2 alert-info alert-outline w-full rounded-box flex flex-col items-center justify-center"
  >
    <app-web-icon
      estilos="h-16 w-16 text-3xl"
      nombreIcono="search-circle-outline"
    ></app-web-icon>
    <span class="text-center">
      No tienes reservas que coincidan con
      <strong>"{{ misReservasService.filtroTexto() }}"</strong>
    </span>
    <span class="text-center">
      Intenta con otro término de búsqueda o crea una haciendo click en
      "Reservar"
    </span>
  </div>
  }
</div>

<!-- Modal de detalles de reserva -->
<modal-dreservas></modal-dreservas>
