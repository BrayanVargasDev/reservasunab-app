<dialog
  #dreservasModal
  class="modal p-0 z-50"
  style="scrollbar-gutter: unset"
  (cancel)="onDialogCancel($event)"
>
  <div
    class="modal-box p-0 max-w-[95dvw] lg:max-w-[80dvw] xl:max-w-[50rem] w-full max-h-[95dvh] lg:!max-h-[98dvh] overflow-hidden relative flex flex-col"
  >
    <div
      class="sticky top-0 bg-base-100 z-10 border-b border-base-300 px-2 lg:px-6 py-4 flex-shrink-0"
    >
      @if (dreservasService.espacioDetallesQuery.isPending()) {
      <span
        class="w-full mx-auto skeleton bg-gray-300 h-7 rounded-xl block max-w-[65%]"
      ></span>
      } @else {
      <span class="w-full text-center text-2xl font-bold block truncate">
        {{ espacioDetallesQuery?.nombre }}
      </span>
      }
    </div>

    @if (dreservasService.cargando()) {
    <div
      class="flex flex-row items-center justify-center h-full min-h-[40vh] p-2 lg:p-4 xl:p-6 flex-grow"
    >
      <span class="loading loading-spinner loading-xl text-primary"></span>
      <span class="ml-2 text-base-content">{{
        dreservasService.mensajeCargando()
      }}</span>
    </div>
    } @else {
    <div class="flex-grow overflow-hidden flex flex-col">
      @if (dreservasService.mostrandoResumenNueva()) {
      <div class="alert alert-info rounded-lg mt-2 mx-2 lg:mx-6 flex-shrink-0">
        <div class="flex items-center justify-center w-full">
          <app-web-icon
            [nombreIcono]="
              estadoResumen()?.estado === 'pagada'
                ? 'checkmark-circle-outline'
                : 'information-circle-outline'
            "
            estilos="h-6 w-6 mr-2"
          ></app-web-icon>
          <span class="text-xl font-bold">
            @if (estadoResumen()?.estado === 'pagada') { ¡Reserva completada! }
            @else { Resumen de reserva }
          </span>
        </div>
      </div>
      } @else if (dreservasService.mostrandoResumenExistente()) {
      <div
        class="alert rounded-lg mt-2 mx-2 lg:mx-6 flex-shrink-0"
        [ngClass]="{
          'alert-success': miReserva()?.estado === 'pagada',
          'alert-info': miReserva()?.estado !== 'pagada',
        }"
      >
        <div class="flex items-center justify-center w-full">
          <app-web-icon
            [nombreIcono]="
              miReserva()?.estado === 'pagada'
                ? 'checkmark-circle-outline'
                : 'information-circle-outline'
            "
            estilos="h-6 w-6 mr-2"
          ></app-web-icon>
          <span class="text-xl font-bold">
            {{ `${miReserva()?.estado === 'pagada' ? '¡Reserva completada!' : 'Resumen de reserva'}` }}
          </span>
        </div>
      </div>
      } @else if (dreservasService.mostrandoJugadores()) {
      <div class="alert alert-info rounded-lg mt-2 mx-2 lg:mx-6 flex-shrink-0">
        <div class="flex items-center justify-center w-full">
          <app-web-icon
            nombreIcono="people-outline"
            estilos="h-6 w-6 mr-2"
          ></app-web-icon>
          <span class="text-xl font-bold">Agregar Jugadores</span>
        </div>
      </div>
      } @else if (dreservasService.mostrandoDetalles()) {
      <div class="alert alert-info rounded-lg mt-2 mx-2 lg:mx-6 flex-shrink-0">
        <div class="flex items-center justify-center w-full">
          <app-web-icon
            nombreIcono="briefcase-outline"
            estilos="h-6 w-6 mr-2"
          ></app-web-icon>
          <span class="text-xl font-bold">Agregar Elementos</span>
        </div>
      </div>
      }

      <div
        class="flex-grow overflow-y-auto max-h-full px-2 lg:px-6 max-sm:py-1 py-2"
      >
        @if (dreservasService.mostrandoResumenNueva()) {
        <div class="flex flex-col h-full">
          <dreservas-info-reserva
            [resumen]="estadoResumen()"
          ></dreservas-info-reserva>
          @if (estadoResumen()?.necesita_aprobacion && estadoResumen()?.id !==
          null && estadoResumen()?.estado === 'pendienteap') {
          <div class="alert alert-warning mt-4 rounded-lg text-sm">
            <div class="flex items-start gap-2">
              <app-web-icon
                nombreIcono="alert-circle-outline"
                estilos="h-5 w-5"
              ></app-web-icon>
              <span>
                Tu reserva está <strong>pendiente de aprobación</strong>, se
                hará válida tan pronto sea aprobada por un administrador.
              </span>
            </div>
          </div>
          }
        </div>
        } @else if (dreservasService.mostrandoResumenExistente()) {
        <div class="flex flex-col h-full">
          <dreservas-info-reserva
            [resumen]="miReserva()"
          ></dreservas-info-reserva>
          @if (necesitaPago() && estadoResumen()?.estado !== 'completada') {
          <div class="alert alert-info mt-4 rounded-lg text-sm">
            <div class="flex items-start gap-2">
              <app-web-icon
                nombreIcono="time-outline"
                estilos="h-5 w-5"
              ></app-web-icon>
              <span>
                Tienes <strong>30 minutos</strong> para realizar el pago; de lo
                contrario, la reserva se
                <strong>cancelará automáticamente</strong>.
              </span>
            </div>
          </div>
          } @if (miReserva()?.necesita_aprobacion && miReserva().estado ===
          'pendienteap') {
          <div class="alert alert-warning mt-4 rounded-lg text-sm">
            <div class="flex items-start gap-2">
              <app-web-icon
                nombreIcono="alert-circle-outline"
                estilos="h-5 w-5"
              ></app-web-icon>
              <span>
                Tu reserva está <strong>pendiente de aprobación</strong>, se
                hará válida tan pronto sea aprobada por un administrador.
              </span>
            </div>
          </div>
          }
        </div>
        } @else if (dreservasService.mostrandoJugadores()) {
        <div class="flex flex-col h-fit">
          @if (mensajeEstado(); as mensaje) {
          <div class="alert alert-warning mb-4 rounded-lg text-sm">
            <div class="flex items-center justify-center w-full">
              <span>{{ mensaje }}</span>
            </div>
          </div>
          }

          <div class="form-control w-full max-sm:mb-0.5 mb-2">
            <label class="label">
              <span class="label-text font-semibold"
                >Buscar participantes:</span
              >
            </label>
            <input
              type="text"
              placeholder="Escribe el nombre, email o documento..."
              class="input input-bordered w-full"
              [value]="dreservasService.terminoBusquedaJugadores()"
              (input)="onBuscarJugadores($event)"
            />
          </div>

          @if (dreservasService.terminoBusquedaJugadores().trim().length > 0) {
          <div class="flex-1">
            @if (dreservasService.jugadoresQuery.isPending()) {
            <div class="flex justify-center items-center py-4">
              <span
                class="loading loading-spinner loading-md text-primary"
              ></span>
              <span class="ml-2">Buscando participantes...</span>
            </div>
            } @else if (dreservasService.jugadoresQuery.data()) { @if
            (dreservasService.jugadoresQuery.data()!.length === 0) {
            <div class="text-center py-4 text-base-content/70">
              No se encontraron participantes con ese criterio de búsqueda.
            </div>
            } @else {
            <div class="space-y-1 mb-3">
              <h4 class="font-semibold text-lg mb-3">
                Participantes encontrados:
              </h4>
              @for (jugador of dreservasService.jugadoresQuery.data()!; track
              jugador.id) {
              <div
                class="card shadow-sm rounded-xl"
                [ngClass]="{
                  'bg-purple-100': jugador.es_beneficiario,
                  'bg-base-300/70': !jugador.es_beneficiario
                }"
              >
                <div
                  class="card-body px-2 py-1 flex flex-row items-center justify-between"
                >
                  <div class="flex flex-col">
                    <span class="font-semibold">
                      {{ jugador.nombre }} {{ jugador.apellido }}
                      @if (jugador.es_beneficiario) {
                      <span class="text-purple-700"> - Beneficiario</span>
                      }
                    </span>
                    <span class="text-sm text-base-content">{{
                      jugador.email
                    }}</span>
                    <span class="text-sm text-base-content">
                      <strong>{{ jugador.codigo_tipo_documento }}:</strong>
                      {{ jugador.documento }}
                      @if (jugador.ldap_uid) {
                      <strong>Banner: </strong>{{ jugador.ldap_uid }}
                      }
                    </span>
                  </div>
                  <button
                    type="button"
                    class="btn btn-primary btn-sm"
                    (click)="agregarJugador(jugador)"
                    [disabled]="!puedeSeleccionarJugadorEspecifico(jugador.id)"
                  >
                    @if (esJugadorSeleccionado(jugador.id) ||
                    yaEstaEnReserva(jugador.id)) { Agregado }
                    <!-- IGNORE -->
                    @else if (!puedeSeleccionarJugador()) { Límite alcanzado }
                    @else { Agregar }
                  </button>
                </div>
              </div>
              }
            </div>
            } }
          </div>
          } @if (listaJugadoresSeleccionados().length > 0) {
          <div class="border-t flex-1 pt-2">
            <h4 class="font-semibold text-lg mb-3">
              Participantes seleccionados ({{
                listaJugadoresSeleccionados().length
              }}):
            </h4>
            <div class="space-y-2 mb-4">
              @for (jugador of listaJugadoresSeleccionados(); track jugador.id)
              {
              <div
                class="flex items-center justify-between bg-success/10 rounded-lg p-2"
              >
                <div class="flex flex-col">
                  <span class="font-semibold">
                    {{ jugador.nombre }} {{ jugador.apellido }}
                    @if (jugador.es_beneficiario) {
                    <span class="text-purple-700"> - Beneficiario</span>
                    }
                  </span>
                  <span class="text-sm text-base-content">{{
                    jugador.email
                  }}</span>
                </div>
                @if (jugador.id !== userIdActual()) {
                <button
                  type="button"
                  class="btn btn-error btn-xs"
                  (click)="removerJugador(jugador.id)"
                >
                  <app-web-icon
                    nombreIcono="trash-outline"
                    estilos="h-4 w-4"
                  ></app-web-icon>
                </button>
                }
              </div>
              }
            </div>
          </div>
          }
          <div class="flex justify-end h-full flex-1 gap-2">
            <button
              type="button"
              class="btn max-sm:btn-sm btn-ghost md:h-11 rounded-lg"
              (click)="cancelarAgregarJugadores()"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn max-sm:btn-sm btn-success md:h-11 rounded-lg"
              (click)="confirmarAgregarJugadores()"
              [disabled]="
                cargando() ||
                dreservasService.jugadoresSeleccionados().length === 0
              "
            >
              @if (cargando()) {
              <span class="loading loading-spinner loading-sm"></span>
              } @if (dreservasService.jugadoresSeleccionados().length === 0) {
              Selecciona jugadores } @else { Confirmar ({{
                dreservasService.jugadoresSeleccionados().length
              }}) }
            </button>
          </div>
        </div>
        } @else if (dreservasService.mostrandoDetalles()) {
        <div class="flex flex-col h-fit">
          <div class="form-control w-full max-sm:mb-0.5 mb-2">
            <label class="label">
              <span class="label-text font-semibold">Buscar elementos:</span>
            </label>
            <input
              type="text"
              placeholder="Escribe el nombre del elemento..."
              class="input input-bordered w-full"
              [value]="dreservasService.terminoBusquedaElementos()"
              (input)="onBuscarElementos($event)"
            />
          </div>

          @if (dreservasService.terminoBusquedaElementos().trim().length > 0) {
          <div class="flex-1">
            @if (dreservasService.elementosQuery.isPending()) {
            <div class="flex justify-center items-center py-4">
              <span
                class="loading loading-spinner loading-md text-primary"
              ></span>
              <span class="ml-2">Buscando elementos...</span>
            </div>
            } @else if (dreservasService.elementosQuery.data()) { @if
            (dreservasService.elementosQuery.data()!.length === 0) {
            <div class="text-center py-2 text-base-content/70">
              No se encontraron elementos con ese criterio.
            </div>
            } @else {
            <div class="space-y-1 mb-3">
              <h4 class="font-semibold text-lg mb-2">Resultados:</h4>
              @for (el of dreservasService.elementosQuery.data()!; track el.id)
              {
              <div class="card shadow-sm rounded-xl bg-base-300/70">
                <div
                  class="card-body px-2 py-1 flex flex-row items-center justify-between gap-2"
                >
                  <div class="flex flex-col">
                    <span class="font-semibold">{{ el.nombre }}</span>
                    <span class="text-xs text-base-content/70"
                      >$ {{ getPrecioUnitario(el) | number : '1.0-0' }} (x
                      unidad)</span
                    >
                  </div>
                  <div class="flex items-center gap-2">
                    <label class="label-text text-xs">Cantidad</label>
                    <input
                      type="number"
                      min="1"
                      class="input input-sm input-bordered w-20 text-right"
                      [value]="cantidadPorAgregar[el.id] || 1"
                      (input)="onCantidadInput(el.id, $event)"
                    />
                    <button
                      type="button"
                      class="btn btn-primary btn-sm"
                      (click)="agregarElemento(el)"
                    >
                      Agregar
                    </button>
                  </div>
                </div>
              </div>
              }
            </div>
            } }
          </div>
          } @if (dreservasService.detallesSeleccionados().length > 0) {
          <div class="border-t flex-1 pt-2">
            <h4 class="font-semibold text-lg mb-3">
              Elementos agregados ({{
                dreservasService.detallesSeleccionados().length
              }}):
            </h4>
            <div class="space-y-2 mb-4">
              @for (el of dreservasService.detallesSeleccionados(); track
              $index) {
              <div
                class="flex items-center justify-between bg-success/10 rounded-lg p-2 gap-2"
              >
                <div class="flex flex-col min-w-0">
                  <span class="font-medium truncate">{{ el.nombre }}</span>
                  <span class="text-xs text-base-content/70"
                    >Cant: {{ el.cantidad_seleccionada || 1 }}</span
                  >
                </div>
                <div class="flex items-center gap-3">
                  <span class="text-sm font-semibold text-base-content/80"
                    >$
                    {{
                      getPrecioUnitario(el) * (el.cantidad_seleccionada || 1)
                        | number : '1.0-0'
                    }}
                  </span>
                  <button
                    type="button"
                    class="btn btn-error btn-xs"
                    (click)="removerElementoSeleccionado(el, $index)"
                  >
                    <app-web-icon
                      nombreIcono="trash-outline"
                      estilos="h-4 w-4"
                    ></app-web-icon>
                  </button>
                </div>
              </div>
              }
            </div>
          </div>
          }

          <div class="flex justify-end h-full flex-1 gap-2">
            <button
              type="button"
              class="btn max-sm:btn-sm btn-ghost md:h-11 rounded-lg"
              (click)="cancelarAgregarDetalles()"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn max-sm:btn-sm btn-success md:h-11 rounded-lg"
              (click)="confirmarAgregarDetalles()"
              [disabled]="
                cargando() ||
                dreservasService.detallesSeleccionados().length === 0
              "
            >
              @if (cargando()) {
              <span class="loading loading-spinner loading-sm"></span>
              } @else { Confirmar }
            </button>
          </div>
        </div>
        } @else { @if (dreservasService.espacioDetallesQuery.isPending()) {
        <!-- Skeleton de la vista de disponibilidad -->
        <div class="h-full flex flex-col gap-6 animate-pulse">
          <div class="flex gap-4 w-full flex-shrink-0">
            <div class="flex flex-col w-1/2 mb-2">
              <div
                class="w-full h-[13rem] rounded-lg skeleton bg-gray-300"
              ></div>
            </div>
            <div class="flex flex-col w-1/2 gap-3">
              <div class="flex items-center gap-2">
                <div class="skeleton bg-gray-300 h-5 w-5 rounded-full"></div>
                <div class="skeleton bg-gray-300 h-5 w-40 rounded"></div>
              </div>
              <div class="skeleton bg-gray-300 h-4 w-52 rounded"></div>
              <div class="skeleton bg-gray-300 h-5 w-48 rounded"></div>
            </div>
          </div>

          <div class="flex flex-col gap-3 w-full flex-1">
            <div class="skeleton bg-gray-300 h-6 w-48 mx-auto rounded"></div>
            <div class="flex-1 overflow-y-auto overflow-x-auto">
              <div
                class="grid p-1 gap-2 items-center grid-cols-[repeat(auto-fill,minmax(7rem,1fr))] min-w-max"
              >
                <!-- Grid de slots skeleton -->
                <ng-container *ngFor="let i of [1, 2, 3, 4, 5, 6, 7, 8]">
                  <div
                    class="h-12 skeleton bg-gray-300 rounded-lg w-full"
                  ></div>
                </ng-container>
              </div>
            </div>
          </div>

          <div class="flex flex-col gap-3 w-full flex-1">
            <div class="skeleton bg-gray-300 h-6 w-56 mx-auto rounded"></div>
            <div class="border border-base-content/30 rounded-lg p-4 space-y-3">
              <div class="skeleton bg-gray-300 h-4 w-full rounded"></div>
              <div class="skeleton bg-gray-300 h-4 w-11/12 rounded"></div>
              <div class="skeleton bg-gray-300 h-4 w-10/12 rounded"></div>
              <div class="skeleton bg-gray-300 h-4 w-8/12 rounded"></div>
            </div>
          </div>
        </div>
        } @else {
        <div class="h-full flex flex-col">
          <div class="flex gap-4 w-full flex-shrink-0">
            <div class="flex flex-col w-1/2 mb-2" [ngClass]="{
              'h-[13rem] rounded-lg bg-gray-800 flex items-center justify-center': !getImagenUrl(espacioDetallesQuery?.imagen?.ubicacion)
            }">
              @if (!getImagenUrl(espacioDetallesQuery?.imagen?.ubicacion)) {
              <app-web-icon
                nombreIcono="image-outline"
                [estilos]="'w-30 h-30 text-white/80'"
              ></app-web-icon>
              } @else {
              <img
                class="w-full h-[13rem] object-cover rounded-lg"
                [src]="getImagenUrl(espacioDetallesQuery?.imagen?.ubicacion)"
                alt=""
              />
              }
            </div>
            <div class="flex flex-col w-1/2 gap-2">
              <div class="w-full flex items-center">
                <app-web-icon
                  nombreIcono="location-outline"
                  estilos="h-5 w-5 font-bold text-secondary !fill-secondary"
                >
                </app-web-icon>
                <span class="font-bold text-sm lg:text-base ml-1">
                  Sede: {{ espacioDetallesQuery?.sede?.nombre | uppercase }}
                </span>
              </div>
              <span class="inline-block max-sm:text-sm">
                <span class="font-semibold"
                  >Disponible para reservar desde:
                </span>
                {{
                  obtenerFechaDeApertura(
                    espacioDetallesQuery?.configuracion!,
                    espacioDetallesQuery?.tipo_usuario_config!
                  )
                }}
              </span>
              <span class="inline-block max-sm:text-sm align-middle">
                <span class="font-bold">Fecha de reserva: </span>
                <span class="badge badge-info border-2 font-bold badge-lg">
                  {{ dreservasService.fecha() | date : 'dd/MM/yyyy' }}
                </span>
              </span>
              @if (espacioDetallesQuery?.pago_mensual &&
              !espacioDetallesQuery?.usuario_mensualidad_activa) {
              <span
                class="inline-block alert alert-error p-2 font-semibold rounded-lg max-sm:text-sm align-middle"
              >
                No tienes una mensualidad activa para este espacio.
              </span>
              }
              <!--.-->
              @if ( espacioDetallesQuery?.usuario_mensualidad_activa &&
              espacioDetallesQuery?.pago_mensual) {
              <span class="alert alert-success font-semibold rounded-lg p-2">
                {{ esEstudiante() ? 'Estudiante' : 'Usuario' }} habilitado para
                reservar.
              </span>
              }
              <!--.-->
              @if (espacioDetallesQuery?.pago_mensual &&
              !espacioDetallesQuery?.usuario_mensualidad_activa) {
              <button
                (click)="pagarMensualidad()"
                class="btn btn-secondary max-md:p-1 p-2 max-sm:h-fit sm:h-10"
                [disabled]="pagandoMensualidad()"
              >
                @if (!pagandoMensualidad()) { Pagar mensualidad:
                {{
                  espacioDetallesQuery?.valor_mensualidad
                    | currency : '$' : 'symbol' : '1.0-0'
                }}
                }@else {
                <span class="loading loading-spinner loading-sm mr-2"></span>
                Redirigiendo... }
              </button>
              }
              <!--.-->
              @if (espacioDetallesQuery?.usuario_mensualidad_activa &&
              espacioDetallesQuery?.mensualidad) {
              <span class="alert alert-success font-semibold rounded-lg p-2">
                Mensualidad activa desde
                {{
                  espacioDetallesQuery?.mensualidad?.fecha_inicio
                    | date : 'dd/MM/yyyy'
                }}

                hasta

                {{
                  espacioDetallesQuery?.mensualidad?.fecha_fin
                    | date : 'dd/MM/yyyy'
                }}
              </span>
              }
            </div>
          </div>

          <div class="flex flex-col gap-1 w-full flex-1">
            <span
              class="flex w-full text-lg font-bold text-center flex-shrink-0"
            >
              Disponibilidad:
            </span>
            <div class="flex-1">
              <div
                class="grid p-1 gap-2 items-center grid-cols-[repeat(auto-fill,minmax(7rem,1fr))] min-w-max"
              >
                @for (item of espacioDetallesQuery?.disponibilidad; track
                $index) {
                <button
                  type="button"
                  (click)="
                    item.mi_reserva
                      ? verMiReserva(item.id_reserva)
                      : item.disponible
                      ? iniciarReserva(espacioDetallesQuery, item)
                      : null
                  "
                  class="h-12 text-semibold text-lg w-full items-center justify-center rounded-lg btn disabled:text-sm disabled:text-gray-500 px-2 gap-0"
                  [disabled]="
                    item.reserva_pasada &&
                    !item.mi_reserva &&
                    !item.novedad &&
                    !item.reservada
                  "
                  [class.btn-disabled]="
                    item.reserva_pasada &&
                    !item.mi_reserva &&
                    !item.novedad &&
                    !item.reservada
                  "
                  [class.btn-accent]="item.disponible"
                  [class.btn-success]="item.mi_reserva"
                  [class.btn-error]="!item.mi_reserva && item.reservada"
                  [class.btn-warning]="item.novedad && !item.mi_reserva"
                  [class.tooltip]="
                    item.novedad_desc && item.novedad_desc.length > 10
                  "
                  [class.pointer-events-none]="
                    !item.disponible && item.reserva_pasada && !item.mi_reserva
                  "
                  [ngClass]="{
                      'hover:opacity-90 hover:scale-101 transition-all duration-200': item.disponible,
                    }"
                >
                  @if (item.novedad_desc && item.novedad_desc.length > 10) {
                  <div class="tooltip-content w-min text-sm">
                    {{ item.novedad_desc }}
                  </div>
                  } @if (item.disponible && !item.reservada && !item.mi_reserva)
                  {
                  <span class="inline-block w-full">{{
                    item.hora_inicio
                  }}</span>
                  } @else if (item.reservada && !item.mi_reserva) {
                  <span class="text-wrap text-base leading-tight">
                    {{ `${item.hora_inicio} - Reservado` }}
                  </span>
                  } @else if (item.mi_reserva) {
                  <span class="text-sm">{{ `Mi reserva` }}</span>
                  } @else if (!item.reservada && item.novedad) {
                  <span class="text-sm">
                    {{ item.hora_inicio }} -
                    {{
                      item.novedad_desc && item.novedad_desc.length > 10
                        ? item.novedad_desc.slice(0, 8) + '...'
                        : item.novedad_desc
                    }}
                  </span>
                  } @else {
                  <span class="inline-block w-full">
                    {{ item.hora_inicio }}
                  </span>
                  }
                </button>
                }
              </div>
            </div>
          </div>

          <div class="flex flex-col gap-1 w-full flex-1">
            <span
              class="flex w-full text-lg font-bold text-center flex-shrink-0"
            >
              Notas importantes:
            </span>
            <div
              class="border border-base-content/70 rounded-lg prose quill-reset text-base"
            >
              <quill-view-html
                class="max-sm:text-sm text-base"
                [content]="espacioDetallesQuery?.descripcion || ''"
              ></quill-view-html>
            </div>
          </div>
        </div>
        } }
      </div>
    </div>
    }
    <ng-template #alertaModalReservas></ng-template>
    <div
      class="sticky bottom-0 pt-2 bg-base-100 border-t border-base-300 px-2 pb-2 lg:px-4 lg:pb-4 xl:px-6 xl:pb-6 z-10 flex-shrink-0"
    >
      <div class="modal-action !mt-0 flex-wrap">
        <button
          type="button"
          class="btn max-sm:btn-sm btn-ghost md:h-11 rounded-lg mr-auto"
          (click)="manejarCierreModal()"
        >
          Cerrar
        </button>
        @if(pudeCancelar() && noCancelada() && !esReservaPasada() &&
        dreservasService.mostrandoResumenExistente()) {
        <button
          type="button"
          class="btn max-sm:btn-sm btn-error md:h-11 rounded-lg"
          (click)="cancelarReserva()"
          [disabled]="cargando()"
        >
          <app-web-icon
            nombreIcono="trash-outline"
            estilos="h-5 w-5 max-md:hidden mr-2"
          ></app-web-icon>
          Cancelar reserva
        </button>
        } @if (puedeAgregarMasJugadores() &&
        !dreservasService.mostrandoDisponibilidad() &&
        !dreservasService.mostrandoDetalles() &&
        !dreservasService.mostrandoJugadores() && !esReservaPasada() &&
        noCancelada()) {
        <button
          type="button"
          class="btn max-sm:btn-sm btn-accent md:h-11 rounded-lg"
          (click)="mostrarAgregarJugadores()"
          [disabled]="cargando()"
        >
          <app-web-icon
            nombreIcono="people-outline"
            estilos="h-5 w-5 max-md:hidden mr-2"
          ></app-web-icon>
          Participantes
        </button>
        } @if (puedeAgregarElementos()) {
        <button
          type="button"
          class="btn max-sm:btn-sm btn-secondary md:h-11 rounded-lg"
          (click)="mostrarAgregarDetalles()"
          [disabled]="cargando()"
        >
          <app-web-icon
            nombreIcono="briefcase-outline"
            estilos="h-5 w-5 max-md:hidden mr-2"
          ></app-web-icon>
          Elementos
        </button>
        } @if (dreservasService.mostrandoResumenNueva() ||
        dreservasService.mostrandoResumenExistente() && noCancelada()) {
        <div class="flex gap-2">
          @if (!necesitaPago() && !esReservaPasada() && noConfirmada()) {
          <button
            type="button"
            class="btn max-sm:btn-sm btn-success md:h-11 rounded-lg"
            (click)="confirmarReservaFinal()"
            [disabled]="confirmarReservaDisabled()"
          >
            <app-web-icon
              nombreIcono="checkmark-done-circle-outline"
              estilos="h-5 w-5 max-md:hidden mr-2"
            ></app-web-icon>
            Confirmar
          </button>
          } @if (necesitaPago() && puedePagarConSaldo()) {
          <button
            type="button"
            class="btn max-sm:btn-sm btn-warning md:h-11 rounded-lg"
            (click)="
              confirmadaConCambiosPendientes()
                ? confirmarYPagarConSaldo()
                : yaConfirmadaSinPago()
                ? procesarPagoConSaldo()
                : confirmarYPagarConSaldo()
            "
            [disabled]="cargando() || confirmarReservaDisabled()"
          >
            <app-web-icon
              nombreIcono="wallet-outline"
              estilos="h-5 w-5 max-md:hidden mr-2"
            ></app-web-icon>
            {{
              confirmadaConCambiosPendientes()
                ? 'Confirmar y pagar con créditos'
                : yaConfirmadaSinPago()
                ? 'Pagar con créditos'
                : 'Confirmar y pagar con créditos'
            }}
          </button>
          } @else if(necesitaPago()) {
          <button
            type="button"
            class="btn max-sm:btn-sm btn-primary md:h-11 rounded-lg"
            (click)="
              confirmadaConCambiosPendientes()
                ? confirmarYPagar()
                : yaConfirmadaSinPago()
                ? procesarPago()
                : confirmarYPagar()
            "
            [disabled]="cargando() || confirmarReservaDisabled()"
          >
            <app-web-icon
              nombreIcono="checkmark-done-circle-outline"
              estilos="h-5 w-5 max-md:hidden mr-2"
            ></app-web-icon>
            {{
              confirmadaConCambiosPendientes()
                ? 'Confirmar y pagar'
                : yaConfirmadaSinPago()
                ? 'Pagar'
                : 'Confirmar y pagar'
            }}
          </button>
          }
        </div>
        }
      </div>
    </div>
  </div>
</dialog>
